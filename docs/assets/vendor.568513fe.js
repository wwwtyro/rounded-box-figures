var e="undefined"!=typeof Float32Array?Float32Array:Array;function t(){var t=new e(16);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function n(e,t,n,r,a){var i,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(i=1/(r-a),e[10]=(a+r)*i,e[14]=2*a*r*i):(e[10]=-1,e[14]=-2*r),e}function r(e,t,n,r){var a,i,o,u,s,f,c,l,h,d,m=t[0],p=t[1],v=t[2],b=r[0],g=r[1],y=r[2],x=n[0],w=n[1],M=n[2];return Math.abs(m-x)<1e-6&&Math.abs(p-w)<1e-6&&Math.abs(v-M)<1e-6?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(c=m-x,l=p-w,h=v-M,a=g*(h*=d=1/Math.hypot(c,l,h))-y*(l*=d),i=y*(c*=d)-b*h,o=b*l-g*c,(d=Math.hypot(a,i,o))?(a*=d=1/d,i*=d,o*=d):(a=0,i=0,o=0),u=l*o-h*i,s=h*a-c*o,f=c*i-l*a,(d=Math.hypot(u,s,f))?(u*=d=1/d,s*=d,f*=d):(u=0,s=0,f=0),e[0]=a,e[1]=u,e[2]=c,e[3]=0,e[4]=i,e[5]=s,e[6]=l,e[7]=0,e[8]=o,e[9]=f,e[10]=h,e[11]=0,e[12]=-(a*m+i*p+o*v),e[13]=-(u*m+s*p+f*v),e[14]=-(c*m+l*p+h*v),e[15]=1,e)}function a(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function i(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function o(t,n,r){var a=new e(3);return a[0]=t,a[1]=n,a[2]=r,a}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function c(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function l(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function h(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function d(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function m(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function p(e,t){var n=t[0],r=t[1],a=t[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function v(){var t=new e(2);return e!=Float32Array&&(t[0]=0,t[1]=0),t}function b(t,n){var r=new e(2);return r[0]=t,r[1]=n,r}function g(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function y(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function x(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function w(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function M(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function A(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function E(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function _(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),a();var S=y;!function(){var e=v()}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function T(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}var O={exports:{}},k=O.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function a(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||a(t)}function o(e){return e?": "+e:""}function u(e,t,n){e in t||a("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())}function s(t,n){e(t)||a("invalid parameter type"+o(n)+". must be a typed array")}function f(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function c(e,t,n){f(e,t)||a("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e)}function l(e,t){e>=0&&(0|e)===e||a("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")}function h(e,t,n){t.indexOf(e)<0&&a("invalid value"+o(n)+". must be one of: "+t)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function m(e){Object.keys(e).forEach((function(e){d.indexOf(e)<0&&a('invalid regl constructor argument "'+e+'". must be one of '+d)}))}function p(e,t){for(e+="";e.length<t;)e=" "+e;return e}function v(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(e,t){this.number=e,this.line=t,this.errors=[]}function g(e,t,n){this.file=e,this.line=t,this.message=n}function y(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function x(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function w(e,t){var n=e.split("\n"),a=1,i=0,o={unknown:new v,0:new v};o.unknown.name=o[0].name=t||y(),o.unknown.lines.push(new b(0,""));for(var u=0;u<n.length;++u){var s=n[u],f=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(s);if(f)switch(f[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(f[2]);c&&(a=0|c[1],c[2]&&((i=0|c[2])in o||(o[i]=new v)));break;case"define":var l=/SHADER_NAME(_B64)?\s+(.*)$/.exec(f[2]);l&&(o[i].name=l[1]?r(l[2]):l[2])}o[i].lines.push(new b(a++,s))}return Object.keys(o).forEach((function(e){var t=o[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),o}function M(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new g(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new g("unknown",0,e))}})),t}function A(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}function E(e,t,r,a,o){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var u=e.getShaderInfoLog(t),s=a===e.FRAGMENT_SHADER?"fragment":"vertex";j(r,"string",s+" shader source must be a string",o);var f=w(r,o),c=M(u);A(f,c),Object.keys(f).forEach((function(e){var t=f[e];if(t.hasErrors){var r=[""],a=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(p(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var a=r.message,o=/^\s*'(.*)'\s*:\s*(.*)$/.exec(a);if(o){var u=o[1];switch(a=o[2],u){case"assign":u="="}t=Math.max(e.line.indexOf(u,t),0)}else t=0;i(p("| ",6)),i(p("^^^",t+3)+n,"font-weight:bold"),i(p("| ",6)),i(a+n,"font-weight:bold")})),i(p("| ",6)+n)}else i(p(e.number,4)+"|  "),i(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(a[0]=r.join("%c"),console.log.apply(console,a))}function i(e,t){r.push(e),a.push(t||"")}})),i.raise("Error compiling "+s+" shader, "+f[0].name)}}function _(e,t,r,a,o){if(!e.getProgramParameter(t,e.LINK_STATUS)){var u=e.getProgramInfoLog(t),s=w(r,o),f='Error linking program with vertex shader, "'+w(a,o)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!=typeof document?console.log("%c"+f+n+"%c"+u,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(f+n+u),i.raise(f)}}function S(e){e._commandRef=y()}function T(e,t,n,r){function a(e){return e?r.id(e):0}function i(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}S(e),e._fragId=a(e.static.frag),e._vertId=a(e.static.vert);var o=e._uniformSet={};i(o,t.static),i(o,t.dynamic);var u=e._attributeSet={};i(u,n.static),i(u,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function O(e,t){var n=x();a(e+" in command "+(t||y())+("unknown"===n?"":" called from "+n))}function k(e,t,n){e||O(t,n||y())}function D(e,t,n,r){e in t||O("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||y())}function j(e,t,n,r){f(e,t)||O("invalid parameter type"+o(n)+". expected "+t+", got "+typeof e,r||y())}function C(e){e()}function P(e,t,n){e.texture?h(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):h(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var I=33071,R=9728,F=9984,z=9985,L=9986,q=9987,B=5121,V=5122,N=5123,Y=5124,U=5125,X=5126,W=32819,H=32820,G=33635,Q=34042,K=36193,$={};function Z(e,t){return e===H||e===W||e===G?2:e===Q?4:$[e]*t}function J(e){return!(e&e-1||!e)}function ee(e,t,n){var r,a=t.width,o=t.height,u=t.channels;i(a>0&&a<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),e.wrapS===I&&e.wrapT===I||i(J(a)&&J(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==a&&1!==o&&i(e.minFilter!==F&&e.minFilter!==L&&e.minFilter!==z&&e.minFilter!==q,"min filter requires mipmap"):(i(J(a)&&J(o),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(a<<1)-1,"missing or incomplete mipmap data")),t.type===X&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(e.minFilter===R&&e.magFilter===R,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var s=t.images;for(r=0;r<16;++r)if(s[r]){var f=a>>r,c=o>>r;i(t.mipmask&1<<r,"missing mipmap data");var l=s[r];if(i(l.width===f&&l.height===c,"invalid shape for mip images"),i(l.format===t.format&&l.internalformat===t.internalformat&&l.type===t.type,"incompatible type for mip image"),l.compressed);else if(l.data){var h=Math.ceil(Z(l.type,u)*f/l.unpackAlignment)*l.unpackAlignment;i(l.data.byteLength===h*c,"invalid data for image, buffer size is inconsistent with image format")}else l.element||l.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")}function te(e,t,n,r){var a=e.width,o=e.height,u=e.channels;i(a>0&&a<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),i(a===o,"cube map must be square"),i(t.wrapS===I&&t.wrapT===I,"wrap mode not supported by cube map");for(var s=0;s<n.length;++s){var f=n[s];i(f.width===a&&f.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(i(!f.compressed,"can not generate mipmap for compressed textures"),i(1===f.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=f.images,l=0;l<16;++l){var h=c[l];if(h){var d=a>>l,m=o>>l;i(f.mipmask&1<<l,"missing mipmap data"),i(h.width===d&&h.height===m,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?i(h.data.byteLength===d*m*Math.max(Z(h.type,u),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}$[5120]=$[B]=1,$[V]=$[N]=$[K]=$[G]=$[W]=$[H]=2,$[Y]=$[U]=$[X]=$[Q]=4;var ne=t(i,{optional:C,raise:a,commandRaise:O,command:k,parameter:u,commandParameter:D,constructor:m,type:c,commandType:j,isTypedArray:s,nni:l,oneOf:h,shaderError:E,linkError:_,callSite:x,saveCommandRef:S,saveDrawInfo:T,framebufferFormat:P,guessCommand:y,texture2D:ee,textureCube:te}),re=0,ae=0,ie=5,oe=6;function ue(e,t){this.id=re++,this.type=e,this.data=t}function se(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function fe(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+se(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return fe(e.substr(0,r.index)).concat(fe(r[1])).concat(fe(e.substr(r.index+r[0].length)));var a=e.split(".");if(1===a.length)return['"'+se(e)+'"'];for(var i=[],o=0;o<a.length;++o)i=i.concat(fe(a[o]));return i}function ce(e){return"["+fe(e).join("][")+"]"}function le(e,t){return new ue(e,ce(t+""))}function he(e){return"function"==typeof e&&!e._reglType||e instanceof ue}function de(e,t){return"function"==typeof e?new ue(ae,e):"number"==typeof e||"boolean"==typeof e?new ue(ie,e):Array.isArray(e)?new ue(oe,e.map((function(e,n){return de(e,t+"["+n+"]")}))):e instanceof ue?e:void ne(!1,"invalid option type in uniform "+t)}var me={DynamicVariable:ue,define:le,isDynamic:he,unbox:de,accessor:ce},pe={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},ve="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function be(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}function ge(e,n,r){var a,i=document.createElement("canvas");function o(){var t=window.innerWidth,n=window.innerHeight;if(e!==document.body){var a=i.getBoundingClientRect();t=a.right-a.left,n=a.bottom-a.top}i.width=r*t,i.height=r*n}function u(){a?a.disconnect():window.removeEventListener("resize",o),e.removeChild(i)}return t(i.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(i),e===document.body&&(i.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(a=new ResizeObserver((function(){setTimeout(o)}))).observe(e):window.addEventListener("resize",o,!1),o(),{canvas:i,onDestroy:u}}function ye(e,t){function n(n){try{return e.getContext(n,t)}catch(r){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function xe(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}function we(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}function Me(e){return"string"==typeof e?e.split():(ne(Array.isArray(e),"invalid extension array"),e)}function Ae(e){return"string"==typeof e?(ne("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function Ee(e){var t,n,r,a,i=e||{},o={},u=[],s=[],f="undefined"==typeof window?1:window.devicePixelRatio,c=!1,l=function(e){e&&ne.raise(e)},h=function(){};if("string"==typeof i?(ne("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(i),ne(t,"invalid query string for element")):"object"==typeof i?xe(i)?t=i:we(i)?r=(a=i).canvas:(ne.constructor(i),"gl"in i?a=i.gl:"canvas"in i?r=Ae(i.canvas):"container"in i&&(n=Ae(i.container)),"attributes"in i&&(o=i.attributes,ne.type(o,"object","invalid context attributes")),"extensions"in i&&(u=Me(i.extensions)),"optionalExtensions"in i&&(s=Me(i.optionalExtensions)),"onDone"in i&&(ne.type(i.onDone,"function","invalid or missing onDone callback"),l=i.onDone),"profile"in i&&(c=!!i.profile),"pixelRatio"in i&&(f=+i.pixelRatio,ne(f>0,"invalid pixel ratio"))):ne.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?r=t:n=t),!a){if(!r){ne("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=ge(n||document.body,l,f);if(!d)return null;r=d.canvas,h=d.onDestroy}void 0===o.premultipliedAlpha&&(o.premultipliedAlpha=!0),a=ye(r,o)}return a?{gl:a,canvas:r,container:n,extensions:u,optionalExtensions:s,pixelRatio:f,profile:c,onDone:l,onDestroy:h}:(h(),l("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function _e(e,t){var n={};function r(t){ne.type(t,"string","extension name must be string");var r,a=t.toLowerCase();try{r=n[a]=e.getExtension(a)}catch(i){}return!!r}for(var a=0;a<t.extensions.length;++a){var i=t.extensions[a];if(!r(i))return t.onDestroy(),t.onDone('"'+i+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}function Se(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var Te=5120,Oe=5121,ke=5122,De=5123,je=5124,Ce=5125,Pe=5126;function Ie(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function Re(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function Fe(){var e=Se(8,(function(){return[]}));function t(t){var n=Ie(t),r=e[Re(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[Re(t.byteLength)>>2].push(t)}function r(e,n){var r=null;switch(e){case Te:r=new Int8Array(t(n),0,n);break;case Oe:r=new Uint8Array(t(n),0,n);break;case ke:r=new Int16Array(t(2*n),0,n);break;case De:r=new Uint16Array(t(2*n),0,n);break;case je:r=new Int32Array(t(4*n),0,n);break;case Ce:r=new Uint32Array(t(4*n),0,n);break;case Pe:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function a(e){n(e.buffer)}return{alloc:t,free:n,allocType:r,freeType:a}}var ze=Fe();ze.zero=Fe();var Le=3408,qe=3410,Be=3411,Ve=3412,Ne=3413,Ye=3414,Ue=3415,Xe=33901,We=33902,He=3379,Ge=3386,Qe=34921,Ke=36347,$e=36348,Ze=35661,Je=35660,et=34930,tt=36349,nt=34076,rt=34024,at=7936,it=7937,ot=7938,ut=35724,st=34047,ft=36063,ct=34852,lt=3553,ht=34067,dt=34069,mt=33984,pt=6408,vt=5126,bt=5121,gt=36160,yt=36053,xt=36064,wt=16384,Mt=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(st));var r=1,a=1;t.webgl_draw_buffers&&(r=e.getParameter(ct),a=e.getParameter(ft));var i=!!t.oes_texture_float;if(i){var o=e.createTexture();e.bindTexture(lt,o),e.texImage2D(lt,0,pt,1,1,0,pt,vt,null);var u=e.createFramebuffer();if(e.bindFramebuffer(gt,u),e.framebufferTexture2D(gt,xt,lt,o,0),e.bindTexture(lt,null),e.checkFramebufferStatus(gt)!==yt)i=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(wt);var s=ze.allocType(vt,4);e.readPixels(0,0,1,1,pt,vt,s),e.getError()?i=!1:(e.deleteFramebuffer(u),e.deleteTexture(o),i=1===s[0]),ze.freeType(s)}}var f=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=e.createTexture(),l=ze.allocType(bt,36);e.activeTexture(mt),e.bindTexture(ht,c),e.texImage2D(dt,0,pt,3,3,0,pt,bt,l),ze.freeType(l),e.bindTexture(ht,null),e.deleteTexture(c),f=!e.getError()}return{colorBits:[e.getParameter(qe),e.getParameter(Be),e.getParameter(Ve),e.getParameter(Ne)],depthBits:e.getParameter(Ye),stencilBits:e.getParameter(Ue),subpixelBits:e.getParameter(Le),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:a,pointSizeDims:e.getParameter(Xe),lineWidthDims:e.getParameter(We),maxViewportDims:e.getParameter(Ge),maxCombinedTextureUnits:e.getParameter(Ze),maxCubeMapSize:e.getParameter(nt),maxRenderbufferSize:e.getParameter(rt),maxTextureUnits:e.getParameter(et),maxTextureSize:e.getParameter(He),maxAttributes:e.getParameter(Qe),maxVertexUniforms:e.getParameter(Ke),maxVertexTextureUnits:e.getParameter(Je),maxVaryingVectors:e.getParameter($e),maxFragmentUniforms:e.getParameter(tt),glsl:e.getParameter(ut),renderer:e.getParameter(it),vendor:e.getParameter(at),version:e.getParameter(ot),readFloat:i,npotTextureCube:f}};function At(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var Et=function(e){return Object.keys(e).map((function(t){return e[t]}))},_t={shape:jt,flatten:Dt};function St(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}function Tt(e,t,n,r){for(var a=0,i=0;i<t;++i)for(var o=e[i],u=0;u<n;++u)r[a++]=o[u]}function Ot(e,t,n,r,a,i){for(var o=i,u=0;u<t;++u)for(var s=e[u],f=0;f<n;++f)for(var c=s[f],l=0;l<r;++l)a[o++]=c[l]}function kt(e,t,n,r,a){for(var i=1,o=n+1;o<t.length;++o)i*=t[o];var u=t[n];if(t.length-n==4){var s=t[n+1],f=t[n+2],c=t[n+3];for(o=0;o<u;++o)Ot(e[o],s,f,c,r,a),a+=i}else for(o=0;o<u;++o)kt(e[o],t,n+1,r,a),a+=i}function Dt(e,t,n,r){var a=1;if(t.length)for(var i=0;i<t.length;++i)a*=t[i];else a=0;var o=r||ze.allocType(n,a);switch(t.length){case 0:break;case 1:St(e,t[0],o);break;case 2:Tt(e,t[0],t[1],o);break;case 3:Ot(e,t[0],t[1],t[2],o,0);break;default:kt(e,t,0,o,0)}return o}function jt(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t}var Ct={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Pt={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},It={dynamic:35048,stream:35040,static:35044},Rt=_t.flatten,Ft=_t.shape,zt=35044,Lt=35040,qt=5121,Bt=5126,Vt=[];function Nt(e){return 0|Ct[Object.prototype.toString.call(e)]}function Yt(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Ut(e,t,n,r,a,i,o){for(var u=0,s=0;s<n;++s)for(var f=0;f<r;++f)e[u++]=t[a*s+i*f+o]}function Xt(t,n,r,a){var i=0,o={};function u(e){this.id=i++,this.buffer=t.createBuffer(),this.type=e,this.usage=zt,this.byteLength=0,this.dimension=1,this.dtype=qt,this.persistentData=null,r.profile&&(this.stats={size:0})}u.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},u.prototype.destroy=function(){d(this)};var s=[];function f(e,t){var n=s.pop();return n||(n=new u(e)),n.bind(),h(n,t,Lt,0,1,!1),n}function c(e){s.push(e)}function l(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function h(t,n,r,a,i,o){var u,s;if(t.usage=r,Array.isArray(n)){if(t.dtype=a||Bt,n.length>0)if(Array.isArray(n[0])){u=Ft(n);for(var f=1,c=1;c<u.length;++c)f*=u[c];t.dimension=f,l(t,s=Rt(n,u,t.dtype),r),o?t.persistentData=s:ze.freeType(s)}else if("number"==typeof n[0]){t.dimension=i;var h=ze.allocType(t.dtype,n.length);Yt(h,n),l(t,h,r),o?t.persistentData=h:ze.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=a||Nt(n[0])||Bt,l(t,s=Rt(n,[n.length,n[0].length],t.dtype),r),o?t.persistentData=s:ze.freeType(s)):ne.raise("invalid buffer data")}else if(e(n))t.dtype=a||Nt(n),t.dimension=i,l(t,n,r),o&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(At(n)){u=n.shape;var d=n.stride,m=n.offset,p=0,v=0,b=0,g=0;1===u.length?(p=u[0],v=1,b=d[0],g=0):2===u.length?(p=u[0],v=u[1],b=d[0],g=d[1]):ne.raise("invalid shape"),t.dtype=a||Nt(n.data)||Bt,t.dimension=v;var y=ze.allocType(t.dtype,p*v);Ut(y,n.data,p,v,b,g,m),l(t,y,r),o?t.persistentData=y:ze.freeType(y)}else n instanceof ArrayBuffer?(t.dtype=qt,t.dimension=i,l(t,n,r),o&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):ne.raise("invalid buffer data")}function d(e){n.bufferCount--,a(e);var r=e.buffer;ne(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete o[e.id]}function m(a,i,s,f){n.bufferCount++;var c=new u(i);function l(n){var a=zt,i=null,o=0,u=0,s=1;return Array.isArray(n)||e(n)||At(n)||n instanceof ArrayBuffer?i=n:"number"==typeof n?o=0|n:n&&(ne.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(ne(null===i||Array.isArray(i)||e(i)||At(i),"invalid data for buffer"),i=n.data),"usage"in n&&(ne.parameter(n.usage,It,"invalid buffer usage"),a=It[n.usage]),"type"in n&&(ne.parameter(n.type,Pt,"invalid buffer type"),u=Pt[n.type]),"dimension"in n&&(ne.type(n.dimension,"number","invalid dimension"),s=0|n.dimension),"length"in n&&(ne.nni(o,"buffer length must be a nonnegative integer"),o=0|n.length)),c.bind(),i?h(c,i,a,u,s,f):(o&&t.bufferData(c.type,o,a),c.dtype=u||qt,c.usage=a,c.dimension=s,c.byteLength=o),r.profile&&(c.stats.size=c.byteLength*Vt[c.dtype]),l}function m(e,n){ne(n+e.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+c.byteLength),t.bufferSubData(c.type,n,e)}function p(t,n){var r,a=0|(n||0);if(c.bind(),e(t)||t instanceof ArrayBuffer)m(t,a);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var i=ze.allocType(c.dtype,t.length);Yt(i,t),m(i,a),ze.freeType(i)}else if(Array.isArray(t[0])||e(t[0])){r=Ft(t);var o=Rt(t,r,c.dtype);m(o,a),ze.freeType(o)}else ne.raise("invalid buffer data")}else if(At(t)){r=t.shape;var u=t.stride,s=0,f=0,h=0,d=0;1===r.length?(s=r[0],f=1,h=u[0],d=0):2===r.length?(s=r[0],f=r[1],h=u[0],d=u[1]):ne.raise("invalid shape");var p=Array.isArray(t.data)?c.dtype:Nt(t.data),v=ze.allocType(p,s*f);Ut(v,t.data,s,f,h,d,t.offset),m(v,a),ze.freeType(v)}else ne.raise("invalid data for buffer subdata");return l}return o[c.id]=c,s||l(a),l._reglType="buffer",l._buffer=c,l.subdata=p,r.profile&&(l.stats=c.stats),l.destroy=function(){d(c)},l}function p(){Et(o).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(o).forEach((function(t){e+=o[t].stats.size})),e}),{create:m,createStream:f,destroyStream:c,clear:function(){Et(o).forEach(d),s.forEach(d)},getBuffer:function(e){return e&&e._buffer instanceof u?e._buffer:null},restore:p,_initBuffer:h}}Vt[5120]=1,Vt[5122]=2,Vt[5124]=4,Vt[5121]=1,Vt[5123]=2,Vt[5125]=4,Vt[5126]=4;var Wt={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Ht=0,Gt=1,Qt=4,Kt=5120,$t=5121,Zt=5122,Jt=5123,en=5124,tn=5125,nn=34963,rn=35040,an=35044;function on(t,n,r,a){var i={},o=0,u={uint8:$t,uint16:Jt};function s(e){this.id=o++,i[this.id]=this,this.buffer=e,this.primType=Qt,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(u.uint32=tn),s.prototype.bind=function(){this.buffer.bind()};var f=[];function c(e){var t=f.pop();return t||(t=new s(r.create(null,nn,!0,!1)._buffer)),h(t,e,rn,-1,-1,0,0),t}function l(e){f.push(e)}function h(a,i,o,u,s,f,c){var l;if(a.buffer.bind(),i){var h=c;c||e(i)&&(!At(i)||e(i.data))||(h=n.oes_element_index_uint?tn:Jt),r._initBuffer(a.buffer,i,o,h,3)}else t.bufferData(nn,f,o),a.buffer.dtype=l||$t,a.buffer.usage=o,a.buffer.dimension=3,a.buffer.byteLength=f;if(l=c,!c){switch(a.buffer.dtype){case $t:case Kt:l=$t;break;case Jt:case Zt:l=Jt;break;case tn:case en:l=tn;break;default:ne.raise("unsupported type for element array")}a.buffer.dtype=l}a.type=l,ne(l!==tn||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=s;d<0&&(d=a.buffer.byteLength,l===Jt?d>>=1:l===tn&&(d>>=2)),a.vertCount=d;var m=u;if(u<0){m=Qt;var p=a.buffer.dimension;1===p&&(m=Ht),2===p&&(m=Gt),3===p&&(m=Qt)}a.primType=m}function d(e){a.elementsCount--,ne(null!==e.buffer,"must not double destroy elements"),delete i[e.id],e.buffer.destroy(),e.buffer=null}function m(t,n){var i=r.create(null,nn,!0),o=new s(i._buffer);function f(t){if(t)if("number"==typeof t)i(t),o.primType=Qt,o.vertCount=0|t,o.type=$t;else{var n=null,r=an,a=-1,s=-1,c=0,l=0;Array.isArray(t)||e(t)||At(t)?n=t:(ne.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,ne(Array.isArray(n)||e(n)||At(n),"invalid data for element buffer")),"usage"in t&&(ne.parameter(t.usage,It,"invalid element buffer usage"),r=It[t.usage]),"primitive"in t&&(ne.parameter(t.primitive,Wt,"invalid element buffer primitive"),a=Wt[t.primitive]),"count"in t&&(ne("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),s=0|t.count),"type"in t&&(ne.parameter(t.type,u,"invalid buffer type"),l=u[t.type]),"length"in t?c=0|t.length:(c=s,l===Jt||l===Zt?c*=2:l!==tn&&l!==en||(c*=4))),h(o,n,r,a,s,c,l)}else i(),o.primType=Qt,o.vertCount=0,o.type=$t;return f}return a.elementsCount++,f(t),f._reglType="elements",f._elements=o,f.subdata=function(e,t){return i.subdata(e,t),f},f.destroy=function(){d(o)},f}return{create:m,createStream:c,destroyStream:l,getElements:function(e){return"function"==typeof e&&e._elements instanceof s?e._elements:null},clear:function(){Et(i).forEach(d)}}}var un=new Float32Array(1),sn=new Uint32Array(un.buffer),fn=5123;function cn(e){for(var t=ze.allocType(fn,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{un[0]=e[n];var r=sn[0],a=r>>>31<<15,i=(r<<1>>>24)-127,o=r>>13&1023;if(i<-24)t[n]=a;else if(i<-14){var u=-14-i;t[n]=a+(o+1024>>u)}else t[n]=i>15?a+31744:a+(i+15<<10)+o}return t}function ln(t){return Array.isArray(t)||e(t)}var hn=function(e){return!(e&e-1||!e)},dn=34467,mn=3553,pn=34067,vn=34069,bn=6408,gn=6406,yn=6407,xn=6409,wn=6410,Mn=32854,An=32855,En=36194,_n=32819,Sn=32820,Tn=33635,On=34042,kn=6402,Dn=34041,jn=35904,Cn=35906,Pn=36193,In=33776,Rn=33777,Fn=33778,zn=33779,Ln=35986,qn=35987,Bn=34798,Vn=35840,Nn=35841,Yn=35842,Un=35843,Xn=36196,Wn=5121,Hn=5123,Gn=5125,Qn=5126,Kn=10242,$n=10243,Zn=10497,Jn=33071,er=33648,tr=10240,nr=10241,rr=9728,ar=9729,ir=9984,or=9985,ur=9986,sr=9987,fr=33170,cr=4352,lr=4353,hr=4354,dr=34046,mr=3317,pr=37440,vr=37441,br=37443,gr=37444,yr=33984,xr=[ir,ur,or,sr],wr=[0,xn,wn,yn,bn],Mr={};function Ar(e){return"[object "+e+"]"}Mr[xn]=Mr[gn]=Mr[kn]=1,Mr[Dn]=Mr[wn]=2,Mr[yn]=Mr[jn]=3,Mr[bn]=Mr[Cn]=4;var Er=Ar("HTMLCanvasElement"),_r=Ar("OffscreenCanvas"),Sr=Ar("CanvasRenderingContext2D"),Tr=Ar("ImageBitmap"),Or=Ar("HTMLImageElement"),kr=Ar("HTMLVideoElement"),Dr=Object.keys(Ct).concat([Er,_r,Sr,Tr,Or,kr]),jr=[];jr[Wn]=1,jr[Qn]=4,jr[Pn]=2,jr[Hn]=2,jr[Gn]=4;var Cr=[];function Pr(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function Ir(e){return!!Array.isArray(e)&&!(0===e.length||!ln(e[0]))}function Rr(e){return Object.prototype.toString.call(e)}function Fr(e){return Rr(e)===Er}function zr(e){return Rr(e)===_r}function Lr(e){return Rr(e)===Sr}function qr(e){return Rr(e)===Tr}function Br(e){return Rr(e)===Or}function Vr(e){return Rr(e)===kr}function Nr(e){if(!e)return!1;var t=Rr(e);return Dr.indexOf(t)>=0||Pr(e)||Ir(e)||At(e)}function Yr(e){return 0|Ct[Object.prototype.toString.call(e)]}function Ur(e,t){var n=t.length;switch(e.type){case Wn:case Hn:case Gn:case Qn:var r=ze.allocType(e.type,n);r.set(t),e.data=r;break;case Pn:e.data=cn(t);break;default:ne.raise("unsupported texture type, must specify a typed array")}}function Xr(e,t){return ze.allocType(e.type===Pn?Qn:e.type,t)}function Wr(e,t){e.type===Pn?(e.data=cn(t),ze.freeType(t)):e.data=t}function Hr(e,t,n,r,a,i){for(var o=e.width,u=e.height,s=e.channels,f=Xr(e,o*u*s),c=0,l=0;l<u;++l)for(var h=0;h<o;++h)for(var d=0;d<s;++d)f[c++]=t[n*h+r*l+a*d+i];Wr(e,f)}function Gr(e,t,n,r,a,i){var o;if(o=void 0!==Cr[e]?Cr[e]:Mr[e]*jr[t],i&&(o*=6),a){for(var u=0,s=n;s>=1;)u+=o*s*s,s/=2;return u}return o*n*r}function Qr(n,r,a,i,o,u,s){var f={"don't care":cr,"dont care":cr,nice:hr,fast:lr},c={repeat:Zn,clamp:Jn,mirror:er},l={nearest:rr,linear:ar},h=t({mipmap:sr,"nearest mipmap nearest":ir,"linear mipmap nearest":or,"nearest mipmap linear":ur,"linear mipmap linear":sr},l),d={none:0,browser:gr},m={uint8:Wn,rgba4:_n,rgb565:Tn,"rgb5 a1":Sn},p={alpha:gn,luminance:xn,"luminance alpha":wn,rgb:yn,rgba:bn,rgba4:Mn,"rgb5 a1":An,rgb565:En},v={};r.ext_srgb&&(p.srgb=jn,p.srgba=Cn),r.oes_texture_float&&(m.float32=m.float=Qn),r.oes_texture_half_float&&(m.float16=m["half float"]=Pn),r.webgl_depth_texture&&(t(p,{depth:kn,"depth stencil":Dn}),t(m,{uint16:Hn,uint32:Gn,"depth stencil":On})),r.webgl_compressed_texture_s3tc&&t(v,{"rgb s3tc dxt1":In,"rgba s3tc dxt1":Rn,"rgba s3tc dxt3":Fn,"rgba s3tc dxt5":zn}),r.webgl_compressed_texture_atc&&t(v,{"rgb atc":Ln,"rgba atc explicit alpha":qn,"rgba atc interpolated alpha":Bn}),r.webgl_compressed_texture_pvrtc&&t(v,{"rgb pvrtc 4bppv1":Vn,"rgb pvrtc 2bppv1":Nn,"rgba pvrtc 4bppv1":Yn,"rgba pvrtc 2bppv1":Un}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=Xn);var b=Array.prototype.slice.call(n.getParameter(dn));Object.keys(v).forEach((function(e){var t=v[e];b.indexOf(t)>=0&&(p[e]=t)}));var g=Object.keys(p);a.textureFormats=g;var y=[];Object.keys(p).forEach((function(e){var t=p[e];y[t]=e}));var x=[];Object.keys(m).forEach((function(e){var t=m[e];x[t]=e}));var w=[];Object.keys(l).forEach((function(e){var t=l[e];w[t]=e}));var M=[];Object.keys(h).forEach((function(e){var t=h[e];M[t]=e}));var A=[];Object.keys(c).forEach((function(e){var t=c[e];A[t]=e}));var E=g.reduce((function(e,t){var n=p[t];return n===xn||n===gn||n===xn||n===wn||n===kn||n===Dn||r.ext_srgb&&(n===jn||n===Cn)?e[n]=n:n===An||t.indexOf("rgba")>=0?e[n]=bn:e[n]=yn,e}),{});function _(){this.internalformat=bn,this.format=bn,this.type=Wn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=gr,this.width=0,this.height=0,this.channels=0}function S(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function T(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(ne.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(ne.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(ne.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(ne.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;ne(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),ne(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ne(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(n,m,"invalid texture type"),e.type=m[n]}var i=e.width,o=e.height,u=e.channels,s=!1;"shape"in t?(ne(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),i=t.shape[0],o=t.shape[1],3===t.shape.length&&(u=t.shape[2],ne(u>0&&u<=4,"invalid number of channels"),s=!0),ne(i>=0&&i<=a.maxTextureSize,"invalid width"),ne(o>=0&&o<=a.maxTextureSize,"invalid height")):("radius"in t&&(i=o=t.radius,ne(i>=0&&i<=a.maxTextureSize,"invalid radius")),"width"in t&&(i=t.width,ne(i>=0&&i<=a.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,ne(o>=0&&o<=a.maxTextureSize,"invalid height")),"channels"in t&&(u=t.channels,ne(u>0&&u<=4,"invalid number of channels"),s=!0)),e.width=0|i,e.height=0|o,e.channels=0|u;var f=!1;if("format"in t){var c=t.format;ne(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(c,p,"invalid texture format");var l=e.internalformat=p[c];e.format=E[l],c in m&&("type"in t||(e.type=m[c])),c in v&&(e.compressed=!0),f=!0}!s&&f?e.channels=Mr[e.format]:s&&!f?e.channels!==wr[e.format]&&(e.format=e.internalformat=wr[e.channels]):f&&s&&ne(e.channels===Mr[e.format],"number of channels inconsistent with specified format")}}function O(e){n.pixelStorei(pr,e.flipY),n.pixelStorei(vr,e.premultiplyAlpha),n.pixelStorei(br,e.colorSpace),n.pixelStorei(mr,e.unpackAlignment)}function k(){_.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function D(t,n){var r=null;if(Nr(n)?r=n:n&&(ne.type(n,"object","invalid pixel data type"),T(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),Nr(n.data)&&(r=n.data)),ne(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){ne(!r,"can not specify copy and data field for the same texture");var i=o.viewportWidth,u=o.viewportHeight;t.width=t.width||i-t.xOffset,t.height=t.height||u-t.yOffset,t.needsCopy=!0,ne(t.xOffset>=0&&t.xOffset<i&&t.yOffset>=0&&t.yOffset<u&&t.width>0&&t.width<=i&&t.height>0&&t.height<=u,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Wn||(t.type=Yr(r));else if(Pr(r))t.channels=t.channels||4,Ur(t,r),t.alignment=1,t.needsFree=!0;else if(At(r)){var s=r.data;Array.isArray(s)||t.type!==Wn||(t.type=Yr(s));var f,c,l,h,d,m,p=r.shape,v=r.stride;3===p.length?(l=p[2],m=v[2]):(ne(2===p.length,"invalid ndarray pixel data, must be 2 or 3D"),l=1,m=1),f=p[0],c=p[1],h=v[0],d=v[1],t.alignment=1,t.width=f,t.height=c,t.channels=l,t.format=t.internalformat=wr[l],t.needsFree=!0,Hr(t,s,h,d,m,r.offset)}else if(Fr(r)||zr(r)||Lr(r))Fr(r)||zr(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(qr(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(Br(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(Vr(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(Ir(r)){var b=t.width||r[0].length,g=t.height||r.length,y=t.channels;y=ln(r[0][0])?y||r[0][0].length:y||1;for(var x=_t.shape(r),w=1,M=0;M<x.length;++M)w*=x[M];var A=Xr(t,w);_t.flatten(r,x,"",A),Wr(t,A),t.alignment=1,t.width=b,t.height=g,t.channels=y,t.format=t.internalformat=wr[y],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Qn?ne(a.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Pn&&ne(a.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function j(e,t,r){var a=e.element,o=e.data,u=e.internalformat,s=e.format,f=e.type,c=e.width,l=e.height;O(e),a?n.texImage2D(t,r,s,s,f,a):e.compressed?n.compressedTexImage2D(t,r,u,c,l,0,o):e.needsCopy?(i(),n.copyTexImage2D(t,r,s,e.xOffset,e.yOffset,c,l,0)):n.texImage2D(t,r,s,c,l,0,s,f,o||null)}function C(e,t,r,a,o){var u=e.element,s=e.data,f=e.internalformat,c=e.format,l=e.type,h=e.width,d=e.height;O(e),u?n.texSubImage2D(t,o,r,a,c,l,u):e.compressed?n.compressedTexSubImage2D(t,o,r,a,f,h,d,s):e.needsCopy?(i(),n.copyTexSubImage2D(t,o,r,a,e.xOffset,e.yOffset,h,d)):n.texSubImage2D(t,o,r,a,h,d,c,l,s)}var P=[];function I(){return P.pop()||new k}function R(e){e.needsFree&&ze.freeType(e.data),k.call(e),P.push(e)}function F(){_.call(this),this.genMipmaps=!1,this.mipmapHint=cr,this.mipmask=0,this.images=Array(16)}function z(e,t,n){var r=e.images[0]=I();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function L(e,t){var n=null;if(Nr(t))S(n=e.images[0]=I(),e),D(n,t),e.mipmask=1;else if(T(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,a=0;a<r.length;++a)S(n=e.images[a]=I(),e),n.width>>=a,n.height>>=a,D(n,r[a]),e.mipmask|=1<<a;else S(n=e.images[0]=I(),e),D(n,t),e.mipmask=1;S(e,e.images[0]),!e.compressed||e.internalformat!==In&&e.internalformat!==Rn&&e.internalformat!==Fn&&e.internalformat!==zn||ne(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function q(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;j(n[r],t,r)}}var B=[];function V(){var e=B.pop()||new F;_.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function N(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&R(t[n]),t[n]=null;B.push(e)}function Y(){this.minFilter=rr,this.magFilter=rr,this.wrapS=Jn,this.wrapT=Jn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=cr}function U(e,t){if("min"in t){var n=t.min;ne.parameter(n,h),e.minFilter=h[n],xr.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;ne.parameter(r,l),e.magFilter=l[r]}var i=e.wrapS,o=e.wrapT;if("wrap"in t){var u=t.wrap;"string"==typeof u?(ne.parameter(u,c),i=o=c[u]):Array.isArray(u)&&(ne.parameter(u[0],c),ne.parameter(u[1],c),i=c[u[0]],o=c[u[1]])}else{if("wrapS"in t){var s=t.wrapS;ne.parameter(s,c),i=c[s]}if("wrapT"in t){var d=t.wrapT;ne.parameter(d,c),o=c[d]}}if(e.wrapS=i,e.wrapT=o,"anisotropic"in t){var m=t.anisotropic;ne("number"==typeof m&&m>=1&&m<=a.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var p=!1;switch(typeof t.mipmap){case"string":ne.parameter(t.mipmap,f,"invalid mipmap hint"),e.mipmapHint=f[t.mipmap],e.genMipmaps=!0,p=!0;break;case"boolean":p=e.genMipmaps=t.mipmap;break;case"object":ne(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,p=!0;break;default:ne.raise("invalid mipmap type")}p&&!("min"in t)&&(e.minFilter=ir)}}function X(e,t){n.texParameteri(t,nr,e.minFilter),n.texParameteri(t,tr,e.magFilter),n.texParameteri(t,Kn,e.wrapS),n.texParameteri(t,$n,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,dr,e.anisotropic),e.genMipmaps&&(n.hint(fr,e.mipmapHint),n.generateMipmap(t))}var W=0,H={},G=a.maxTextureUnits,Q=Array(G).map((function(){return null}));function K(e){_.call(this),this.mipmask=0,this.internalformat=bn,this.id=W++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Y,s.profile&&(this.stats={size:0})}function $(e){n.activeTexture(yr),n.bindTexture(e.target,e.texture)}function Z(){var e=Q[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(mn,null)}function J(e){var t=e.texture;ne(t,"must not double destroy texture");var r=e.unit,a=e.target;r>=0&&(n.activeTexture(yr+r),n.bindTexture(a,null),Q[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete H[e.id],u.textureCount--}function ee(e,t){var r=new K(mn);function i(e,t){var n=r.texInfo;Y.call(n);var o=V();return"number"==typeof e?z(o,0|e,"number"==typeof t?0|t:0|e):e?(ne.type(e,"object","invalid arguments to regl.texture"),U(n,e),L(o,e)):z(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),r.mipmask=o.mipmask,S(r,o),ne.texture2D(n,o,a),r.internalformat=o.internalformat,i.width=o.width,i.height=o.height,$(r),q(o,mn),X(n,mn),Z(),N(o),s.profile&&(r.stats.size=Gr(r.internalformat,r.type,o.width,o.height,n.genMipmaps,!1)),i.format=y[r.internalformat],i.type=x[r.type],i.mag=w[n.magFilter],i.min=M[n.minFilter],i.wrapS=A[n.wrapS],i.wrapT=A[n.wrapT],i}function o(e,t,n,a){ne(!!e,"must specify image data");var o=0|t,u=0|n,s=0|a,f=I();return S(f,r),f.width=0,f.height=0,D(f,e),f.width=f.width||(r.width>>s)-o,f.height=f.height||(r.height>>s)-u,ne(r.type===f.type&&r.format===f.format&&r.internalformat===f.internalformat,"incompatible format for texture.subimage"),ne(o>=0&&u>=0&&o+f.width<=r.width&&u+f.height<=r.height,"texture.subimage write out of bounds"),ne(r.mipmask&1<<s,"missing mipmap data"),ne(f.data||f.element||f.needsCopy,"missing image data"),$(r),C(f,mn,o,u,s),Z(),R(f),i}function f(e,t){var a=0|e,o=0|t||a;if(a===r.width&&o===r.height)return i;i.width=r.width=a,i.height=r.height=o,$(r);for(var u=0;r.mipmask>>u;++u){var f=a>>u,c=o>>u;if(!f||!c)break;n.texImage2D(mn,u,r.format,f,c,0,r.format,r.type,null)}return Z(),s.profile&&(r.stats.size=Gr(r.internalformat,r.type,a,o,!1,!1)),i}return H[r.id]=r,u.textureCount++,i(e,t),i.subimage=o,i.resize=f,i._reglType="texture2d",i._texture=r,s.profile&&(i.stats=r.stats),i.destroy=function(){r.decRef()},i}function te(e,t,r,i,o,f){var c=new K(pn);H[c.id]=c,u.cubeCount++;var l=new Array(6);function h(e,t,n,r,i,o){var u,f=c.texInfo;for(Y.call(f),u=0;u<6;++u)l[u]=V();if("number"!=typeof e&&e)if("object"==typeof e)if(t)L(l[0],e),L(l[1],t),L(l[2],n),L(l[3],r),L(l[4],i),L(l[5],o);else if(U(f,e),T(c,e),"faces"in e){var d=e.faces;for(ne(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),u=0;u<6;++u)ne("object"==typeof d[u]&&!!d[u],"invalid input for cube map face"),S(l[u],c),L(l[u],d[u])}else for(u=0;u<6;++u)L(l[u],e);else ne.raise("invalid arguments to cube map");else{var m=0|e||1;for(u=0;u<6;++u)z(l[u],m,m)}for(S(c,l[0]),ne.optional((function(){a.npotTextureCube||ne(hn(c.width)&&hn(c.height),"your browser does not support non power or two texture dimensions")})),f.genMipmaps?c.mipmask=(l[0].width<<1)-1:c.mipmask=l[0].mipmask,ne.textureCube(c,f,l,a),c.internalformat=l[0].internalformat,h.width=l[0].width,h.height=l[0].height,$(c),u=0;u<6;++u)q(l[u],vn+u);for(X(f,pn),Z(),s.profile&&(c.stats.size=Gr(c.internalformat,c.type,h.width,h.height,f.genMipmaps,!0)),h.format=y[c.internalformat],h.type=x[c.type],h.mag=w[f.magFilter],h.min=M[f.minFilter],h.wrapS=A[f.wrapS],h.wrapT=A[f.wrapT],u=0;u<6;++u)N(l[u]);return h}function d(e,t,n,r,a){ne(!!t,"must specify image data"),ne("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var i=0|n,o=0|r,u=0|a,s=I();return S(s,c),s.width=0,s.height=0,D(s,t),s.width=s.width||(c.width>>u)-i,s.height=s.height||(c.height>>u)-o,ne(c.type===s.type&&c.format===s.format&&c.internalformat===s.internalformat,"incompatible format for texture.subimage"),ne(i>=0&&o>=0&&i+s.width<=c.width&&o+s.height<=c.height,"texture.subimage write out of bounds"),ne(c.mipmask&1<<u,"missing mipmap data"),ne(s.data||s.element||s.needsCopy,"missing image data"),$(c),C(s,vn+e,i,o,u),Z(),R(s),h}function m(e){var t=0|e;if(t!==c.width){h.width=c.width=t,h.height=c.height=t,$(c);for(var r=0;r<6;++r)for(var a=0;c.mipmask>>a;++a)n.texImage2D(vn+r,a,c.format,t>>a,t>>a,0,c.format,c.type,null);return Z(),s.profile&&(c.stats.size=Gr(c.internalformat,c.type,h.width,h.height,!1,!0)),h}}return h(e,t,r,i,o,f),h.subimage=d,h.resize=m,h._reglType="textureCube",h._texture=c,s.profile&&(h.stats=c.stats),h.destroy=function(){c.decRef()},h}function re(){for(var e=0;e<G;++e)n.activeTexture(yr+e),n.bindTexture(mn,null),Q[e]=null;Et(H).forEach(J),u.cubeCount=0,u.textureCount=0}function ae(){for(var e=0;e<G;++e){var t=Q[e];t&&(t.bindCount=0,t.unit=-1,Q[e]=null)}Et(H).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===mn)n.texImage2D(mn,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(vn+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);X(e.texInfo,e.target)}))}function ie(){for(var e=0;e<G;++e){var t=Q[e];t&&(t.bindCount=0,t.unit=-1,Q[e]=null),n.activeTexture(yr+e),n.bindTexture(mn,null),n.bindTexture(pn,null)}}return t(K.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<G;++r){var a=Q[r];if(a){if(a.bindCount>0)continue;a.unit=-1}Q[r]=e,t=r;break}t>=G&&ne.raise("insufficient number of texture units"),s.profile&&u.maxTextureUnits<t+1&&(u.maxTextureUnits=t+1),e.unit=t,n.activeTexture(yr+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&J(this)}}),s.profile&&(u.getTotalTextureSize=function(){var e=0;return Object.keys(H).forEach((function(t){e+=H[t].stats.size})),e}),{create2D:ee,createCube:te,clear:re,getTexture:function(e){return null},restore:ae,refresh:ie}}Cr[Mn]=2,Cr[An]=2,Cr[En]=2,Cr[Dn]=4,Cr[In]=.5,Cr[Rn]=.5,Cr[Fn]=1,Cr[zn]=1,Cr[Ln]=.5,Cr[qn]=1,Cr[Bn]=1,Cr[Vn]=.5,Cr[Nn]=.25,Cr[Yn]=.5,Cr[Un]=.25,Cr[Xn]=.5;var Kr=36161,$r=32854,Zr=32855,Jr=36194,ea=33189,ta=36168,na=34041,ra=35907,aa=34836,ia=34842,oa=34843,ua=[];function sa(e,t,n){return ua[e]*t*n}ua[$r]=2,ua[Zr]=2,ua[Jr]=2,ua[ea]=2,ua[ta]=1,ua[na]=4,ua[ra]=4,ua[aa]=16,ua[ia]=8,ua[oa]=6;var fa=function(e,t,n,r,a){var i={rgba4:$r,rgb565:Jr,"rgb5 a1":Zr,depth:ea,stencil:ta,"depth stencil":na};t.ext_srgb&&(i.srgba=ra),t.ext_color_buffer_half_float&&(i.rgba16f=ia,i.rgb16f=oa),t.webgl_color_buffer_float&&(i.rgba32f=aa);var o=[];Object.keys(i).forEach((function(e){var t=i[e];o[t]=e}));var u=0,s={};function f(e){this.id=u++,this.refCount=1,this.renderbuffer=e,this.format=$r,this.width=0,this.height=0,a.profile&&(this.stats={size:0})}function c(t){var n=t.renderbuffer;ne(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(Kr,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete s[t.id],r.renderbufferCount--}function l(t,u){var c=new f(e.createRenderbuffer());function l(t,r){var u=0,s=0,f=$r;if("object"==typeof t&&t){var h=t;if("shape"in h){var d=h.shape;ne(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),u=0|d[0],s=0|d[1]}else"radius"in h&&(u=s=0|h.radius),"width"in h&&(u=0|h.width),"height"in h&&(s=0|h.height);"format"in h&&(ne.parameter(h.format,i,"invalid renderbuffer format"),f=i[h.format])}else"number"==typeof t?(u=0|t,s="number"==typeof r?0|r:u):t?ne.raise("invalid arguments to renderbuffer constructor"):u=s=1;if(ne(u>0&&s>0&&u<=n.maxRenderbufferSize&&s<=n.maxRenderbufferSize,"invalid renderbuffer size"),u!==c.width||s!==c.height||f!==c.format)return l.width=c.width=u,l.height=c.height=s,c.format=f,e.bindRenderbuffer(Kr,c.renderbuffer),e.renderbufferStorage(Kr,f,u,s),ne(0===e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=sa(c.format,c.width,c.height)),l.format=o[c.format],l}function h(t,r){var i=0|t,o=0|r||i;return i===c.width&&o===c.height||(ne(i>0&&o>0&&i<=n.maxRenderbufferSize&&o<=n.maxRenderbufferSize,"invalid renderbuffer size"),l.width=c.width=i,l.height=c.height=o,e.bindRenderbuffer(Kr,c.renderbuffer),e.renderbufferStorage(Kr,c.format,i,o),ne(0===e.getError(),"invalid render buffer format"),a.profile&&(c.stats.size=sa(c.format,c.width,c.height))),l}return s[c.id]=c,r.renderbufferCount++,l(t,u),l.resize=h,l._reglType="renderbuffer",l._renderbuffer=c,a.profile&&(l.stats=c.stats),l.destroy=function(){c.decRef()},l}function h(){Et(s).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(Kr,t.renderbuffer),e.renderbufferStorage(Kr,t.format,t.width,t.height)})),e.bindRenderbuffer(Kr,null)}return f.prototype.decRef=function(){--this.refCount<=0&&c(this)},a.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(s).forEach((function(t){e+=s[t].stats.size})),e}),{create:l,clear:function(){Et(s).forEach(c)},restore:h}},ca=36160,la=36161,ha=3553,da=34069,ma=36064,pa=36096,va=36128,ba=33306,ga=36053,ya=36054,xa=36055,wa=36057,Ma=36061,Aa=36193,Ea=5121,_a=5126,Sa=6407,Ta=6408,Oa=6402,ka=[Sa,Ta],Da=[];Da[Ta]=4,Da[Sa]=3;var ja=[];ja[Ea]=1,ja[_a]=4,ja[Aa]=2;var Ca=33189,Pa=36168,Ia=34041,Ra=[32854,32855,36194,35907,34842,34843,34836],Fa={};function za(e,n,r,a,i,o){var u={cur:null,next:null,dirty:!1,setFBO:null},s=["rgba"],f=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&f.push("srgba"),n.ext_color_buffer_half_float&&f.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&f.push("rgba32f");var c=["uint8"];function l(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,a=0;t?(r=t.width,a=t.height):n&&(r=n.width,a=n.height),this.width=r,this.height=a}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,a=Math.max(1,r.width),i=Math.max(1,r.height);ne(a===t&&i===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var o=e.renderbuffer._renderbuffer;ne(o.width===t&&o.height===n,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function m(t,n){n&&(n.texture?e.framebufferTexture2D(ca,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(ca,t,la,n.renderbuffer._renderbuffer.renderbuffer))}function p(e){var t=ha,n=null,r=null,a=e;"object"==typeof e&&(a=e.data,"target"in e&&(t=0|e.target)),ne.type(a,"function","invalid attachment data");var i=a._reglType;return"texture2d"===i?(n=a,ne(t===ha)):"textureCube"===i?(n=a,ne(t>=da&&t<da+6,"invalid cube map target")):"renderbuffer"===i?(r=a,t=la):ne.raise("invalid regl object for attachment"),new l(t,n,r)}function v(e,t,n,r,o){if(n){var u=a.create2D({width:e,height:t,format:r,type:o});return u._texture.refCount=0,new l(ha,u,null)}var s=i.create({width:e,height:t,format:r});return s._renderbuffer.refCount=0,new l(la,null,s)}function b(e){return e&&(e.texture||e.renderbuffer)}function g(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&c.push("half float","float16"),n.oes_texture_float&&c.push("float","float32");var y=0,x={};function w(){this.id=y++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function M(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function A(t){var n=t.framebuffer;ne(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,o.framebufferCount--,delete x[t.id]}function E(t){var n;e.bindFramebuffer(ca,t.framebuffer);var a=t.colorAttachments;for(n=0;n<a.length;++n)m(ma+n,a[n]);for(n=a.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(ca,ma+n,ha,null,0);e.framebufferTexture2D(ca,ba,ha,null,0),e.framebufferTexture2D(ca,pa,ha,null,0),e.framebufferTexture2D(ca,va,ha,null,0),m(pa,t.depthAttachment),m(va,t.stencilAttachment),m(ba,t.depthStencilAttachment);var i=e.checkFramebufferStatus(ca);e.isContextLost()||i===ga||ne.raise("framebuffer configuration not supported, status = "+Fa[i]),e.bindFramebuffer(ca,u.next?u.next.framebuffer:null),u.cur=u.next,e.getError()}function _(e,a){var i=new w;function l(e,t){var a;ne(u.next!==i,"can not update framebuffer which is currently in use");var o=0,h=0,m=!0,g=!0,y=null,x=!0,w="rgba",A="uint8",_=1,S=null,T=null,O=null,k=!1;if("number"==typeof e)o=0|e,h=0|t||o;else if(e){ne.type(e,"object","invalid arguments for framebuffer");var D=e;if("shape"in D){var j=D.shape;ne(Array.isArray(j)&&j.length>=2,"invalid shape for framebuffer"),o=j[0],h=j[1]}else"radius"in D&&(o=h=D.radius),"width"in D&&(o=D.width),"height"in D&&(h=D.height);("color"in D||"colors"in D)&&(y=D.color||D.colors,Array.isArray(y)&&ne(1===y.length||n.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in D&&(_=0|D.colorCount,ne(_>0,"invalid color buffer count")),"colorTexture"in D&&(x=!!D.colorTexture,w="rgba4"),"colorType"in D&&(A=D.colorType,x?(ne(n.oes_texture_float||!("float"===A||"float32"===A),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ne(n.oes_texture_half_float||!("half float"===A||"float16"===A),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===A||"float16"===A?(ne(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),w="rgba16f"):"float"!==A&&"float32"!==A||(ne(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),w="rgba32f"),ne.oneOf(A,c,"invalid color type")),"colorFormat"in D&&(w=D.colorFormat,s.indexOf(w)>=0?x=!0:f.indexOf(w)>=0?x=!1:ne.optional((function(){x?ne.oneOf(D.colorFormat,s,"invalid color format for texture"):ne.oneOf(D.colorFormat,f,"invalid color format for renderbuffer")})))),("depthTexture"in D||"depthStencilTexture"in D)&&(k=!(!D.depthTexture&&!D.depthStencilTexture),ne(!k||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in D&&("boolean"==typeof D.depth?m=D.depth:(S=D.depth,g=!1)),"stencil"in D&&("boolean"==typeof D.stencil?g=D.stencil:(T=D.stencil,m=!1)),"depthStencil"in D&&("boolean"==typeof D.depthStencil?m=g=D.depthStencil:(O=D.depthStencil,m=!1,g=!1))}else o=h=1;var C=null,P=null,I=null,R=null;if(Array.isArray(y))C=y.map(p);else if(y)C=[p(y)];else for(C=new Array(_),a=0;a<_;++a)C[a]=v(o,h,x,w,A);ne(n.webgl_draw_buffers||C.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ne(C.length<=r.maxColorAttachments,"too many color attachments, not supported"),o=o||C[0].width,h=h||C[0].height,S?P=p(S):m&&!g&&(P=v(o,h,k,"depth","uint32")),T?I=p(T):g&&!m&&(I=v(o,h,!1,"stencil","uint8")),O?R=p(O):!S&&!T&&g&&m&&(R=v(o,h,k,"depth stencil","depth stencil")),ne(!!S+!!T+!!O<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var F=null;for(a=0;a<C.length;++a)if(d(C[a],o,h),ne(!C[a]||C[a].texture&&ka.indexOf(C[a].texture._texture.format)>=0||C[a].renderbuffer&&Ra.indexOf(C[a].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+a+" is invalid"),C[a]&&C[a].texture){var z=Da[C[a].texture._texture.format]*ja[C[a].texture._texture.type];null===F?F=z:ne(F===z,"all color attachments much have the same number of bits per pixel.")}return d(P,o,h),ne(!P||P.texture&&P.texture._texture.format===Oa||P.renderbuffer&&P.renderbuffer._renderbuffer.format===Ca,"invalid depth attachment for framebuffer object"),d(I,o,h),ne(!I||I.renderbuffer&&I.renderbuffer._renderbuffer.format===Pa,"invalid stencil attachment for framebuffer object"),d(R,o,h),ne(!R||R.texture&&R.texture._texture.format===Ia||R.renderbuffer&&R.renderbuffer._renderbuffer.format===Ia,"invalid depth-stencil attachment for framebuffer object"),M(i),i.width=o,i.height=h,i.colorAttachments=C,i.depthAttachment=P,i.stencilAttachment=I,i.depthStencilAttachment=R,l.color=C.map(b),l.depth=b(P),l.stencil=b(I),l.depthStencil=b(R),l.width=i.width,l.height=i.height,E(i),l}function h(e,t){ne(u.next!==i,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===i.width&&r===i.height)return l;for(var a=i.colorAttachments,o=0;o<a.length;++o)g(a[o],n,r);return g(i.depthAttachment,n,r),g(i.stencilAttachment,n,r),g(i.depthStencilAttachment,n,r),i.width=l.width=n,i.height=l.height=r,E(i),l}return o.framebufferCount++,l(e,a),t(l,{resize:h,_reglType:"framebuffer",_framebuffer:i,destroy:function(){A(i),M(i)},use:function(e){u.setFBO({framebuffer:l},e)}})}function S(e){var i=Array(6);function o(e){var r;ne(i.indexOf(u.next)<0,"can not update framebuffer which is currently in use");var f,l={color:null},h=0,d=null,m="rgba",p="uint8",v=1;if("number"==typeof e)h=0|e;else if(e){ne.type(e,"object","invalid arguments for framebuffer");var b=e;if("shape"in b){var g=b.shape;ne(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),ne(g[0]===g[1],"cube framebuffer must be square"),h=g[0]}else"radius"in b&&(h=0|b.radius),"width"in b?(h=0|b.width,"height"in b&&ne(b.height===h,"must be square")):"height"in b&&(h=0|b.height);("color"in b||"colors"in b)&&(d=b.color||b.colors,Array.isArray(d)&&ne(1===d.length||n.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in b&&(v=0|b.colorCount,ne(v>0,"invalid color buffer count")),"colorType"in b&&(ne.oneOf(b.colorType,c,"invalid color type"),p=b.colorType),"colorFormat"in b&&(m=b.colorFormat,ne.oneOf(b.colorFormat,s,"invalid color format for texture"))),"depth"in b&&(l.depth=b.depth),"stencil"in b&&(l.stencil=b.stencil),"depthStencil"in b&&(l.depthStencil=b.depthStencil)}else h=1;if(d)if(Array.isArray(d))for(f=[],r=0;r<d.length;++r)f[r]=d[r];else f=[d];else{f=Array(v);var y={radius:h,format:m,type:p};for(r=0;r<v;++r)f[r]=a.createCube(y)}for(l.color=Array(f.length),r=0;r<f.length;++r){var x=f[r];ne("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),h=h||x.width,ne(x.width===h&&x.height===h,"invalid cube map shape"),l.color[r]={target:da,data:f[r]}}for(r=0;r<6;++r){for(var w=0;w<f.length;++w)l.color[w].target=da+r;r>0&&(l.depth=i[0].depth,l.stencil=i[0].stencil,l.depthStencil=i[0].depthStencil),i[r]?i[r](l):i[r]=_(l)}return t(o,{width:h,height:h,color:f})}function f(e){var t,n=0|e;if(ne(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===o.width)return o;var a=o.color;for(t=0;t<a.length;++t)a[t].resize(n);for(t=0;t<6;++t)i[t].resize(n);return o.width=o.height=n,o}return o(e),t(o,{faces:i,resize:f,_reglType:"framebufferCube",destroy:function(){i.forEach((function(e){e.destroy()}))}})}function T(){u.cur=null,u.next=null,u.dirty=!0,Et(x).forEach((function(t){t.framebuffer=e.createFramebuffer(),E(t)}))}return t(u,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof w)return t}return null},create:_,createCube:S,clear:function(){Et(x).forEach(A)},restore:T})}Fa[ga]="complete",Fa[ya]="incomplete attachment",Fa[wa]="incomplete dimensions",Fa[xa]="incomplete, missing attachment",Fa[Ma]="unsupported";var La=5126,qa=34962,Ba=34963,Va=["attributes","elements","offset","count","primitive","instances"];function Na(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=La,this.offset=0,this.stride=0,this.divisor=0}function Ya(t,n,r,a,i,o,u){for(var s=r.maxAttributes,f=new Array(s),c=0;c<s;++c)f[c]=new Na;var l=0,h={},d={Record:Na,scope:{},state:f,currentVAO:null,targetVAO:null,restore:p()?M:function(){},createVAO:A,getVAO:b,destroyBuffer:m,setVAO:p()?g:y,clear:p()?x:function(){}};function m(e){for(var n=0;n<f.length;++n){var r=f[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}}function p(){return n.oes_vertex_array_object}function v(){return n.angle_instanced_arrays}function b(e){return"function"==typeof e&&e._vao?e._vao:null}function g(e){if(e!==d.currentVAO){var t=p();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),d.currentVAO=e}}function y(e){if(e!==d.currentVAO){if(e)e.bindAttrs();else{for(var n=v(),r=0;r<f.length;++r){var a=f[r];a.buffer?(t.enableVertexAttribArray(r),a.buffer.bind(),t.vertexAttribPointer(r,a.size,a.type,a.normalized,a.stride,a.offfset),n&&a.divisor&&n.vertexAttribDivisorANGLE(r,a.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,a.x,a.y,a.z,a.w))}u.elements?t.bindBuffer(Ba,u.elements.buffer.buffer):t.bindBuffer(Ba,null)}d.currentVAO=e}}function x(){Et(h).forEach((function(e){e.destroy()}))}function w(){this.id=++l,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var e=p();this.vao=e?e.createVertexArrayOES():null,h[this.id]=this,this.buffers=[]}function M(){p()&&Et(h).forEach((function(e){e.refresh()}))}function A(t){var r=new w;function u(t){var a;if(Array.isArray(t))a=t,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(ne("object"==typeof t,"invalid arguments for create vao"),ne("attributes"in t,"must specify attributes for vao"),t.elements){var f=t.elements;r.ownsElements?"function"==typeof f&&"elements"===f._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(f),r.ownsElements=!1):o.getElements(t.elements)?(r.elements=t.elements,r.ownsElements=!1):(r.elements=o.create(t.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;a=t.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in t&&(r.offset=0|t.offset),"count"in t&&(r.count=0|t.count),"instances"in t&&(r.instances=0|t.instances),"primitive"in t&&(ne(t.primitive in Wt,"bad primitive type: "+t.primitive),r.primitive=Wt[t.primitive]),ne.optional((()=>{for(var e=Object.keys(t),n=0;n<e.length;++n)ne(Va.indexOf(e[n])>=0,'invalid option for vao: "'+e[n]+'" valid options are '+Va)})),ne(Array.isArray(a),"attributes must be an array")}ne(a.length<s,"too many attributes"),ne(a.length>0,"must specify at least one attribute");var c={},l=r.attributes;l.length=a.length;for(var h=0;h<a.length;++h){var d,m=a[h],p=l[h]=new Na,v=m.data||m;Array.isArray(v)||e(v)||At(v)?(r.buffers[h]&&(d=r.buffers[h],e(v)&&d._buffer.byteLength>=v.byteLength?d.subdata(v):(d.destroy(),r.buffers[h]=null)),r.buffers[h]||(d=r.buffers[h]=i.create(m,qa,!1,!0)),p.buffer=i.getBuffer(d),p.size=0|p.buffer.dimension,p.normalized=!1,p.type=p.buffer.dtype,p.offset=0,p.stride=0,p.divisor=0,p.state=1,c[h]=1):i.getBuffer(m)?(p.buffer=i.getBuffer(m),p.size=0|p.buffer.dimension,p.normalized=!1,p.type=p.buffer.dtype,p.offset=0,p.stride=0,p.divisor=0,p.state=1):i.getBuffer(m.buffer)?(p.buffer=i.getBuffer(m.buffer),p.size=0|(+m.size||p.buffer.dimension),p.normalized=!!m.normalized||!1,"type"in m?(ne.parameter(m.type,Pt,"invalid buffer type"),p.type=Pt[m.type]):p.type=p.buffer.dtype,p.offset=0|(m.offset||0),p.stride=0|(m.stride||0),p.divisor=0|(m.divisor||0),p.state=1,ne(p.size>=1&&p.size<=4,"size must be between 1 and 4"),ne(p.offset>=0,"invalid offset"),ne(p.stride>=0&&p.stride<=255,"stride must be between 0 and 255"),ne(p.divisor>=0,"divisor must be positive"),ne(!p.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in m?(ne(h>0,"first attribute must not be a constant"),p.x=+m.x||0,p.y=+m.y||0,p.z=+m.z||0,p.w=+m.w||0,p.state=2):ne(!1,"invalid attribute spec for location "+h)}for(var b=0;b<r.buffers.length;++b)!c[b]&&r.buffers[b]&&(r.buffers[b].destroy(),r.buffers[b]=null);return r.refresh(),u}return a.vaoCount+=1,u.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},u._vao=r,u._reglType="vao",u(t)}return w.prototype.bindAttrs=function(){for(var e=v(),n=this.attributes,r=0;r<n.length;++r){var a=n[r];a.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(qa,a.buffer.buffer),t.vertexAttribPointer(r,a.size,a.type,a.normalized,a.stride,a.offset),e&&a.divisor&&e.vertexAttribDivisorANGLE(r,a.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,a.x,a.y,a.z,a.w))}for(var i=n.length;i<s;++i)t.disableVertexAttribArray(i);var u=o.getElements(this.elements);u?t.bindBuffer(Ba,u.buffer.buffer):t.bindBuffer(Ba,null)},w.prototype.refresh=function(){var e=p();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),d.currentVAO=null,e.bindVertexArrayOES(null))},w.prototype.destroy=function(){if(this.vao){var e=p();this===d.currentVAO&&(d.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),h[this.id]&&(delete h[this.id],a.vaoCount-=1)},d}var Ua=35632,Xa=35633,Wa=35718,Ha=35721;function Ga(e,n,r,a){var i={},o={};function u(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function s(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function f(t,r,a){var u=t===Ua?i:o,s=u[r];if(!s){var f=n.str(r);s=e.createShader(t),e.shaderSource(s,f),e.compileShader(s),ne.shaderError(e,s,f,t,a),u[r]=s}return s}var c={},l=[],h=0;function d(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,a.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function m(t,r,i){var o,c,l=f(Ua,t.fragId),h=f(Xa,t.vertId),d=t.program=e.createProgram();if(e.attachShader(d,l),e.attachShader(d,h),i)for(o=0;o<i.length;++o){var m=i[o];e.bindAttribLocation(d,m[0],m[1])}e.linkProgram(d),ne.linkError(e,d,n.str(t.fragId),n.str(t.vertId),r);var p=e.getProgramParameter(d,Wa);a.profile&&(t.stats.uniformsCount=p);var v=t.uniforms;for(o=0;o<p;++o)if(c=e.getActiveUniform(d,o)){if(c.size>1)for(var b=0;b<c.size;++b){var g=c.name.replace("[0]","["+b+"]");s(v,new u(g,n.id(g),e.getUniformLocation(d,g),c))}var y=c.name;c.size>1&&(y=y.replace("[0]","")),s(v,new u(y,n.id(y),e.getUniformLocation(d,y),c))}var x=e.getProgramParameter(d,Ha);a.profile&&(t.stats.attributesCount=x);var w=t.attributes;for(o=0;o<x;++o)(c=e.getActiveAttrib(d,o))&&s(w,new u(c.name,n.id(c.name),e.getAttribLocation(d,c.name),c))}function p(){i={},o={};for(var e=0;e<l.length;++e)m(l[e],null,l[e].attributes.map((function(e){return[e.location,e.name]})))}return a.profile&&(r.getMaxUniformsCount=function(){var e=0;return l.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return l.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);Et(i).forEach(t),i={},Et(o).forEach(t),o={},l.forEach((function(t){e.deleteProgram(t.program)})),l.length=0,c={},r.shaderCount=0},program:function(n,a,u,s){ne.command(n>=0,"missing vertex shader",u),ne.command(a>=0,"missing fragment shader",u);var f=c[a];f||(f=c[a]={});var h=f[n];if(h&&(h.refCount++,!s))return h;var p=new d(a,n);return r.shaderCount++,m(p,u,s),h||(f[n]=p),l.push(p),t(p,{destroy:function(){if(p.refCount--,p.refCount<=0){e.deleteProgram(p.program);var t=l.indexOf(p);l.splice(t,1),r.shaderCount--}f[p.vertId].refCount<=0&&(e.deleteShader(o[p.vertId]),delete o[p.vertId],delete c[p.fragId][p.vertId]),Object.keys(c[p.fragId]).length||(e.deleteShader(i[p.fragId]),delete i[p.fragId],delete c[p.fragId])}})},restore:p,shader:f,frag:-1,vert:-1}}var Qa=6408,Ka=5121,$a=3333,Za=5126;function Ja(t,n,r,a,i,o,u){function s(s){var f;null===n.next?(ne(i.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),f=Ka):(ne(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),f=n.next.colorAttachments[0].texture._texture.type,ne.optional((function(){o.oes_texture_float?(ne(f===Ka||f===Za,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),f===Za&&ne(u.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ne(f===Ka,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,l=0,h=a.framebufferWidth,d=a.framebufferHeight,m=null;e(s)?m=s:s&&(ne.type(s,"object","invalid arguments to regl.read()"),c=0|s.x,l=0|s.y,ne(c>=0&&c<a.framebufferWidth,"invalid x offset for regl.read"),ne(l>=0&&l<a.framebufferHeight,"invalid y offset for regl.read"),h=0|(s.width||a.framebufferWidth-c),d=0|(s.height||a.framebufferHeight-l),m=s.data||null),m&&(f===Ka?ne(m instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):f===Za&&ne(m instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ne(h>0&&h+c<=a.framebufferWidth,"invalid width for read pixels"),ne(d>0&&d+l<=a.framebufferHeight,"invalid height for read pixels"),r();var p=h*d*4;return m||(f===Ka?m=new Uint8Array(p):f===Za&&(m=m||new Float32Array(p))),ne.isTypedArray(m,"data buffer for regl.read() must be a typedarray"),ne(m.byteLength>=p,"data buffer for regl.read() too small"),t.pixelStorei($a,4),t.readPixels(c,l,h,d,Qa,f,m),m}function f(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=s(e)})),t}function c(e){return e&&"framebuffer"in e?f(e):s(e)}return c}function ei(e){return Array.prototype.slice.call(e)}function ti(e){return ei(e).join("")}function ni(){var e=0,n=[],r=[];function a(t){for(var a=0;a<r.length;++a)if(r[a]===t)return n[a];var i="g"+e++;return n.push(i),r.push(t),i}function i(){var n=[];function r(){n.push.apply(n,ei(arguments))}var a=[];function i(){var t="v"+e++;return a.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,ei(arguments)),n.push(";")),t}return t(r,{def:i,toString:function(){return ti([a.length>0?"var "+a.join(",")+";":"",ti(n)])}})}function o(){var e=i(),n=i(),r=e.toString,a=n.toString;function o(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,ei(arguments))}),{def:e.def,entry:e,exit:n,save:o,set:function(t,n,r){o(t,n),e(t,n,"=",r,";")},toString:function(){return r()+a()}})}function u(){var e=ti(arguments),n=o(),r=o(),a=n.toString,i=r.toString;return t(n,{then:function(){return n.apply(n,ei(arguments)),this},else:function(){return r.apply(r,ei(arguments)),this},toString:function(){var t=i();return t&&(t="else{"+t+"}"),ti(["if(",e,"){",a(),"}",t])}})}var s=i(),f={};function c(e,n){var r=[];function a(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var i=0;i<n;++i)a();var u=o(),s=u.toString;return f[e]=t(u,{arg:a,toString:function(){return ti(["function(",r.join(),"){",s(),"}"])}})}function l(){var e=['"use strict";',s,"return {"];Object.keys(f).forEach((function(t){e.push('"',t,'":',f[t].toString(),",")})),e.push("}");var t=ti(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}return{global:s,link:a,block:i,proc:c,scope:o,cond:u,compile:l}}var ri="xyzw".split(""),ai=5121,ii=1,oi=2,ui=0,si=1,fi=2,ci=3,li=4,hi=5,di=6,mi="dither",pi="blend.enable",vi="blend.color",bi="blend.equation",gi="blend.func",yi="depth.enable",xi="depth.func",wi="depth.range",Mi="depth.mask",Ai="colorMask",Ei="cull.enable",_i="cull.face",Si="frontFace",Ti="lineWidth",Oi="polygonOffset.enable",ki="polygonOffset.offset",Di="sample.alpha",ji="sample.enable",Ci="sample.coverage",Pi="stencil.enable",Ii="stencil.mask",Ri="stencil.func",Fi="stencil.opFront",zi="stencil.opBack",Li="scissor.enable",qi="scissor.box",Bi="viewport",Vi="profile",Ni="framebuffer",Yi="vert",Ui="frag",Xi="elements",Wi="primitive",Hi="count",Gi="offset",Qi="instances",Ki="vao",$i="Width",Zi="Height",Ji=Ni+$i,eo=Ni+Zi,to=Bi+$i,no=Bi+Zi,ro="drawingBuffer",ao=ro+$i,io=ro+Zi,oo=[gi,bi,Ri,Fi,zi,Ci,Bi,qi,ki],uo=34962,so=34963,fo=3553,co=34067,lo=2884,ho=3042,mo=3024,po=2960,vo=2929,bo=3089,go=32823,yo=32926,xo=32928,wo=5126,Mo=35664,Ao=35665,Eo=35666,_o=5124,So=35667,To=35668,Oo=35669,ko=35670,Do=35671,jo=35672,Co=35673,Po=35674,Io=35675,Ro=35676,Fo=35678,zo=35680,Lo=4,qo=1028,Bo=1029,Vo=2304,No=2305,Yo=32775,Uo=32776,Xo=519,Wo=7680,Ho=0,Go=1,Qo=32774,Ko=513,$o=36160,Zo=36064,Jo={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},eu=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],tu={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},nu={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ru={frag:35632,vert:35633},au={cw:Vo,ccw:No};function iu(t){return Array.isArray(t)||e(t)||At(t)}function ou(e){return e.sort((function(e,t){return e===Bi?-1:t===Bi?1:e<t?-1:1}))}function uu(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function su(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function fu(e){return new uu(!1,!1,!1,e)}function cu(e,t){var n=e.type;if(n===ui){var r=e.data.length;return new uu(!0,r>=1,r>=2,t)}if(n===li){var a=e.data;return new uu(a.thisDep,a.contextDep,a.propDep,t)}if(n===hi)return new uu(!1,!1,!1,t);if(n===di){for(var i=!1,o=!1,u=!1,s=0;s<e.data.length;++s){var f=e.data[s];if(f.type===si)u=!0;else if(f.type===fi)o=!0;else if(f.type===ci)i=!0;else if(f.type===ui){i=!0;var c=f.data;c>=1&&(o=!0),c>=2&&(u=!0)}else f.type===li&&(i=i||f.data.thisDep,o=o||f.data.contextDep,u=u||f.data.propDep)}return new uu(i,o,u,t)}return new uu(n===ci,n===fi,n===si,t)}var lu=new uu(!1,!1,!1,(function(){}));function hu(e,n,r,a,i,o,u,s,f,c,l,h,d,m,p){var v=c.Record,b={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(b.min=Yo,b.max=Uo);var g=r.angle_instanced_arrays,y=r.webgl_draw_buffers,x=r.oes_vertex_array_object,w={dirty:!0,profile:p.profile},M={},A=[],E={},_={};function S(e){return e.replace(".","_")}function T(e,t,n){var r=S(e);A.push(e),M[r]=w[r]=!!n,E[r]=t}function O(e,t,n){var r=S(e);A.push(e),Array.isArray(n)?(w[r]=n.slice(),M[r]=n.slice()):w[r]=M[r]=n,_[r]=t}T(mi,mo),T(pi,ho),O(vi,"blendColor",[0,0,0,0]),O(bi,"blendEquationSeparate",[Qo,Qo]),O(gi,"blendFuncSeparate",[Go,Ho,Go,Ho]),T(yi,vo,!0),O(xi,"depthFunc",Ko),O(wi,"depthRange",[0,1]),O(Mi,"depthMask",!0),O(Ai,Ai,[!0,!0,!0,!0]),T(Ei,lo),O(_i,"cullFace",Bo),O(Si,Si,No),O(Ti,Ti,1),T(Oi,go),O(ki,"polygonOffset",[0,0]),T(Di,yo),T(ji,xo),O(Ci,"sampleCoverage",[1,!1]),T(Pi,po),O(Ii,"stencilMask",-1),O(Ri,"stencilFunc",[Xo,0,-1]),O(Fi,"stencilOpSeparate",[qo,Wo,Wo,Wo]),O(zi,"stencilOpSeparate",[Bo,Wo,Wo,Wo]),T(Li,bo),O(qi,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),O(Bi,Bi,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var k={gl:e,context:d,strings:n,next:M,current:w,draw:h,elements:o,buffer:i,shader:l,attributes:c.state,vao:c,uniforms:f,framebuffer:s,extensions:r,timer:m,isBufferArgs:iu},D={primTypes:Wt,compareFuncs:tu,blendFuncs:Jo,blendEquations:b,stencilOps:nu,glTypes:Pt,orientationType:au};ne.optional((function(){k.isArrayLike=ln})),y&&(D.backBuffer=[Bo],D.drawBuffer=Se(a.maxDrawbuffers,(function(e){return 0===e?[0]:Se(e,(function(e){return Zo+e}))})));var j=0;function C(){var e=ni(),t=e.link,r=e.global;e.id=j++,e.batchId="0";var a=t(k),i=e.shared={props:"a0"};Object.keys(k).forEach((function(e){i[e]=r.def(a,".",e)})),ne.optional((function(){e.CHECK=t(ne),e.commandStr=ne.guessCommand(),e.command=t(e.commandStr),e.assert=function(e,n,r){e("if(!(",n,"))",this.CHECK,".commandRaise(",t(r),",",this.command,");")},D.invalidBlendCombinations=eu}));var o=e.next={},u=e.current={};Object.keys(_).forEach((function(e){Array.isArray(w[e])&&(o[e]=r.def(i.next,".",e),u[e]=r.def(i.current,".",e))}));var s=e.constants={};Object.keys(D).forEach((function(e){s[e]=r.def(JSON.stringify(D[e]))})),e.invoke=function(n,r){switch(r.type){case ui:var a=["this",i.context,i.props,e.batchId];return n.def(t(r.data),".call(",a.slice(0,Math.max(r.data.length+1,4)),")");case si:return n.def(i.props,r.data);case fi:return n.def(i.context,r.data);case ci:return n.def("this",r.data);case li:return r.data.append(e,n),r.data.ref;case hi:return r.data.toString();case di:return r.data.map((function(t){return e.invoke(n,t)}))}},e.attribCache={};var f={};return e.scopeAttrib=function(e){var r=n.id(e);if(r in f)return f[r];var a=c.scope[r];return a||(a=c.scope[r]=new v),f[r]=t(a)},e}function P(e){var t,n=e.static,r=e.dynamic;if(Vi in n){var a=!!n[Vi];(t=fu((function(e,t){return a}))).enable=a}else if(Vi in r){var i=r[Vi];t=cu(i,(function(e,t){return e.invoke(t,i)}))}return t}function I(e,t){var n=e.static,r=e.dynamic;if(Ni in n){var a=n[Ni];return a?(a=s.getFramebuffer(a),ne.command(a,"invalid framebuffer object"),fu((function(e,t){var n=e.link(a),r=e.shared;t.set(r.framebuffer,".next",n);var i=r.context;return t.set(i,"."+Ji,n+".width"),t.set(i,"."+eo,n+".height"),n}))):fu((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Ji,r+"."+ao),t.set(r,"."+eo,r+"."+io),"null"}))}if(Ni in r){var i=r[Ni];return cu(i,(function(e,t){var n=e.invoke(t,i),r=e.shared,a=r.framebuffer,o=t.def(a,".getFramebuffer(",n,")");ne.optional((function(){e.assert(t,"!"+n+"||"+o,"invalid framebuffer object")})),t.set(a,".next",o);var u=r.context;return t.set(u,"."+Ji,o+"?"+o+".width:"+u+"."+ao),t.set(u,"."+eo,o+"?"+o+".height:"+u+"."+io),o}))}return null}function R(e,t,n){var r=e.static,a=e.dynamic;function i(e){if(e in r){var i=r[e];ne.commandType(i,"object","invalid "+e,n.commandStr);var o,u,s=!0,f=0|i.x,c=0|i.y;return"width"in i?(o=0|i.width,ne.command(o>=0,"invalid "+e,n.commandStr)):s=!1,"height"in i?(u=0|i.height,ne.command(u>=0,"invalid "+e,n.commandStr)):s=!1,new uu(!s&&t&&t.thisDep,!s&&t&&t.contextDep,!s&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=o;"width"in i||(r=t.def(n,".",Ji,"-",f));var a=u;return"height"in i||(a=t.def(n,".",eo,"-",c)),[f,c,r,a]}))}if(e in a){var l=a[e],h=cu(l,(function(t,n){var r=t.invoke(n,l);ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var a=t.shared.context,i=n.def(r,".x|0"),o=n.def(r,".y|0"),u=n.def('"width" in ',r,"?",r,".width|0:","(",a,".",Ji,"-",i,")"),s=n.def('"height" in ',r,"?",r,".height|0:","(",a,".",eo,"-",o,")");return ne.optional((function(){t.assert(n,u+">=0&&"+s+">=0","invalid "+e)})),[i,o,u,s]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new uu(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Ji),t.def(n,".",eo)]})):null}var o=i(Bi);if(o){var u=o;o=new uu(o.thisDep,o.contextDep,o.propDep,(function(e,t){var n=u.append(e,t),r=e.shared.context;return t.set(r,"."+to,n[2]),t.set(r,"."+no,n[3]),n}))}return{viewport:o,scissor_box:i(qi)}}function F(e,t){var n=e.static;if("string"==typeof n[Ui]&&"string"==typeof n[Yi]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,a=Object.keys(r);if(a.length>0&&"number"==typeof r[a[0]]){for(var i=[],o=0;o<a.length;++o)ne("number"==typeof r[a[o]],"must specify all vertex attribute locations when using vaos"),i.push([0|r[a[o]],a[o]]);return i}}return null}function z(e,t,r){var a=e.static,i=e.dynamic;function o(e){if(e in a){var t=n.id(a[e]);ne.optional((function(){l.shader(ru[e],t,ne.guessCommand())}));var r=fu((function(){return t}));return r.id=t,r}if(e in i){var o=i[e];return cu(o,(function(t,n){var r=t.invoke(n,o),a=n.def(t.shared.strings,".id(",r,")");return ne.optional((function(){n(t.shared.shader,".shader(",ru[e],",",a,",",t.command,");")})),a}))}return null}var u,s=o(Ui),f=o(Yi),c=null;return su(s)&&su(f)?(c=l.program(f.id,s.id,null,r),u=fu((function(e,t){return e.link(c)}))):u=new uu(s&&s.thisDep||f&&f.thisDep,s&&s.contextDep||f&&f.contextDep,s&&s.propDep||f&&f.propDep,(function(e,t){var n,r=e.shared.shader;n=s?s.append(e,t):t.def(r,".",Ui);var a=r+".program("+(f?f.append(e,t):t.def(r,".",Yi))+","+n;return ne.optional((function(){a+=","+e.command})),t.def(a+")")})),{frag:s,vert:f,progVar:u,program:c}}function L(e,t){var n=e.static,r=e.dynamic,a={},i=!1;function u(){if(Ki in n){var e=n[Ki];return null!==e&&null===c.getVAO(e)&&(e=c.createVAO(e)),i=!0,a.vao=e,fu((function(t){var n=c.getVAO(e);return n?t.link(n):"null"}))}if(Ki in r){i=!0;var t=r[Ki];return cu(t,(function(e,n){var r=e.invoke(n,t);return n.def(e.shared.vao+".getVAO("+r+")")}))}return null}var s=u(),f=!1;function l(){if(Xi in n){var e=n[Xi];if(a.elements=e,iu(e)){var u=a.elements=o.create(e,!0);e=o.getElements(u),f=!0}else e&&(e=o.getElements(e),f=!0,ne.command(e,"invalid elements",t.commandStr));var c=fu((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return c.value=e,c}if(Xi in r){f=!0;var l=r[Xi];return cu(l,(function(e,t){var n=e.shared,r=n.isBufferArgs,a=n.elements,i=e.invoke(t,l),o=t.def("null"),u=t.def(r,"(",i,")"),s=e.cond(u).then(o,"=",a,".createStream(",i,");").else(o,"=",a,".getElements(",i,");");return ne.optional((function(){e.assert(s.else,"!"+i+"||"+o,"invalid elements")})),t.entry(s),t.exit(e.cond(u).then(a,".destroyStream(",o,");")),e.ELEMENTS=o,o}))}return i?new uu(s.thisDep,s.contextDep,s.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}var h=l();function d(){if(Wi in n){var e=n[Wi];return a.primitive=e,ne.commandParameter(e,Wt,"invalid primitve",t.commandStr),fu((function(t,n){return Wt[e]}))}if(Wi in r){var o=r[Wi];return cu(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return ne.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(Wt))})),t.def(n,"[",r,"]")}))}return f?su(h)?h.value?fu((function(e,t){return t.def(e.ELEMENTS,".primType")})):fu((function(){return Lo})):new uu(h.thisDep,h.contextDep,h.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",Lo)})):i?new uu(s.thisDep,s.contextDep,s.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:"+Lo)})):null}function m(e,o){if(e in n){var u=0|n[e];return o?a.offset=u:a.instances=u,ne.command(!o||u>=0,"invalid "+e,t.commandStr),fu((function(e,t){return o&&(e.OFFSET=u),u}))}if(e in r){var c=r[e];return cu(c,(function(t,n){var r=t.invoke(n,c);return o&&(t.OFFSET=r,ne.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}if(o){if(f)return fu((function(e,t){return e.OFFSET=0,0}));if(i)return new uu(s.thisDep,s.contextDep,s.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(i)return new uu(s.thisDep,s.contextDep,s.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var p=m(Gi,!0);function v(){if(Hi in n){var e=0|n[Hi];return a.count=e,ne.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),fu((function(){return e}))}if(Hi in r){var o=r[Hi];return cu(o,(function(e,t){var n=e.invoke(t,o);return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(f){if(su(h)){if(h)return p?new uu(p.thisDep,p.contextDep,p.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return ne.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):fu((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var u=fu((function(){return-1}));return ne.optional((function(){u.MISSING=!0})),u}var c=new uu(h.thisDep||p.thisDep,h.contextDep||p.contextDep,h.propDep||p.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return ne.optional((function(){c.DYNAMIC=!0})),c}return i?new uu(s.thisDep,s.contextDep,s.propDep,(function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")})):null}var b=d(),g=v(),y=m(Qi,!1);return{elements:h,primitive:b,count:g,instances:y,offset:p,vao:s,vaoActive:i,elementsActive:f,static:a}}function q(e,t){var n=e.static,r=e.dynamic,i={};return A.forEach((function(e){var o=S(e);function u(t,a){if(e in n){var u=t(n[e]);i[o]=fu((function(){return u}))}else if(e in r){var s=r[e];i[o]=cu(s,(function(e,t){return a(e,t,e.invoke(t,s))}))}}switch(e){case Ei:case pi:case mi:case Pi:case yi:case Li:case Oi:case Di:case ji:case Mi:return u((function(n){return ne.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return ne.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case xi:return u((function(n){return ne.commandParameter(n,tu,"invalid "+e,t.commandStr),tu[n]}),(function(t,n,r){var a=t.constants.compareFuncs;return ne.optional((function(){t.assert(n,r+" in "+a,"invalid "+e+", must be one of "+Object.keys(tu))})),n.def(a,"[",r,"]")}));case wi:return u((function(e){return ne.command(ln(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case gi:return u((function(e){ne.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,a="dstRGB"in e?e.dstRGB:e.dst,i="dstAlpha"in e?e.dstAlpha:e.dst;return ne.commandParameter(n,Jo,o+".srcRGB",t.commandStr),ne.commandParameter(r,Jo,o+".srcAlpha",t.commandStr),ne.commandParameter(a,Jo,o+".dstRGB",t.commandStr),ne.commandParameter(i,Jo,o+".dstAlpha",t.commandStr),ne.command(-1===eu.indexOf(n+", "+a),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+a+")",t.commandStr),[Jo[n],Jo[a],Jo[r],Jo[i]]}),(function(t,n,r){var a=t.constants.blendFuncs;function i(i,o){var u=n.def('"',i,o,'" in ',r,"?",r,".",i,o,":",r,".",i);return ne.optional((function(){t.assert(n,u+" in "+a,"invalid "+e+"."+i+o+", must be one of "+Object.keys(Jo))})),u}ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var o=i("src","RGB"),u=i("dst","RGB");ne.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+o+'+", "+'+u+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var s=n.def(a,"[",o,"]"),f=n.def(a,"[",i("src","Alpha"),"]");return[s,n.def(a,"[",u,"]"),f,n.def(a,"[",i("dst","Alpha"),"]")]}));case bi:return u((function(n){return"string"==typeof n?(ne.commandParameter(n,b,"invalid "+e,t.commandStr),[b[n],b[n]]):"object"==typeof n?(ne.commandParameter(n.rgb,b,e+".rgb",t.commandStr),ne.commandParameter(n.alpha,b,e+".alpha",t.commandStr),[b[n.rgb],b[n.alpha]]):void ne.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var a=t.constants.blendEquations,i=n.def(),o=n.def(),u=t.cond("typeof ",r,'==="string"');return ne.optional((function(){function n(e,n,r){t.assert(e,r+" in "+a,"invalid "+n+", must be one of "+Object.keys(b))}n(u.then,e,r),t.assert(u.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(u.else,e+".rgb",r+".rgb"),n(u.else,e+".alpha",r+".alpha")})),u.then(i,"=",o,"=",a,"[",r,"];"),u.else(i,"=",a,"[",r,".rgb];",o,"=",a,"[",r,".alpha];"),n(u),[i,o]}));case vi:return u((function(e){return ne.command(ln(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),Se(4,(function(t){return+e[t]}))}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Se(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case Ii:return u((function(e){return ne.commandType(e,"number",o,t.commandStr),0|e}),(function(e,t,n){return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case Ri:return u((function(n){ne.commandType(n,"object",o,t.commandStr);var r=n.cmp||"keep",a=n.ref||0,i="mask"in n?n.mask:-1;return ne.commandParameter(r,tu,e+".cmp",t.commandStr),ne.commandType(a,"number",e+".ref",t.commandStr),ne.commandType(i,"number",e+".mask",t.commandStr),[tu[r],a,i]}),(function(e,t,n){var r=e.constants.compareFuncs;return ne.optional((function(){function a(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}a(n+"&&typeof ",n,'==="object"'),a('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Wo),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Fi:case zi:return u((function(n){ne.commandType(n,"object",o,t.commandStr);var r=n.fail||"keep",a=n.zfail||"keep",i=n.zpass||"keep";return ne.commandParameter(r,nu,e+".fail",t.commandStr),ne.commandParameter(a,nu,e+".zfail",t.commandStr),ne.commandParameter(i,nu,e+".zpass",t.commandStr),[e===zi?Bo:qo,nu[r],nu[a],nu[i]]}),(function(t,n,r){var a=t.constants.stencilOps;function i(i){return ne.optional((function(){t.assert(n,'!("'+i+'" in '+r+")||("+r+"."+i+" in "+a+")","invalid "+e+"."+i+", must be one of "+Object.keys(nu))})),n.def('"',i,'" in ',r,"?",a,"[",r,".",i,"]:",Wo)}return ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===zi?Bo:qo,i("fail"),i("zfail"),i("zpass")]}));case ki:return u((function(e){ne.commandType(e,"object",o,t.commandStr);var n=0|e.factor,r=0|e.units;return ne.commandType(n,"number",o+".factor",t.commandStr),ne.commandType(r,"number",o+".units",t.commandStr),[n,r]}),(function(t,n,r){return ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case _i:return u((function(e){var n=0;return"front"===e?n=qo:"back"===e&&(n=Bo),ne.command(!!n,o,t.commandStr),n}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',qo,":",Bo)}));case Ti:return u((function(e){return ne.command("number"==typeof e&&e>=a.lineWidthDims[0]&&e<=a.lineWidthDims[1],"invalid line width, must be a positive number between "+a.lineWidthDims[0]+" and "+a.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+a.lineWidthDims[0]+"&&"+n+"<="+a.lineWidthDims[1],"invalid line width")})),n}));case Si:return u((function(e){return ne.commandParameter(e,au,o,t.commandStr),au[e]}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?'+Vo+":"+No)}));case Ai:return u((function(e){return ne.command(ln(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Se(4,(function(e){return"!!"+n+"["+e+"]"}))}));case Ci:return u((function(e){ne.command("object"==typeof e&&e,o,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return ne.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),i}function B(e,t){var n=e.static,r=e.dynamic,a={};return Object.keys(n).forEach((function(e){var r,i=n[e];if("number"==typeof i||"boolean"==typeof i)r=fu((function(){return i}));else if("function"==typeof i){var o=i._reglType;"texture2d"===o||"textureCube"===o?r=fu((function(e){return e.link(i)})):"framebuffer"===o||"framebufferCube"===o?(ne.command(i.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=fu((function(e){return e.link(i.color[0])}))):ne.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else ln(i)?r=fu((function(t){return t.global.def("[",Se(i.length,(function(n){return ne.command("number"==typeof i[n]||"boolean"==typeof i[n],"invalid uniform "+e,t.commandStr),i[n]})),"]")})):ne.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=i,a[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];a[e]=cu(t,(function(e,n){return e.invoke(n,t)}))})),a}function V(e,t){var r=e.static,a=e.dynamic,o={};return Object.keys(r).forEach((function(e){var a=r[e],u=n.id(e),s=new v;if(iu(a))s.state=ii,s.buffer=i.getBuffer(i.create(a,uo,!1,!0)),s.type=0;else{var f=i.getBuffer(a);if(f)s.state=ii,s.buffer=f,s.type=0;else if(ne.command("object"==typeof a&&a,"invalid data for attribute "+e,t.commandStr),"constant"in a){var c=a.constant;s.buffer="null",s.state=oi,"number"==typeof c?s.x=c:(ne.command(ln(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),ri.forEach((function(e,t){t<c.length&&(s[e]=c[t])})))}else{f=iu(a.buffer)?i.getBuffer(i.create(a.buffer,uo,!1,!0)):i.getBuffer(a.buffer),ne.command(!!f,'missing buffer for attribute "'+e+'"',t.commandStr);var l=0|a.offset;ne.command(l>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var h=0|a.stride;ne.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|a.size;ne.command(!("size"in a)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var m=!!a.normalized,p=0;"type"in a&&(ne.commandParameter(a.type,Pt,"invalid type for attribute "+e,t.commandStr),p=Pt[a.type]);var b=0|a.divisor;ne.optional((function(){"divisor"in a&&(ne.command(0===b||g,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),ne.command(b>=0,'invalid divisor for attribute "'+e+'"',t.commandStr));var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(a).forEach((function(t){ne.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),s.buffer=f,s.state=ii,s.size=d,s.normalized=m,s.type=p||f.dtype,s.offset=l,s.stride=h,s.divisor=b}}o[e]=fu((function(e,t){var n=e.attribCache;if(u in n)return n[u];var r={isStream:!1};return Object.keys(s).forEach((function(e){r[e]=s[e]})),s.buffer&&(r.buffer=e.link(s.buffer),r.type=r.type||r.buffer+".dtype"),n[u]=r,r}))})),Object.keys(a).forEach((function(e){var t=a[e];function n(n,r){var a=n.invoke(r,t),i=n.shared,o=n.constants,u=i.isBufferArgs,s=i.buffer;ne.optional((function(){n.assert(r,a+"&&(typeof "+a+'==="object"||typeof '+a+'==="function")&&('+u+"("+a+")||"+s+".getBuffer("+a+")||"+s+".getBuffer("+a+".buffer)||"+u+"("+a+'.buffer)||("constant" in '+a+"&&(typeof "+a+'.constant==="number"||'+i.isArrayLike+"("+a+".constant))))",'invalid dynamic attribute "'+e+'"')}));var f={isStream:r.def(!1)},c=new v;c.state=ii,Object.keys(c).forEach((function(e){f[e]=r.def(""+c[e])}));var l=f.buffer,h=f.type;function d(e){r(f[e],"=",a,".",e,"|0;")}return r("if(",u,"(",a,")){",f.isStream,"=true;",l,"=",s,".createStream(",uo,",",a,");",h,"=",l,".dtype;","}else{",l,"=",s,".getBuffer(",a,");","if(",l,"){",h,"=",l,".dtype;",'}else if("constant" in ',a,"){",f.state,"=",oi,";","if(typeof "+a+'.constant === "number"){',f[ri[0]],"=",a,".constant;",ri.slice(1).map((function(e){return f[e]})).join("="),"=0;","}else{",ri.map((function(e,t){return f[e]+"="+a+".constant.length>"+t+"?"+a+".constant["+t+"]:0;"})).join(""),"}}else{","if(",u,"(",a,".buffer)){",l,"=",s,".createStream(",uo,",",a,".buffer);","}else{",l,"=",s,".getBuffer(",a,".buffer);","}",h,'="type" in ',a,"?",o.glTypes,"[",a,".type]:",l,".dtype;",f.normalized,"=!!",a,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),r("}}"),r.exit("if(",f.isStream,"){",s,".destroyStream(",l,");","}"),f}o[e]=cu(t,n)})),o}function N(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=fu((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=cu(t,(function(e,n){return e.invoke(n,t)}))})),r}function Y(e,t,n,a,i){var o=e.static,u=e.dynamic;ne.optional((function(){var e=[Ni,Yi,Ui,Xi,Wi,Gi,Hi,Qi,Vi,Ki].concat(A);function t(t){Object.keys(t).forEach((function(t){ne.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',i.commandStr)}))}t(o),t(u)}));var s=F(e,t),f=I(e),l=R(e,f,i),h=L(e,i),d=q(e,i),m=z(e,i,s);function p(e){var t=l[e];t&&(d[e]=t)}p(Bi),p(S(qi));var v=Object.keys(d).length>0,b={framebuffer:f,draw:h,shader:m,state:d,dirty:v,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(b.profile=P(e),b.uniforms=B(n,i),b.drawVAO=b.scopeVAO=h.vao,!b.drawVAO&&m.program&&!s&&r.angle_instanced_arrays&&h.static.elements){var g=!0,y=m.program.attributes.map((function(e){var n=t.static[e];return g=g&&!!n,n}));if(g&&y.length>0){var x=c.getVAO(c.createVAO({attributes:y,elements:h.static.elements}));b.drawVAO=new uu(null,null,null,(function(e,t){return e.link(x)})),b.useVAO=!0}}return s?b.useVAO=!0:b.attributes=V(t,i),b.context=N(a),b}function U(e,t,n){var r=e.shared.context,a=e.scope();Object.keys(n).forEach((function(i){t.save(r,"."+i);var o=n[i].append(e,t);Array.isArray(o)?a(r,".",i,"=[",o.join(),"];"):a(r,".",i,"=",o,";")})),t(a)}function X(e,t,n,r){var a,i=e.shared,o=i.gl,u=i.framebuffer;y&&(a=t.def(i.extensions,".webgl_draw_buffers"));var s,f=e.constants,c=f.drawBuffer,l=f.backBuffer;s=n?n.append(e,t):t.def(u,".next"),r||t("if(",s,"!==",u,".cur){"),t("if(",s,"){",o,".bindFramebuffer(",$o,",",s,".framebuffer);"),y&&t(a,".drawBuffersWEBGL(",c,"[",s,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",$o,",null);"),y&&t(a,".drawBuffersWEBGL(",l,");"),t("}",u,".cur=",s,";"),r||t("}")}function W(e,t,n){var r=e.shared,a=r.gl,i=e.current,o=e.next,u=r.current,s=r.next,f=e.cond(u,".dirty");A.forEach((function(t){var r,c,l=S(t);if(!(l in n.state))if(l in o){r=o[l],c=i[l];var h=Se(w[l].length,(function(e){return f.def(r,"[",e,"]")}));f(e.cond(h.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(a,".",_[l],"(",h,");",h.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=f.def(s,".",l);var d=e.cond(r,"!==",u,".",l);f(d),l in E?d(e.cond(r).then(a,".enable(",E[l],");").else(a,".disable(",E[l],");"),u,".",l,"=",r,";"):d(a,".",_[l],"(",r,");",u,".",l,"=",r,";")}})),0===Object.keys(n.state).length&&f(u,".dirty=false;"),t(f)}function H(e,t,n,r){var a=e.shared,i=e.current,o=a.current,u=a.gl;ou(Object.keys(n)).forEach((function(a){var s=n[a];if(!r||r(s)){var f=s.append(e,t);if(E[a]){var c=E[a];su(s)?t(u,f?".enable(":".disable(",c,");"):t(e.cond(f).then(u,".enable(",c,");").else(u,".disable(",c,");")),t(o,".",a,"=",f,";")}else if(ln(f)){var l=i[a];t(u,".",_[a],"(",f,");",f.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";")}else t(u,".",_[a],"(",f,");",o,".",a,"=",f,";")}}))}function G(e,t){g&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function Q(e,t,n,r,a){var i,o,u,s=e.shared,f=e.stats,c=s.current,l=s.timer,h=n.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function p(e){e(i=t.def(),"=",d(),";"),"string"==typeof a?e(f,".count+=",a,";"):e(f,".count++;"),m&&(r?e(o=t.def(),"=",l,".getNumPendingQueries();"):e(l,".beginQuery(",f,");"))}function v(e){e(f,".cpuTime+=",d(),"-",i,";"),m&&(r?e(l,".pushScopeStats(",o,",",l,".getNumPendingQueries(),",f,");"):e(l,".endQuery();"))}function b(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(h){if(su(h))return void(h.enable?(p(t),v(t.exit),b("true")):b("false"));b(u=h.append(e,t))}else u=t.def(c,".profile");var g=e.block();p(g),t("if(",u,"){",g,"}");var y=e.block();v(y),t.exit("if(",u,"){",y,"}")}function K(e,t,n,r,a){var i=e.shared;function o(e){switch(e){case Mo:case So:case Do:return 2;case Ao:case To:case jo:return 3;case Eo:case Oo:case Co:return 4;default:return 1}}function u(n,r,a){var o=i.gl,u=t.def(n,".location"),s=t.def(i.attributes,"[",u,"]"),f=a.state,c=a.buffer,l=[a.x,a.y,a.z,a.w],h=["buffer","normalized","offset","stride"];function d(){t("if(!",s,".buffer){",o,".enableVertexAttribArray(",u,");}");var n,i=a.type;if(n=a.size?t.def(a.size,"||",r):r,t("if(",s,".type!==",i,"||",s,".size!==",n,"||",h.map((function(e){return s+"."+e+"!=="+a[e]})).join("||"),"){",o,".bindBuffer(",uo,",",c,".buffer);",o,".vertexAttribPointer(",[u,n,i,a.normalized,a.stride,a.offset],");",s,".type=",i,";",s,".size=",n,";",h.map((function(e){return s+"."+e+"="+a[e]+";"})).join(""),"}"),g){var f=a.divisor;t("if(",s,".divisor!==",f,"){",e.instancing,".vertexAttribDivisorANGLE(",[u,f],");",s,".divisor=",f,";}")}}function m(){t("if(",s,".buffer){",o,".disableVertexAttribArray(",u,");",s,".buffer=null;","}if(",ri.map((function(e,t){return s+"."+e+"!=="+l[t]})).join("||"),"){",o,".vertexAttrib4f(",u,",",l,");",ri.map((function(e,t){return s+"."+e+"="+l[t]+";"})).join(""),"}")}f===ii?d():f===oi?m():(t("if(",f,"===",ii,"){"),d(),t("}else{"),m(),t("}"))}r.forEach((function(r){var i,s=r.name,f=n.attributes[s];if(f){if(!a(f))return;i=f.append(e,t)}else{if(!a(lu))return;var c=e.scopeAttrib(s);ne.optional((function(){e.assert(t,c+".state","missing attribute "+s)})),i={},Object.keys(new v).forEach((function(e){i[e]=t.def(c,".",e)}))}u(e.link(r),o(r.info.type),i)}))}function $(e,t,r,a,i,o){for(var u,s=e.shared,f=s.gl,c={},l=0;l<a.length;++l){var h=a[l],d=h.name,m=h.info.type,p=h.info.size,v=r.uniforms[d];if(p>1){if(!v)continue;var b=d.replace("[0]","");if(c[b])continue;c[b]=1}var g,y=e.link(h)+".location";if(v){if(!i(v))continue;if(su(v)){var x=v.value;if(ne.command(null!=x,'missing uniform "'+d+'"',e.commandStr),m===Fo||m===zo){ne.command("function"==typeof x&&(m===Fo&&("texture2d"===x._reglType||"framebuffer"===x._reglType)||m===zo&&("textureCube"===x._reglType||"framebufferCube"===x._reglType)),"invalid texture for uniform "+d,e.commandStr);var w=e.link(x._texture||x.color[0]._texture);t(f,".uniform1i(",y,",",w+".bind());"),t.exit(w,".unbind();")}else if(m===Po||m===Io||m===Ro){ne.optional((function(){ne.command(ln(x),"invalid matrix for uniform "+d,e.commandStr),ne.command(m===Po&&4===x.length||m===Io&&9===x.length||m===Ro&&16===x.length,"invalid length for matrix uniform "+d,e.commandStr)}));var M=e.global.def("new Float32Array(["+Array.prototype.slice.call(x)+"])"),A=2;m===Io?A=3:m===Ro&&(A=4),t(f,".uniformMatrix",A,"fv(",y,",false,",M,");")}else{switch(m){case wo:1===p?ne.commandType(x,"number","uniform "+d,e.commandStr):ne.command(ln(x)&&x.length===p,"uniform "+d,e.commandStr),u="1f";break;case Mo:ne.command(ln(x)&&x.length&&x.length%2==0&&x.length<=2*p,"uniform "+d,e.commandStr),u="2f";break;case Ao:ne.command(ln(x)&&x.length&&x.length%3==0&&x.length<=3*p,"uniform "+d,e.commandStr),u="3f";break;case Eo:ne.command(ln(x)&&x.length&&x.length%4==0&&x.length<=4*p,"uniform "+d,e.commandStr),u="4f";break;case ko:1===p?ne.commandType(x,"boolean","uniform "+d,e.commandStr):ne.command(ln(x)&&x.length===p,"uniform "+d,e.commandStr),u="1i";break;case _o:1===p?ne.commandType(x,"number","uniform "+d,e.commandStr):ne.command(ln(x)&&x.length===p,"uniform "+d,e.commandStr),u="1i";break;case Do:case So:ne.command(ln(x)&&x.length&&x.length%2==0&&x.length<=2*p,"uniform "+d,e.commandStr),u="2i";break;case jo:case To:ne.command(ln(x)&&x.length&&x.length%3==0&&x.length<=3*p,"uniform "+d,e.commandStr),u="3i";break;case Co:case Oo:ne.command(ln(x)&&x.length&&x.length%4==0&&x.length<=4*p,"uniform "+d,e.commandStr),u="4i"}p>1?(u+="v",x=e.global.def("["+Array.prototype.slice.call(x)+"]")):x=ln(x)?Array.prototype.slice.call(x):x,t(f,".uniform",u,"(",y,",",x,");")}continue}g=v.append(e,t)}else{if(!i(lu))continue;g=t.def(s.uniforms,"[",n.id(d),"]")}m===Fo?(ne(!Array.isArray(g),"must specify a scalar prop for textures"),t("if(",g,"&&",g,'._reglType==="framebuffer"){',g,"=",g,".color[0];","}")):m===zo&&(ne(!Array.isArray(g),"must specify a scalar prop for cube maps"),t("if(",g,"&&",g,'._reglType==="framebufferCube"){',g,"=",g,".color[0];","}")),ne.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+d+'".  '+r)}function r(e,t){1===t&&ne(!Array.isArray(g),"must not specify an array type for uniform"),n("Array.isArray("+g+") && typeof "+g+'[0]===" '+e+'" || typeof '+g+'==="'+e+'"',"invalid type, expected "+e)}function a(t,r,a){Array.isArray(g)?ne(g.length&&g.length%t==0&&g.length<=t*a,"must have length of "+(1===a?"":"n * ")+t):n(s.isArrayLike+"("+g+")&&"+g+".length && "+g+".length % "+t+" === 0 && "+g+".length<="+t*a,"invalid vector, should have length of "+(1===a?"":"n * ")+t,e.commandStr)}function i(t){ne(!Array.isArray(g),"must not specify a value type"),n("typeof "+g+'==="function"&&'+g+'._reglType==="texture'+(t===fo?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(m){case _o:r("number",p);break;case So:a(2,"number",p);break;case To:a(3,"number",p);break;case Oo:a(4,"number",p);break;case wo:r("number",p);break;case Mo:a(2,"number",p);break;case Ao:a(3,"number",p);break;case Eo:a(4,"number",p);break;case ko:r("boolean",p);break;case Do:a(2,"boolean",p);break;case jo:a(3,"boolean",p);break;case Co:a(4,"boolean",p);break;case Po:a(4,"number",p);break;case Io:a(9,"number",p);break;case Ro:a(16,"number",p);break;case Fo:i(fo);break;case zo:i(co)}}));var E=1;switch(m){case Fo:case zo:var _=t.def(g,"._texture");t(f,".uniform1i(",y,",",_,".bind());"),t.exit(_,".unbind();");continue;case _o:case ko:u="1i";break;case So:case Do:u="2i",E=2;break;case To:case jo:u="3i",E=3;break;case Oo:case Co:u="4i",E=4;break;case wo:u="1f";break;case Mo:u="2f",E=2;break;case Ao:u="3f",E=3;break;case Eo:u="4f",E=4;break;case Po:u="Matrix2fv";break;case Io:u="Matrix3fv";break;case Ro:u="Matrix4fv"}if(-1===u.indexOf("Matrix")&&p>1&&(u+="v",E=1),"M"===u.charAt(0)){t(f,".uniform",u,"(",y,",");var S=Math.pow(m-Po+2,2),T=e.global.def("new Float32Array(",S,")");Array.isArray(g)?t("false,(",Se(S,(function(e){return T+"["+e+"]="+g[e]})),",",T,")"):t("false,(Array.isArray(",g,")||",g," instanceof Float32Array)?",g,":(",Se(S,(function(e){return T+"["+e+"]="+g+"["+e+"]"})),",",T,")"),t(");")}else if(E>1){for(var O=[],k=[],D=0;D<E;++D)Array.isArray(g)?k.push(g[D]):k.push(t.def(g+"["+D+"]")),o&&O.push(t.def());o&&t("if(!",e.batchId,"||",O.map((function(e,t){return e+"!=="+k[t]})).join("||"),"){",O.map((function(e,t){return e+"="+k[t]+";"})).join("")),t(f,".uniform",u,"(",y,",",k.join(","),");"),o&&t("}")}else{if(ne(!Array.isArray(g),"uniform value must not be an array"),o){var j=t.def();t("if(!",e.batchId,"||",j,"!==",g,"){",j,"=",g,";")}t(f,".uniform",u,"(",y,",",g,");"),o&&t("}")}}}function Z(e,t,n,r){var a=e.shared,i=a.gl,o=a.draw,u=r.draw;function s(){var s,f=u.elements,c=t;return f?((f.contextDep&&r.contextDynamic||f.propDep)&&(c=n),s=f.append(e,c),u.elementsActive&&c("if("+s+")"+i+".bindBuffer("+so+","+s+".buffer.buffer);")):(s=c.def(),c(s,"=",o,".",Xi,";","if(",s,"){",i,".bindBuffer(",so,",",s,".buffer.buffer);}","else if(",a.vao,".currentVAO){",s,"=",e.shared.elements+".getElements("+a.vao,".currentVAO.elements);",x?"":"if("+s+")"+i+".bindBuffer("+so+","+s+".buffer.buffer);","}")),s}function f(){var a,i=u.count,s=t;return i?((i.contextDep&&r.contextDynamic||i.propDep)&&(s=n),a=i.append(e,s),ne.optional((function(){i.MISSING&&e.assert(t,"false","missing vertex count"),i.DYNAMIC&&e.assert(s,a+">=0","missing vertex count")}))):(a=s.def(o,".",Hi),ne.optional((function(){e.assert(s,a+">=0","missing vertex count")}))),a}var c=s();function l(a){var i=u[a];return i?i.contextDep&&r.contextDynamic||i.propDep?i.append(e,n):i.append(e,t):t.def(o,".",a)}var h,d,m=l(Wi),p=l(Gi),v=f();if("number"==typeof v){if(0===v)return}else n("if(",v,"){"),n.exit("}");g&&(h=l(Qi),d=e.instancing);var b=c+".type",y=u.elements&&su(u.elements)&&!u.vaoActive;function w(){function e(){n(d,".drawElementsInstancedANGLE(",[m,v,b,p+"<<(("+b+"-"+ai+")>>1)",h],");")}function t(){n(d,".drawArraysInstancedANGLE(",[m,p,v,h],");")}c&&"null"!==c?y?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}function M(){function e(){n(i+".drawElements("+[m,v,b,p+"<<(("+b+"-"+ai+")>>1)"]+");")}function t(){n(i+".drawArrays("+[m,p,v]+");")}c&&"null"!==c?y?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}g&&("number"!=typeof h||h>=0)?"string"==typeof h?(n("if(",h,">0){"),w(),n("}else if(",h,"<0){"),M(),n("}")):w():M()}function J(e,t,n,r,a){var i=C(),o=i.proc("body",a);return ne.optional((function(){i.commandStr=t.commandStr,i.command=i.link(t.commandStr)})),g&&(i.instancing=o.def(i.shared.extensions,".angle_instanced_arrays")),e(i,o,n,r),i.compile().body}function ee(e,t,n,r){G(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),K(e,t,n,r.attributes,(function(){return!0}))),$(e,t,n,r.uniforms,(function(){return!0}),!1),Z(e,t,t,n)}function te(e,t){var n=e.proc("draw",1);G(e,n),U(e,n,t.context),X(e,n,t.framebuffer),W(e,n,t),H(e,n,t.state),Q(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)ee(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var a=e.global.def("{}"),i=n.def(r,".id"),o=n.def(a,"[",i,"]");n(e.cond(o).then(o,".call(this,a0);").else(o,"=",a,"[",i,"]=",e.link((function(n){return J(ee,e,t,n,1)})),"(",r,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}function re(e,t,n,r){function a(){return!0}e.batchId="a1",G(e,t),K(e,t,n,r.attributes,a),$(e,t,n,r.uniforms,a,!1),Z(e,t,t,n)}function ae(e,t,n,r){G(e,t);var a=n.contextDep,i=t.def(),o="a0",u="a1",s=t.def();e.shared.props=s,e.batchId=i;var f=e.scope(),c=e.scope();function l(e){return e.contextDep&&a||e.propDep}function h(e){return!l(e)}if(t(f.entry,"for(",i,"=0;",i,"<",u,";++",i,"){",s,"=",o,"[",i,"];",c,"}",f.exit),n.needsContext&&U(e,c,n.context),n.needsFramebuffer&&X(e,c,n.framebuffer),H(e,c,n.state,l),n.profile&&l(n.profile)&&Q(e,c,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?c(e.shared.vao,".setVAO(",n.drawVAO.append(e,c),");"):f(e.shared.vao,".setVAO(",n.drawVAO.append(e,f),");"):f(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(f(e.shared.vao,".setVAO(null);"),K(e,f,n,r.attributes,h),K(e,c,n,r.attributes,l)),$(e,f,n,r.uniforms,h,!1),$(e,c,n,r.uniforms,l,!0),Z(e,f,c,n);else{var d=e.global.def("{}"),m=n.shader.progVar.append(e,c),p=c.def(m,".id"),v=c.def(d,"[",p,"]");c(e.shared.gl,".useProgram(",m,".program);","if(!",v,"){",v,"=",d,"[",p,"]=",e.link((function(t){return J(re,e,n,t,2)})),"(",m,");}",v,".call(this,a0[",i,"],",i,");")}}function ie(e,t){var n=e.proc("batch",2);e.batchId="0",G(e,n);var r=!1,a=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(U(e,n,t.context),a=!1);var i=t.framebuffer,o=!1;function u(e){return e.contextDep&&r||e.propDep}i?(i.propDep?r=o=!0:i.contextDep&&r&&(o=!0),o||X(e,n,i)):X(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),W(e,n,t),H(e,n,t.state,(function(e){return!u(e)})),t.profile&&u(t.profile)||Q(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=a,t.needsFramebuffer=o;var s=t.shader.progVar;if(s.contextDep&&r||s.propDep)ae(e,n,t,null);else{var f=s.append(e,n);if(n(e.shared.gl,".useProgram(",f,".program);"),t.shader.program)ae(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),l=n.def(f,".id"),h=n.def(c,"[",l,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",c,"[",l,"]=",e.link((function(n){return J(ae,e,t,n,2)})),"(",f,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}function oe(e,t){var r=e.proc("scope",3);e.batchId="a2";var a=e.shared,i=a.current;function o(n){var i=t.shader[n];i&&r.set(a.shader,"."+n,i.append(e,r))}U(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),ou(Object.keys(t.state)).forEach((function(n){var i=t.state[n].append(e,r);ln(i)?i.forEach((function(t,a){r.set(e.next[n],"["+a+"]",t)})):r.set(a.next,"."+n,i)})),Q(e,r,t,!0,!0),[Xi,Gi,Hi,Qi,Wi].forEach((function(n){var i=t.draw[n];i&&r.set(a.draw,"."+n,""+i.append(e,r))})),Object.keys(t.uniforms).forEach((function(i){var o=t.uniforms[i].append(e,r);Array.isArray(o)&&(o="["+o.join()+"]"),r.set(a.uniforms,"["+n.id(i)+"]",o)})),Object.keys(t.attributes).forEach((function(n){var a=t.attributes[n].append(e,r),i=e.scopeAttrib(n);Object.keys(new v).forEach((function(e){r.set(i,"."+e,a[e])}))})),t.scopeVAO&&r.set(a.vao,".targetVAO",t.scopeVAO.append(e,r)),o(Yi),o(Ui),Object.keys(t.state).length>0&&(r(i,".dirty=true;"),r.exit(i,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}function ue(e){if("object"==typeof e&&!ln(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(me.isDynamic(e[t[n]]))return!0;return!1}}function se(e,t,n){var r=t.static[n];if(r&&ue(r)){var a=e.global,i=Object.keys(r),o=!1,u=!1,s=!1,f=e.global.def("{}");i.forEach((function(t){var n=r[t];if(me.isDynamic(n)){"function"==typeof n&&(n=r[t]=me.unbox(n));var i=cu(n,null);o=o||i.thisDep,s=s||i.propDep,u=u||i.contextDep}else{switch(a(f,".",t,"="),typeof n){case"number":a(n);break;case"string":a('"',n,'"');break;case"object":Array.isArray(n)&&a("[",n.join(),"]");break;default:a(e.link(n))}a(";")}})),t.dynamic[n]=new me.DynamicVariable(li,{thisDep:o,contextDep:u,propDep:s,ref:f,append:c}),delete t.static[n]}function c(e,t){i.forEach((function(n){var a=r[n];if(me.isDynamic(a)){var i=e.invoke(t,a);t(f,".",n,"=",i,";")}}))}}function fe(e,n,r,a,i){var o=C();o.stats=o.link(i),Object.keys(n.static).forEach((function(e){se(o,n,e)})),oo.forEach((function(t){se(o,e,t)}));var u=Y(e,n,r,a,o);return te(o,u),oe(o,u),ie(o,u),t(o.compile(),{destroy:function(){u.shader.program.destroy()}})}return{next:M,current:w,procs:function(){var e=C(),t=e.proc("poll"),n=e.proc("refresh"),i=e.block();t(i),n(i);var o,u=e.shared,s=u.gl,f=u.next,c=u.current;i(c,".dirty=false;"),X(e,t),X(e,n,null,!0),g&&(o=e.link(g)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var l=0;l<a.maxAttributes;++l){var h=n.def(u.attributes,"[",l,"]"),d=e.cond(h,".buffer");d.then(s,".enableVertexAttribArray(",l,");",s,".bindBuffer(",uo,",",h,".buffer.buffer);",s,".vertexAttribPointer(",l,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(s,".disableVertexAttribArray(",l,");",s,".vertexAttrib4f(",l,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(d),g&&n(o,".vertexAttribDivisorANGLE(",l,",",h,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(E).forEach((function(r){var a=E[r],o=i.def(f,".",r),u=e.block();u("if(",o,"){",s,".enable(",a,")}else{",s,".disable(",a,")}",c,".",r,"=",o,";"),n(u),t("if(",o,"!==",c,".",r,"){",u,"}")})),Object.keys(_).forEach((function(r){var a,o,u=_[r],l=w[r],h=e.block();if(h(s,".",u,"("),ln(l)){var d=l.length;a=e.global.def(f,".",r),o=e.global.def(c,".",r),h(Se(d,(function(e){return a+"["+e+"]"})),");",Se(d,(function(e){return o+"["+e+"]="+a+"["+e+"];"})).join("")),t("if(",Se(d,(function(e){return a+"["+e+"]!=="+o+"["+e+"]"})).join("||"),"){",h,"}")}else a=i.def(f,".",r),o=i.def(c,".",r),h(a,");",c,".",r,"=",a,";"),t("if(",a,"!==",o,"){",h,"}");n(h)})),e.compile()}(),compile:fe}}function du(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var mu=34918,pu=34919,vu=35007,bu=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function a(e){n.push(e)}var i=[];function o(e){var n=r();t.ext_disjoint_timer_query.beginQueryEXT(vu,n),i.push(n),d(i.length-1,i.length,e)}function u(){t.ext_disjoint_timer_query.endQueryEXT(vu)}function s(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var f=[];function c(){return f.pop()||new s}function l(e){f.push(e)}var h=[];function d(e,t,n){var r=c();r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,h.push(r)}var m=[],p=[];function v(){var e,n,r=i.length;if(0!==r){p.length=Math.max(p.length,r+1),m.length=Math.max(m.length,r+1),m[0]=0,p[0]=0;var o=0;for(e=0,n=0;n<i.length;++n){var u=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(u,pu)?(o+=t.ext_disjoint_timer_query.getQueryObjectEXT(u,mu),a(u)):i[e++]=u,m[n+1]=o,p[n+1]=e}for(i.length=e,e=0,n=0;n<h.length;++n){var s=h[n],f=s.startQueryIndex,c=s.endQueryIndex;s.sum+=m[c]-m[f];var d=p[f],v=p[c];v===d?(s.stats.gpuTime+=s.sum/1e6,l(s)):(s.startQueryIndex=d,s.endQueryIndex=v,h[e++]=s)}h.length=e}}return{beginQuery:o,endQuery:u,pushScopeStats:d,update:v,getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},gu=16384,yu=256,xu=1024,wu=34962,Mu="webglcontextlost",Au="webglcontextrestored",Eu=1,_u=2,Su=3;function Tu(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function Ou(e){var n=Ee(e);if(!n)return null;var r=n.gl,a=r.getContextAttributes(),i=r.isContextLost(),o=_e(r,n);if(!o)return null;var u=be(),s=du(),f=o.extensions,c=bu(r,f),l=ve(),h=r.drawingBufferWidth,d=r.drawingBufferHeight,m={tick:0,time:0,viewportWidth:h,viewportHeight:d,framebufferWidth:h,framebufferHeight:d,drawingBufferWidth:h,drawingBufferHeight:d,pixelRatio:n.pixelRatio},p={},v={elements:null,primitive:4,count:-1,offset:0,instances:-1},b=Mt(r,f),g=Xt(r,s,n,w),y=on(r,f,g,s),x=Ya(r,f,b,s,g,y,v);function w(e){return x.destroyBuffer(e)}var M=Ga(r,u,s,n),A=Qr(r,f,b,(function(){S.procs.poll()}),m,s,n),E=fa(r,f,b,s,n),_=za(r,f,b,A,E,s),S=hu(r,u,f,b,g,y,A,_,p,x,M,v,m,c,n),T=Ja(r,_,S.procs.poll,m,a,f,b),O=S.next,k=r.canvas,D=[],j=[],C=[],P=[n.onDestroy],I=null;function R(){if(0===D.length)return c&&c.update(),void(I=null);I=pe.next(R),H();for(var e=D.length-1;e>=0;--e){var t=D[e];t&&t(m,null,0)}r.flush(),c&&c.update()}function F(){!I&&D.length>0&&(I=pe.next(R))}function z(){I&&(pe.cancel(R),I=null)}function L(e){e.preventDefault(),i=!0,z(),j.forEach((function(e){e()}))}function q(e){r.getError(),i=!1,o.restore(),M.restore(),g.restore(),A.restore(),E.restore(),_.restore(),x.restore(),c&&c.restore(),S.procs.refresh(),F(),C.forEach((function(e){e()}))}function B(){D.length=0,z(),k&&(k.removeEventListener(Mu,L),k.removeEventListener(Au,q)),M.clear(),_.clear(),E.clear(),x.clear(),A.clear(),y.clear(),g.clear(),c&&c.clear(),P.forEach((function(e){e()}))}function V(e){function n(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}function r(e,t){var n={},r={};return Object.keys(e).forEach((function(a){var i=e[a];if(me.isDynamic(i))r[a]=me.unbox(i,a);else{if(t&&Array.isArray(i))for(var o=0;o<i.length;++o)if(me.isDynamic(i[o]))return void(r[a]=me.unbox(i,a));n[a]=i}})),{dynamic:r,static:n}}ne(!!e,"invalid args to regl({...})"),ne.type(e,"object","invalid args to regl({...})");var a=r(e.context||{},!0),o=r(e.uniforms||{},!0),u=r(e.attributes||{},!1),s=r(n(e),!1),f={gpuTime:0,cpuTime:0,count:0},c=S.compile(s,u,o,a,f),l=c.draw,h=c.batch,d=c.scope,m=[];function p(e){for(;m.length<e;)m.push(null);return m}function v(e,t){var n;if(i&&ne.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)d.call(this,null,t,n);else{if(!Array.isArray(e))return d.call(this,e,t,0);for(n=0;n<e.length;++n)d.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,p(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return h.call(this,e,e.length)}}return t(v,{stats:f,destroy:function(){c.destroy()}})}k&&(k.addEventListener(Mu,L,!1),k.addEventListener(Au,q,!1));var N=_.setFBO=V({framebuffer:me.define.call(null,Eu,"framebuffer")});function Y(e,t){var n=0;S.procs.poll();var a=t.color;a&&(r.clearColor(+a[0]||0,+a[1]||0,+a[2]||0,+a[3]||0),n|=gu),"depth"in t&&(r.clearDepth(+t.depth),n|=yu),"stencil"in t&&(r.clearStencil(0|t.stencil),n|=xu),ne(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function U(e){if(ne("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)N(t({framebuffer:e.framebuffer.faces[n]},e),Y);else N(e,Y);else Y(null,e)}function X(e){function t(){var t=Tu(D,e);function n(){var e=Tu(D,n);D[e]=D[D.length-1],D.length-=1,D.length<=0&&z()}ne(t>=0,"cannot cancel a frame twice"),D[t]=n}return ne.type(e,"function","regl.frame() callback must be a function"),D.push(e),F(),{cancel:t}}function W(){var e=O.viewport,t=O.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=r.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=r.drawingBufferHeight}function H(){m.tick+=1,m.time=Q(),W(),S.procs.poll()}function G(){A.refresh(),W(),S.procs.refresh(),c&&c.update()}function Q(){return(ve()-l)/1e3}function K(e,t){var n;switch(ne.type(t,"function","listener callback must be a function"),e){case"frame":return X(t);case"lost":n=j;break;case"restore":n=C;break;case"destroy":n=P;break;default:ne.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}}G();var $=t(V,{clear:U,prop:me.define.bind(null,Eu),context:me.define.bind(null,_u),this:me.define.bind(null,Su),draw:V({}),buffer:function(e){return g.create(e,wu,!1,!1)},elements:function(e){return y.create(e,!1)},texture:A.create2D,cube:A.createCube,renderbuffer:E.create,framebuffer:_.create,framebufferCube:_.createCube,vao:x.createVAO,attributes:a,frame:X,on:K,limits:b,hasExtension:function(e){return b.extensions.indexOf(e.toLowerCase())>=0},read:T,destroy:B,_gl:r,_refresh:G,poll:function(){H(),c&&c.update()},now:Q,stats:s});return n.onDone(null,$),$}return Ou}();!function(){var e=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pageX","pageY"],t=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0];function n(n,r){r=r||Object.create(null);var a=document.createEvent("Event");a.initEvent(n,r.bubbles||!1,r.cancelable||!1);for(var i,o=2;o<e.length;o++)a[i=e[o]]=r[i]||t[o];a.buttons=r.buttons||0;var u=0;return u=r.pressure&&a.buttons?r.pressure:a.buttons?.5:0,a.x=a.clientX,a.y=a.clientY,a.pointerId=r.pointerId||0,a.width=r.width||0,a.height=r.height||0,a.pressure=u,a.tiltX=r.tiltX||0,a.tiltY=r.tiltY||0,a.twist=r.twist||0,a.tangentialPressure=r.tangentialPressure||0,a.pointerType=r.pointerType||"",a.hwTimestamp=r.hwTimestamp||0,a.isPrimary=r.isPrimary||!1,a}var r=window.Map&&window.Map.prototype.forEach?Map:a;function a(){this.array=[],this.size=0}a.prototype={set:function(e,t){if(void 0===t)return this.delete(e);this.has(e)||this.size++,this.array[e]=t},has:function(e){return void 0!==this.array[e]},delete:function(e){this.has(e)&&(delete this.array[e],this.size--)},get:function(e){return this.array[e]},clear:function(){this.array.length=0,this.size=0},forEach:function(e,t){return this.array.forEach((function(n,r){e.call(t,n,r,this)}),this)}};var i=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","buttons","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","type","target","currentTarget","which","pageX","pageY","timeStamp"],o=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],u={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},s="undefined"!=typeof SVGElementInstance,f={pointermap:new r,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(e,t){var n=t,r=n.events;r&&(r.forEach((function(e){n[e]&&(this.eventMap[e]=n[e].bind(n))}),this),this.eventSources[e]=n,this.eventSourceList.push(n))},register:function(e){for(var t,n=this.eventSourceList.length,r=0;r<n&&(t=this.eventSourceList[r]);r++)t.register.call(t,e)},unregister:function(e){for(var t,n=this.eventSourceList.length,r=0;r<n&&(t=this.eventSourceList[r]);r++)t.unregister.call(t,e)},contains:function(e,t){try{return e.contains(t)}catch(n){return!1}},down:function(e){e.bubbles=!0,this.fireEvent("pointerdown",e)},move:function(e){e.bubbles=!0,this.fireEvent("pointermove",e)},up:function(e){e.bubbles=!0,this.fireEvent("pointerup",e)},enter:function(e){e.bubbles=!1,this.fireEvent("pointerenter",e)},leave:function(e){e.bubbles=!1,this.fireEvent("pointerleave",e)},over:function(e){e.bubbles=!0,this.fireEvent("pointerover",e)},out:function(e){e.bubbles=!0,this.fireEvent("pointerout",e)},cancel:function(e){e.bubbles=!0,this.fireEvent("pointercancel",e)},leaveOut:function(e){this.out(e),this.propagate(e,this.leave,!1)},enterOver:function(e){this.over(e),this.propagate(e,this.enter,!0)},eventHandler:function(e){if(!e._handledByPE){var t=e.type,n=this.eventMap&&this.eventMap[t];n&&n(e),e._handledByPE=!0}},listen:function(e,t){t.forEach((function(t){this.addEvent(e,t)}),this)},unlisten:function(e,t){t.forEach((function(t){this.removeEvent(e,t)}),this)},addEvent:function(e,t){e.addEventListener(t,this.boundHandler)},removeEvent:function(e,t){e.removeEventListener(t,this.boundHandler)},makeEvent:function(e,t){this.captureInfo[t.pointerId]&&(t.relatedTarget=null);var r=new n(e,t);return t.preventDefault&&(r.preventDefault=t.preventDefault),r._target=r._target||t.target,r},fireEvent:function(e,t){var n=this.makeEvent(e,t);return this.dispatchEvent(n)},cloneEvent:function(e){for(var t,n=Object.create(null),r=0;r<i.length;r++)n[t=i[r]]=e[t]||o[r],!s||"target"!==t&&"relatedTarget"!==t||n[t]instanceof SVGElementInstance&&(n[t]=n[t].correspondingUseElement);return e.preventDefault&&(n.preventDefault=function(){e.preventDefault()}),n},getTarget:function(e){var t=this.captureInfo[e.pointerId];return t?e._target!==t&&e.type in u?void 0:t:e._target},propagate:function(e,t,n){for(var r=e.target,a=[];r!==document&&!r.contains(e.relatedTarget);)if(a.push(r),!(r=r.parentNode))return;n&&a.reverse(),a.forEach((function(n){e.target=n,t.call(this,e)}),this)},setCapture:function(e,t,r){this.captureInfo[e]&&this.releaseCapture(e,r),this.captureInfo[e]=t,this.implicitRelease=this.releaseCapture.bind(this,e,r),document.addEventListener("pointerup",this.implicitRelease),document.addEventListener("pointercancel",this.implicitRelease);var a=new n("gotpointercapture");a.pointerId=e,a._target=t,r||this.asyncDispatchEvent(a)},releaseCapture:function(e,t){var r=this.captureInfo[e];if(r){this.captureInfo[e]=void 0,document.removeEventListener("pointerup",this.implicitRelease),document.removeEventListener("pointercancel",this.implicitRelease);var a=new n("lostpointercapture");a.pointerId=e,a._target=r,t||this.asyncDispatchEvent(a)}},dispatchEvent:function(e){var t=this.getTarget(e);if(t)return t.dispatchEvent(e)},asyncDispatchEvent:function(e){requestAnimationFrame(this.dispatchEvent.bind(this,e))}};f.boundHandler=f.eventHandler.bind(f);var c={shadow:function(e){if(e)return e.shadowRoot||e.webkitShadowRoot},canTarget:function(e){return e&&Boolean(e.elementFromPoint)},targetingShadow:function(e){var t=this.shadow(e);if(this.canTarget(t))return t},olderShadow:function(e){var t=e.olderShadowRoot;if(!t){var n=e.querySelector("shadow");n&&(t=n.olderShadowRoot)}return t},allShadows:function(e){for(var t=[],n=this.shadow(e);n;)t.push(n),n=this.olderShadow(n);return t},searchRoot:function(e,t,n){if(e){var r,a,i=e.elementFromPoint(t,n);for(a=this.targetingShadow(i);a;){if(r=a.elementFromPoint(t,n)){var o=this.targetingShadow(r);return this.searchRoot(o,t,n)||r}a=this.olderShadow(a)}return i}},owner:function(e){for(var t=e;t.parentNode;)t=t.parentNode;return t.nodeType!==Node.DOCUMENT_NODE&&t.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(t=document),t},findTarget:function(e){var t=e.clientX,n=e.clientY,r=this.owner(e.target);return r.elementFromPoint(t,n)||(r=document),this.searchRoot(r,t,n)}},l=Array.prototype.forEach.call.bind(Array.prototype.forEach),h=Array.prototype.map.call.bind(Array.prototype.map),d=Array.prototype.slice.call.bind(Array.prototype.slice),m=Array.prototype.filter.call.bind(Array.prototype.filter),p=window.MutationObserver||window.WebKitMutationObserver,v="[touch-action]",b={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};function g(e,t,n,r){this.addCallback=e.bind(r),this.removeCallback=t.bind(r),this.changedCallback=n.bind(r),p&&(this.observer=new p(this.mutationWatcher.bind(this)))}function y(e){return"body /shadow-deep/ "+x(e)}function x(e){return'[touch-action="'+e+'"]'}function w(e){return"{ -ms-touch-action: "+e+"; touch-action: "+e+"; }"}g.prototype={watchSubtree:function(e){this.observer&&c.canTarget(e)&&this.observer.observe(e,b)},enableOnSubtree:function(e){this.watchSubtree(e),e===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(e)},installNewSubtree:function(e){l(this.findElements(e),this.addElement,this)},findElements:function(e){return e.querySelectorAll?e.querySelectorAll(v):[]},removeElement:function(e){this.removeCallback(e)},addElement:function(e){this.addCallback(e)},elementChanged:function(e,t){this.changedCallback(e,t)},concatLists:function(e,t){return e.concat(d(t))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(e){return e.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(e){var t=h(e,this.findElements,this);return t.push(m(e,this.isElement)),t.reduce(this.concatLists,[])},mutationWatcher:function(e){e.forEach(this.mutationHandler,this)},mutationHandler:function(e){"childList"===e.type?(this.flattenMutationTree(e.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(e.removedNodes).forEach(this.removeElement,this)):"attributes"===e.type&&this.elementChanged(e.target,e.oldValue)}};var M=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],A="",E=window.PointerEvent||window.MSPointerEvent,_=!window.ShadowDOMPolyfill&&document.head.createShadowRoot;function S(){if(E){M.forEach((function(e){String(e)===e?(A+=x(e)+w(e)+"\n",_&&(A+=y(e)+w(e)+"\n")):(A+=e.selectors.map(x)+w(e.rule)+"\n",_&&(A+=e.selectors.map(y)+w(e.rule)+"\n"))}));var e=document.createElement("style");e.textContent=A,document.head.appendChild(e)}}var T=f.pointermap,O=25,k=[1,4,2,8,16],D=!1;try{D=1===new MouseEvent("test",{buttons:1}).buttons}catch(Z){}var j,C={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(e){f.listen(e,this.events)},unregister:function(e){f.unlisten(e,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(e){for(var t,n=this.lastTouches,r=e.clientX,a=e.clientY,i=0,o=n.length;i<o&&(t=n[i]);i++){var u=Math.abs(r-t.x),s=Math.abs(a-t.y);if(u<=O&&s<=O)return!0}},prepareEvent:function(e){var t=f.cloneEvent(e),n=t.preventDefault;return t.preventDefault=function(){e.preventDefault(),n()},t.pointerId=this.POINTER_ID,t.isPrimary=!0,t.pointerType=this.POINTER_TYPE,t},prepareButtonsForMove:function(e,t){var n=T.get(this.POINTER_ID);0!==t.which&&n?e.buttons=n.buttons:e.buttons=0,t.buttons=e.buttons},mousedown:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=T.get(this.POINTER_ID),n=this.prepareEvent(e);D||(n.buttons=k[n.button],t&&(n.buttons|=t.buttons),e.buttons=n.buttons),T.set(this.POINTER_ID,e),t&&0!==t.buttons?f.move(n):f.down(n)}},mousemove:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);D||this.prepareButtonsForMove(t,e),t.button=-1,T.set(this.POINTER_ID,e),f.move(t)}},mouseup:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=T.get(this.POINTER_ID),n=this.prepareEvent(e);if(!D){var r=k[n.button];n.buttons=t?t.buttons&~r:0,e.buttons=n.buttons}T.set(this.POINTER_ID,e),n.buttons&=~k[n.button],0===n.buttons?f.up(n):f.move(n)}},mouseover:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);D||this.prepareButtonsForMove(t,e),t.button=-1,T.set(this.POINTER_ID,e),f.enterOver(t)}},mouseout:function(e){if(!this.isEventSimulatedFromTouch(e)){var t=this.prepareEvent(e);D||this.prepareButtonsForMove(t,e),t.button=-1,f.leaveOut(t)}},cancel:function(e){var t=this.prepareEvent(e);f.cancel(t),this.deactivateMouse()},deactivateMouse:function(){T.delete(this.POINTER_ID)}},P=f.captureInfo,I=c.findTarget.bind(c),R=c.allShadows.bind(c),F=f.pointermap,z=2500,L=200,q="touch-action",B={events:["touchstart","touchmove","touchend","touchcancel"],register:function(e){j.enableOnSubtree(e)},unregister:function(){},elementAdded:function(e){var t=e.getAttribute(q),n=this.touchActionToScrollType(t);n&&(e._scrollType=n,f.listen(e,this.events),R(e).forEach((function(e){e._scrollType=n,f.listen(e,this.events)}),this))},elementRemoved:function(e){e._scrollType=void 0,f.unlisten(e,this.events),R(e).forEach((function(e){e._scrollType=void 0,f.unlisten(e,this.events)}),this)},elementChanged:function(e,t){var n=e.getAttribute(q),r=this.touchActionToScrollType(n),a=this.touchActionToScrollType(t);r&&a?(e._scrollType=r,R(e).forEach((function(e){e._scrollType=r}),this)):a?this.elementRemoved(e):r&&this.elementAdded(e)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(e){var t=e,n=this.scrollTypes;return"none"===t?"none":t===n.XSCROLLER?"X":t===n.YSCROLLER?"Y":n.SCROLLER.exec(t)?"XY":void 0},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(e){return this.firstTouch===e.identifier},setPrimaryTouch:function(e){(0===F.size||1===F.size&&F.has(1))&&(this.firstTouch=e.identifier,this.firstXY={X:e.clientX,Y:e.clientY},this.scrolling=!1,this.cancelResetClickCount())},removePrimaryPointer:function(e){e.isPrimary&&(this.firstTouch=null,this.firstXY=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var e=function(){this.clickCount=0,this.resetId=null}.bind(this);this.resetId=setTimeout(e,L)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(e){var t=0;return"touchstart"!==e&&"touchmove"!==e||(t=1),t},touchToPointer:function(e){var t=this.currentTouchEvent,n=f.cloneEvent(e),r=n.pointerId=e.identifier+2;n.target=P[r]||I(n),n.bubbles=!0,n.cancelable=!0,n.detail=this.clickCount,n.button=0,n.buttons=this.typeToButtons(t.type),n.width=2*(e.radiusX||e.webkitRadiusX||0),n.height=2*(e.radiusY||e.webkitRadiusY||0),n.pressure=e.force||e.webkitForce||.5,n.isPrimary=this.isPrimaryTouch(e),n.pointerType=this.POINTER_TYPE,n.altKey=t.altKey,n.ctrlKey=t.ctrlKey,n.metaKey=t.metaKey,n.shiftKey=t.shiftKey;var a=this;return n.preventDefault=function(){a.scrolling=!1,a.firstXY=null,t.preventDefault()},n},processTouches:function(e,t){var n=e.changedTouches;this.currentTouchEvent=e;for(var r,a=0;a<n.length;a++)r=n[a],t.call(this,this.touchToPointer(r))},shouldScroll:function(e){if(this.firstXY){var t,n=e.currentTarget._scrollType;if("none"===n)t=!1;else if("XY"===n)t=!0;else{var r=e.changedTouches[0],a=n,i="Y"===n?"X":"Y";t=Math.abs(r["client"+a]-this.firstXY[a])>=Math.abs(r["client"+i]-this.firstXY[i])}return this.firstXY=null,t}},findTouch:function(e,t){for(var n,r=0,a=e.length;r<a&&(n=e[r]);r++)if(n.identifier===t)return!0},vacuumTouches:function(e){var t=e.touches;if(F.size>=t.length){var n=[];F.forEach((function(e,r){if(1!==r&&!this.findTouch(t,r-2)){var a=e.out;n.push(a)}}),this),n.forEach(this.cancelOut,this)}},touchstart:function(e){this.vacuumTouches(e),this.setPrimaryTouch(e.changedTouches[0]),this.dedupSynthMouse(e),this.scrolling||(this.clickCount++,this.processTouches(e,this.overDown))},overDown:function(e){F.set(e.pointerId,{target:e.target,out:e,outTarget:e.target}),f.enterOver(e),f.down(e)},touchmove:function(e){this.scrolling||(this.shouldScroll(e)?(this.scrolling=!0,this.touchcancel(e)):(e.preventDefault(),this.processTouches(e,this.moveOverOut)))},moveOverOut:function(e){var t=e,n=F.get(t.pointerId);if(n){var r=n.out,a=n.outTarget;f.move(t),r&&a!==t.target&&(r.relatedTarget=t.target,t.relatedTarget=a,r.target=a,t.target?(f.leaveOut(r),f.enterOver(t)):(t.target=a,t.relatedTarget=null,this.cancelOut(t))),n.out=t,n.outTarget=t.target}},touchend:function(e){this.dedupSynthMouse(e),this.processTouches(e,this.upOut)},upOut:function(e){this.scrolling||(f.up(e),f.leaveOut(e)),this.cleanUpPointer(e)},touchcancel:function(e){this.processTouches(e,this.cancelOut)},cancelOut:function(e){f.cancel(e),f.leaveOut(e),this.cleanUpPointer(e)},cleanUpPointer:function(e){F.delete(e.pointerId),this.removePrimaryPointer(e)},dedupSynthMouse:function(e){var t=C.lastTouches,n=e.changedTouches[0];if(this.isPrimaryTouch(n)){var r={x:n.clientX,y:n.clientY};t.push(r);var a=function(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}.bind(null,t,r);setTimeout(a,z)}}};j=new g(B.elementAdded,B.elementRemoved,B.elementChanged,B);var V,N,Y,U=f.pointermap,X=window.MSPointerEvent&&"number"==typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,W={events:["MSPointerDown","MSPointerMove","MSPointerUp","MSPointerOut","MSPointerOver","MSPointerCancel","MSGotPointerCapture","MSLostPointerCapture"],register:function(e){f.listen(e,this.events)},unregister:function(e){f.unlisten(e,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(e){var t=e;return X&&((t=f.cloneEvent(e)).pointerType=this.POINTER_TYPES[e.pointerType]),t},cleanup:function(e){U.delete(e)},MSPointerDown:function(e){U.set(e.pointerId,e);var t=this.prepareEvent(e);f.down(t)},MSPointerMove:function(e){var t=this.prepareEvent(e);f.move(t)},MSPointerUp:function(e){var t=this.prepareEvent(e);f.up(t),this.cleanup(e.pointerId)},MSPointerOut:function(e){var t=this.prepareEvent(e);f.leaveOut(t)},MSPointerOver:function(e){var t=this.prepareEvent(e);f.enterOver(t)},MSPointerCancel:function(e){var t=this.prepareEvent(e);f.cancel(t),this.cleanup(e.pointerId)},MSLostPointerCapture:function(e){var t=f.makeEvent("lostpointercapture",e);f.dispatchEvent(t)},MSGotPointerCapture:function(e){var t=f.makeEvent("gotpointercapture",e);f.dispatchEvent(t)}};function H(){if(!window.PointerEvent){if(window.PointerEvent=n,window.navigator.msPointerEnabled){var e=window.navigator.msMaxTouchPoints;Object.defineProperty(window.navigator,"maxTouchPoints",{value:e,enumerable:!0}),f.registerSource("ms",W)}else Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),f.registerSource("mouse",C),void 0!==window.ontouchstart&&f.registerSource("touch",B);f.register(document)}}function G(e){if(!f.pointermap.has(e)){var t=new Error("InvalidPointerId");throw t.name="InvalidPointerId",t}}function Q(e){for(var t=e.parentNode;t&&t!==e.ownerDocument;)t=t.parentNode;if(!t){var n=new Error("InvalidStateError");throw n.name="InvalidStateError",n}}function K(e){return 0!==f.pointermap.get(e).buttons}function $(){window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:V},releasePointerCapture:{value:N},hasPointerCapture:{value:Y}})}window.navigator.msPointerEnabled?(V=function(e){G(e),Q(this),K(e)&&(f.setCapture(e,this,!0),this.msSetPointerCapture(e))},N=function(e){G(e),f.releaseCapture(e,!0),this.msReleasePointerCapture(e)}):(V=function(e){G(e),Q(this),K(e)&&f.setCapture(e,this)},N=function(e){G(e),f.releaseCapture(e)}),Y=function(e){return!!f.captureInfo[e]},S(),H(),$()}();var D=1e-6,j="undefined"!=typeof Float32Array?Float32Array:Array,C=Math.random;var P=Math.PI/180;var I=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",EPSILON:D,get ARRAY_TYPE(){return j},RANDOM:C,setMatrixArrayType:function(e){j=e},toRadian:function(e){return e*P},equals:function(e,t){return Math.abs(e-t)<=D*Math.max(1,Math.abs(e),Math.abs(t))}});function R(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],s=n[1],f=n[2],c=n[3];return e[0]=r*u+i*s,e[1]=a*u+o*s,e[2]=r*f+i*c,e[3]=a*f+o*c,e}function F(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}var z=R,L=F,q=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:function(){var e=new j(4);return j!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new j(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},fromValues:function(e,t,n,r){var a=new j(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a},set:function(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e},transpose:function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},invert:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*i-a*r;return o?(o=1/o,e[0]=i*o,e[1]=-r*o,e[2]=-a*o,e[3]=n*o,e):null},adjoint:function(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e},determinant:function(e){return e[0]*e[3]-e[2]*e[1]},multiply:R,rotate:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+i*u,e[1]=a*s+o*u,e[2]=r*-u+i*s,e[3]=a*-u+o*s,e},scale:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],s=n[1];return e[0]=r*u,e[1]=a*u,e[2]=i*s,e[3]=o*s,e},fromRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},str:function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},LDU:function(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},subtract:F,exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},equals:function(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=t[0],u=t[1],s=t[2],f=t[3];return Math.abs(n-o)<=D*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-u)<=D*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-s)<=D*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(i-f)<=D*Math.max(1,Math.abs(i),Math.abs(f))},multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},mul:z,sub:L});function B(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],f=n[0],c=n[1],l=n[2],h=n[3],d=n[4],m=n[5];return e[0]=r*f+i*c,e[1]=a*f+o*c,e[2]=r*l+i*h,e[3]=a*l+o*h,e[4]=r*d+i*m+u,e[5]=a*d+o*m+s,e}function V(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}var N=B,Y=V,U=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:function(){var e=new j(6);return j!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e},clone:function(e){var t=new j(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},fromValues:function(e,t,n,r,a,i){var o=new j(6);return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o[4]=a,o[5]=i,o},set:function(e,t,n,r,a,i,o){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e},invert:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=n*i-r*a;return s?(s=1/s,e[0]=i*s,e[1]=-r*s,e[2]=-a*s,e[3]=n*s,e[4]=(a*u-i*o)*s,e[5]=(r*o-n*u)*s,e):null},determinant:function(e){return e[0]*e[3]-e[1]*e[2]},multiply:B,rotate:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],f=Math.sin(n),c=Math.cos(n);return e[0]=r*c+i*f,e[1]=a*c+o*f,e[2]=r*-f+i*c,e[3]=a*-f+o*c,e[4]=u,e[5]=s,e},scale:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],f=n[0],c=n[1];return e[0]=r*f,e[1]=a*f,e[2]=i*c,e[3]=o*c,e[4]=u,e[5]=s,e},translate:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],f=n[0],c=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=r*f+i*c+u,e[5]=a*f+o*c+s,e},fromRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},str:function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e},subtract:V,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},equals:function(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],u=e[5],s=t[0],f=t[1],c=t[2],l=t[3],h=t[4],d=t[5];return Math.abs(n-s)<=D*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-f)<=D*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(a-c)<=D*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(i-l)<=D*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-h)<=D*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(u-d)<=D*Math.max(1,Math.abs(u),Math.abs(d))},mul:N,sub:Y});function X(){var e=new j(9);return j!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function W(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],f=t[6],c=t[7],l=t[8],h=n[0],d=n[1],m=n[2],p=n[3],v=n[4],b=n[5],g=n[6],y=n[7],x=n[8];return e[0]=h*r+d*o+m*f,e[1]=h*a+d*u+m*c,e[2]=h*i+d*s+m*l,e[3]=p*r+v*o+b*f,e[4]=p*a+v*u+b*c,e[5]=p*i+v*s+b*l,e[6]=g*r+y*o+x*f,e[7]=g*a+y*u+x*c,e[8]=g*i+y*s+x*l,e}function H(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}var G=W,Q=H,K=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:X,fromMat4:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new j(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromValues:function(e,t,n,r,a,i,o,u,s){var f=new j(9);return f[0]=e,f[1]=t,f[2]=n,f[3]=r,f[4]=a,f[5]=i,f[6]=o,f[7]=u,f[8]=s,f},set:function(e,t,n,r,a,i,o,u,s,f){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=u,e[7]=s,e[8]=f,e},identity:function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},transpose:function(e,t){if(e===t){var n=t[1],r=t[2],a=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=a}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},invert:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],f=t[7],c=t[8],l=c*o-u*f,h=-c*i+u*s,d=f*i-o*s,m=n*l+r*h+a*d;return m?(m=1/m,e[0]=l*m,e[1]=(-c*r+a*f)*m,e[2]=(u*r-a*o)*m,e[3]=h*m,e[4]=(c*n-a*s)*m,e[5]=(-u*n+a*i)*m,e[6]=d*m,e[7]=(-f*n+r*s)*m,e[8]=(o*n-r*i)*m,e):null},adjoint:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],f=t[7],c=t[8];return e[0]=o*c-u*f,e[1]=a*f-r*c,e[2]=r*u-a*o,e[3]=u*s-i*c,e[4]=n*c-a*s,e[5]=a*i-n*u,e[6]=i*f-o*s,e[7]=r*s-n*f,e[8]=n*o-r*i,e},determinant:function(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],u=e[6],s=e[7],f=e[8];return t*(f*i-o*s)+n*(-f*a+o*u)+r*(s*a-i*u)},multiply:W,translate:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],f=t[6],c=t[7],l=t[8],h=n[0],d=n[1];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=u,e[5]=s,e[6]=h*r+d*o+f,e[7]=h*a+d*u+c,e[8]=h*i+d*s+l,e},rotate:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],f=t[6],c=t[7],l=t[8],h=Math.sin(n),d=Math.cos(n);return e[0]=d*r+h*o,e[1]=d*a+h*u,e[2]=d*i+h*s,e[3]=d*o-h*r,e[4]=d*u-h*a,e[5]=d*s-h*i,e[6]=f,e[7]=c,e[8]=l,e},scale:function(e,t,n){var r=n[0],a=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=a*t[3],e[4]=a*t[4],e[5]=a*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},fromRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},fromMat2d:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},fromQuat:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,u=r+r,s=a+a,f=n*o,c=r*o,l=r*u,h=a*o,d=a*u,m=a*s,p=i*o,v=i*u,b=i*s;return e[0]=1-l-m,e[3]=c-b,e[6]=h+v,e[1]=c+b,e[4]=1-f-m,e[7]=d-p,e[2]=h-v,e[5]=d+p,e[8]=1-f-l,e},normalFromMat4:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],f=t[7],c=t[8],l=t[9],h=t[10],d=t[11],m=t[12],p=t[13],v=t[14],b=t[15],g=n*u-r*o,y=n*s-a*o,x=n*f-i*o,w=r*s-a*u,M=r*f-i*u,A=a*f-i*s,E=c*p-l*m,_=c*v-h*m,S=c*b-d*m,T=l*v-h*p,O=l*b-d*p,k=h*b-d*v,D=g*k-y*O+x*T+w*S-M*_+A*E;return D?(D=1/D,e[0]=(u*k-s*O+f*T)*D,e[1]=(s*S-o*k-f*_)*D,e[2]=(o*O-u*S+f*E)*D,e[3]=(a*O-r*k-i*T)*D,e[4]=(n*k-a*S+i*_)*D,e[5]=(r*S-n*O-i*E)*D,e[6]=(p*A-v*M+b*w)*D,e[7]=(v*x-m*A-b*y)*D,e[8]=(m*M-p*x+b*g)*D,e):null},projection:function(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},str:function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},subtract:H,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},equals:function(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],u=e[5],s=e[6],f=e[7],c=e[8],l=t[0],h=t[1],d=t[2],m=t[3],p=t[4],v=t[5],b=t[6],g=t[7],y=t[8];return Math.abs(n-l)<=D*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-h)<=D*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(a-d)<=D*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(i-m)<=D*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(o-p)<=D*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(u-v)<=D*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(s-b)<=D*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(f-g)<=D*Math.max(1,Math.abs(f),Math.abs(g))&&Math.abs(c-y)<=D*Math.max(1,Math.abs(c),Math.abs(y))},mul:G,sub:Q});function $(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Z(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=t[4],s=t[5],f=t[6],c=t[7],l=t[8],h=t[9],d=t[10],m=t[11],p=t[12],v=t[13],b=t[14],g=t[15],y=n[0],x=n[1],w=n[2],M=n[3];return e[0]=y*r+x*u+w*l+M*p,e[1]=y*a+x*s+w*h+M*v,e[2]=y*i+x*f+w*d+M*b,e[3]=y*o+x*c+w*m+M*g,y=n[4],x=n[5],w=n[6],M=n[7],e[4]=y*r+x*u+w*l+M*p,e[5]=y*a+x*s+w*h+M*v,e[6]=y*i+x*f+w*d+M*b,e[7]=y*o+x*c+w*m+M*g,y=n[8],x=n[9],w=n[10],M=n[11],e[8]=y*r+x*u+w*l+M*p,e[9]=y*a+x*s+w*h+M*v,e[10]=y*i+x*f+w*d+M*b,e[11]=y*o+x*c+w*m+M*g,y=n[12],x=n[13],w=n[14],M=n[15],e[12]=y*r+x*u+w*l+M*p,e[13]=y*a+x*s+w*h+M*v,e[14]=y*i+x*f+w*d+M*b,e[15]=y*o+x*c+w*m+M*g,e}function J(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=r+r,s=a+a,f=i+i,c=r*u,l=r*s,h=r*f,d=a*s,m=a*f,p=i*f,v=o*u,b=o*s,g=o*f;return e[0]=1-(d+p),e[1]=l+g,e[2]=h-b,e[3]=0,e[4]=l-g,e[5]=1-(c+p),e[6]=m+v,e[7]=0,e[8]=h+b,e[9]=m-v,e[10]=1-(c+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function ee(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function te(e,t){var n=t[0]+t[5]+t[10],r=0;return n>0?(r=2*Math.sqrt(n+1),e[3]=.25*r,e[0]=(t[6]-t[9])/r,e[1]=(t[8]-t[2])/r,e[2]=(t[1]-t[4])/r):t[0]>t[5]&&t[0]>t[10]?(r=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/r,e[0]=.25*r,e[1]=(t[1]+t[4])/r,e[2]=(t[8]+t[2])/r):t[5]>t[10]?(r=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/r,e[0]=(t[1]+t[4])/r,e[1]=.25*r,e[2]=(t[6]+t[9])/r):(r=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/r,e[0]=(t[8]+t[2])/r,e[1]=(t[6]+t[9])/r,e[2]=.25*r),e}function ne(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}var re=Z,ae=ne,ie=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:function(){var e=new j(16);return j!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},clone:function(e){var t=new j(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},fromValues:function(e,t,n,r,a,i,o,u,s,f,c,l,h,d,m,p){var v=new j(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=r,v[4]=a,v[5]=i,v[6]=o,v[7]=u,v[8]=s,v[9]=f,v[10]=c,v[11]=l,v[12]=h,v[13]=d,v[14]=m,v[15]=p,v},set:function(e,t,n,r,a,i,o,u,s,f,c,l,h,d,m,p,v){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=u,e[7]=s,e[8]=f,e[9]=c,e[10]=l,e[11]=h,e[12]=d,e[13]=m,e[14]=p,e[15]=v,e},identity:$,transpose:function(e,t){if(e===t){var n=t[1],r=t[2],a=t[3],i=t[6],o=t[7],u=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=i,e[11]=t[14],e[12]=a,e[13]=o,e[14]=u}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},invert:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],f=t[7],c=t[8],l=t[9],h=t[10],d=t[11],m=t[12],p=t[13],v=t[14],b=t[15],g=n*u-r*o,y=n*s-a*o,x=n*f-i*o,w=r*s-a*u,M=r*f-i*u,A=a*f-i*s,E=c*p-l*m,_=c*v-h*m,S=c*b-d*m,T=l*v-h*p,O=l*b-d*p,k=h*b-d*v,D=g*k-y*O+x*T+w*S-M*_+A*E;return D?(D=1/D,e[0]=(u*k-s*O+f*T)*D,e[1]=(a*O-r*k-i*T)*D,e[2]=(p*A-v*M+b*w)*D,e[3]=(h*M-l*A-d*w)*D,e[4]=(s*S-o*k-f*_)*D,e[5]=(n*k-a*S+i*_)*D,e[6]=(v*x-m*A-b*y)*D,e[7]=(c*A-h*x+d*y)*D,e[8]=(o*O-u*S+f*E)*D,e[9]=(r*S-n*O-i*E)*D,e[10]=(m*M-p*x+b*g)*D,e[11]=(l*x-c*M-d*g)*D,e[12]=(u*_-o*T-s*E)*D,e[13]=(n*T-r*_+a*E)*D,e[14]=(p*y-m*w-v*g)*D,e[15]=(c*w-l*y+h*g)*D,e):null},adjoint:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=t[4],u=t[5],s=t[6],f=t[7],c=t[8],l=t[9],h=t[10],d=t[11],m=t[12],p=t[13],v=t[14],b=t[15];return e[0]=u*(h*b-d*v)-l*(s*b-f*v)+p*(s*d-f*h),e[1]=-(r*(h*b-d*v)-l*(a*b-i*v)+p*(a*d-i*h)),e[2]=r*(s*b-f*v)-u*(a*b-i*v)+p*(a*f-i*s),e[3]=-(r*(s*d-f*h)-u*(a*d-i*h)+l*(a*f-i*s)),e[4]=-(o*(h*b-d*v)-c*(s*b-f*v)+m*(s*d-f*h)),e[5]=n*(h*b-d*v)-c*(a*b-i*v)+m*(a*d-i*h),e[6]=-(n*(s*b-f*v)-o*(a*b-i*v)+m*(a*f-i*s)),e[7]=n*(s*d-f*h)-o*(a*d-i*h)+c*(a*f-i*s),e[8]=o*(l*b-d*p)-c*(u*b-f*p)+m*(u*d-f*l),e[9]=-(n*(l*b-d*p)-c*(r*b-i*p)+m*(r*d-i*l)),e[10]=n*(u*b-f*p)-o*(r*b-i*p)+m*(r*f-i*u),e[11]=-(n*(u*d-f*l)-o*(r*d-i*l)+c*(r*f-i*u)),e[12]=-(o*(l*v-h*p)-c*(u*v-s*p)+m*(u*h-s*l)),e[13]=n*(l*v-h*p)-c*(r*v-a*p)+m*(r*h-a*l),e[14]=-(n*(u*v-s*p)-o*(r*v-a*p)+m*(r*s-a*u)),e[15]=n*(u*h-s*l)-o*(r*h-a*l)+c*(r*s-a*u),e},determinant:function(e){var t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],u=e[6],s=e[7],f=e[8],c=e[9],l=e[10],h=e[11],d=e[12],m=e[13],p=e[14],v=e[15];return(t*o-n*i)*(l*v-h*p)-(t*u-r*i)*(c*v-h*m)+(t*s-a*i)*(c*p-l*m)+(n*u-r*o)*(f*v-h*d)-(n*s-a*o)*(f*p-l*d)+(r*s-a*u)*(f*m-c*d)},multiply:Z,translate:function(e,t,n){var r=n[0],a=n[1],i=n[2],o=void 0,u=void 0,s=void 0,f=void 0,c=void 0,l=void 0,h=void 0,d=void 0,m=void 0,p=void 0,v=void 0,b=void 0;return t===e?(e[12]=t[0]*r+t[4]*a+t[8]*i+t[12],e[13]=t[1]*r+t[5]*a+t[9]*i+t[13],e[14]=t[2]*r+t[6]*a+t[10]*i+t[14],e[15]=t[3]*r+t[7]*a+t[11]*i+t[15]):(o=t[0],u=t[1],s=t[2],f=t[3],c=t[4],l=t[5],h=t[6],d=t[7],m=t[8],p=t[9],v=t[10],b=t[11],e[0]=o,e[1]=u,e[2]=s,e[3]=f,e[4]=c,e[5]=l,e[6]=h,e[7]=d,e[8]=m,e[9]=p,e[10]=v,e[11]=b,e[12]=o*r+c*a+m*i+t[12],e[13]=u*r+l*a+p*i+t[13],e[14]=s*r+h*a+v*i+t[14],e[15]=f*r+d*a+b*i+t[15]),e},scale:function(e,t,n){var r=n[0],a=n[1],i=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*a,e[5]=t[5]*a,e[6]=t[6]*a,e[7]=t[7]*a,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},rotate:function(e,t,n,r){var a,i,o,u,s,f,c,l,h,d,m,p,v,b,g,y,x,w,M,A,E,_,S,T,O=r[0],k=r[1],j=r[2],C=Math.sqrt(O*O+k*k+j*j);return C<D?null:(O*=C=1/C,k*=C,j*=C,a=Math.sin(n),o=1-(i=Math.cos(n)),u=t[0],s=t[1],f=t[2],c=t[3],l=t[4],h=t[5],d=t[6],m=t[7],p=t[8],v=t[9],b=t[10],g=t[11],y=O*O*o+i,x=k*O*o+j*a,w=j*O*o-k*a,M=O*k*o-j*a,A=k*k*o+i,E=j*k*o+O*a,_=O*j*o+k*a,S=k*j*o-O*a,T=j*j*o+i,e[0]=u*y+l*x+p*w,e[1]=s*y+h*x+v*w,e[2]=f*y+d*x+b*w,e[3]=c*y+m*x+g*w,e[4]=u*M+l*A+p*E,e[5]=s*M+h*A+v*E,e[6]=f*M+d*A+b*E,e[7]=c*M+m*A+g*E,e[8]=u*_+l*S+p*T,e[9]=s*_+h*S+v*T,e[10]=f*_+d*S+b*T,e[11]=c*_+m*S+g*T,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},rotateX:function(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[4],o=t[5],u=t[6],s=t[7],f=t[8],c=t[9],l=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*a+f*r,e[5]=o*a+c*r,e[6]=u*a+l*r,e[7]=s*a+h*r,e[8]=f*a-i*r,e[9]=c*a-o*r,e[10]=l*a-u*r,e[11]=h*a-s*r,e},rotateY:function(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],u=t[2],s=t[3],f=t[8],c=t[9],l=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a-f*r,e[1]=o*a-c*r,e[2]=u*a-l*r,e[3]=s*a-h*r,e[8]=i*r+f*a,e[9]=o*r+c*a,e[10]=u*r+l*a,e[11]=s*r+h*a,e},rotateZ:function(e,t,n){var r=Math.sin(n),a=Math.cos(n),i=t[0],o=t[1],u=t[2],s=t[3],f=t[4],c=t[5],l=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*a+f*r,e[1]=o*a+c*r,e[2]=u*a+l*r,e[3]=s*a+h*r,e[4]=f*a-i*r,e[5]=c*a-o*r,e[6]=l*a-u*r,e[7]=h*a-s*r,e},fromTranslation:function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},fromScaling:function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotation:function(e,t,n){var r,a,i,o=n[0],u=n[1],s=n[2],f=Math.sqrt(o*o+u*u+s*s);return f<D?null:(o*=f=1/f,u*=f,s*=f,r=Math.sin(t),i=1-(a=Math.cos(t)),e[0]=o*o*i+a,e[1]=u*o*i+s*r,e[2]=s*o*i-u*r,e[3]=0,e[4]=o*u*i-s*r,e[5]=u*u*i+a,e[6]=s*u*i+o*r,e[7]=0,e[8]=o*s*i+u*r,e[9]=u*s*i-o*r,e[10]=s*s*i+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromYRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromZRotation:function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},fromRotationTranslation:J,fromQuat2:function(e,t){var n=new j(3),r=-t[0],a=-t[1],i=-t[2],o=t[3],u=t[4],s=t[5],f=t[6],c=t[7],l=r*r+a*a+i*i+o*o;return l>0?(n[0]=2*(u*o+c*r+s*i-f*a)/l,n[1]=2*(s*o+c*a+f*r-u*i)/l,n[2]=2*(f*o+c*i+u*a-s*r)/l):(n[0]=2*(u*o+c*r+s*i-f*a),n[1]=2*(s*o+c*a+f*r-u*i),n[2]=2*(f*o+c*i+u*a-s*r)),J(e,t,n),e},getTranslation:ee,getScaling:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[4],o=t[5],u=t[6],s=t[8],f=t[9],c=t[10];return e[0]=Math.sqrt(n*n+r*r+a*a),e[1]=Math.sqrt(i*i+o*o+u*u),e[2]=Math.sqrt(s*s+f*f+c*c),e},getRotation:te,fromRotationTranslationScale:function(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=t[3],s=a+a,f=i+i,c=o+o,l=a*s,h=a*f,d=a*c,m=i*f,p=i*c,v=o*c,b=u*s,g=u*f,y=u*c,x=r[0],w=r[1],M=r[2];return e[0]=(1-(m+v))*x,e[1]=(h+y)*x,e[2]=(d-g)*x,e[3]=0,e[4]=(h-y)*w,e[5]=(1-(l+v))*w,e[6]=(p+b)*w,e[7]=0,e[8]=(d+g)*M,e[9]=(p-b)*M,e[10]=(1-(l+m))*M,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},fromRotationTranslationScaleOrigin:function(e,t,n,r,a){var i=t[0],o=t[1],u=t[2],s=t[3],f=i+i,c=o+o,l=u+u,h=i*f,d=i*c,m=i*l,p=o*c,v=o*l,b=u*l,g=s*f,y=s*c,x=s*l,w=r[0],M=r[1],A=r[2],E=a[0],_=a[1],S=a[2],T=(1-(p+b))*w,O=(d+x)*w,k=(m-y)*w,D=(d-x)*M,j=(1-(h+b))*M,C=(v+g)*M,P=(m+y)*A,I=(v-g)*A,R=(1-(h+p))*A;return e[0]=T,e[1]=O,e[2]=k,e[3]=0,e[4]=D,e[5]=j,e[6]=C,e[7]=0,e[8]=P,e[9]=I,e[10]=R,e[11]=0,e[12]=n[0]+E-(T*E+D*_+P*S),e[13]=n[1]+_-(O*E+j*_+I*S),e[14]=n[2]+S-(k*E+C*_+R*S),e[15]=1,e},fromQuat:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n+n,u=r+r,s=a+a,f=n*o,c=r*o,l=r*u,h=a*o,d=a*u,m=a*s,p=i*o,v=i*u,b=i*s;return e[0]=1-l-m,e[1]=c+b,e[2]=h-v,e[3]=0,e[4]=c-b,e[5]=1-f-m,e[6]=d+p,e[7]=0,e[8]=h+v,e[9]=d-p,e[10]=1-f-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},frustum:function(e,t,n,r,a,i,o){var u=1/(n-t),s=1/(a-r),f=1/(i-o);return e[0]=2*i*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*i*s,e[6]=0,e[7]=0,e[8]=(n+t)*u,e[9]=(a+r)*s,e[10]=(o+i)*f,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*i*2*f,e[15]=0,e},perspective:function(e,t,n,r,a){var i=1/Math.tan(t/2),o=void 0;return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=a&&a!==1/0?(o=1/(r-a),e[10]=(a+r)*o,e[14]=2*a*r*o):(e[10]=-1,e[14]=-2*r),e},perspectiveFromFieldOfView:function(e,t,n,r){var a=Math.tan(t.upDegrees*Math.PI/180),i=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),u=Math.tan(t.rightDegrees*Math.PI/180),s=2/(o+u),f=2/(a+i);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=-(o-u)*s*.5,e[9]=(a-i)*f*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e},ortho:function(e,t,n,r,a,i,o){var u=1/(t-n),s=1/(r-a),f=1/(i-o);return e[0]=-2*u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*f,e[11]=0,e[12]=(t+n)*u,e[13]=(a+r)*s,e[14]=(o+i)*f,e[15]=1,e},lookAt:function(e,t,n,r){var a=void 0,i=void 0,o=void 0,u=void 0,s=void 0,f=void 0,c=void 0,l=void 0,h=void 0,d=void 0,m=t[0],p=t[1],v=t[2],b=r[0],g=r[1],y=r[2],x=n[0],w=n[1],M=n[2];return Math.abs(m-x)<D&&Math.abs(p-w)<D&&Math.abs(v-M)<D?$(e):(c=m-x,l=p-w,h=v-M,a=g*(h*=d=1/Math.sqrt(c*c+l*l+h*h))-y*(l*=d),i=y*(c*=d)-b*h,o=b*l-g*c,(d=Math.sqrt(a*a+i*i+o*o))?(a*=d=1/d,i*=d,o*=d):(a=0,i=0,o=0),u=l*o-h*i,s=h*a-c*o,f=c*i-l*a,(d=Math.sqrt(u*u+s*s+f*f))?(u*=d=1/d,s*=d,f*=d):(u=0,s=0,f=0),e[0]=a,e[1]=u,e[2]=c,e[3]=0,e[4]=i,e[5]=s,e[6]=l,e[7]=0,e[8]=o,e[9]=f,e[10]=h,e[11]=0,e[12]=-(a*m+i*p+o*v),e[13]=-(u*m+s*p+f*v),e[14]=-(c*m+l*p+h*v),e[15]=1,e)},targetTo:function(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=r[0],s=r[1],f=r[2],c=a-n[0],l=i-n[1],h=o-n[2],d=c*c+l*l+h*h;d>0&&(c*=d=1/Math.sqrt(d),l*=d,h*=d);var m=s*h-f*l,p=f*c-u*h,v=u*l-s*c;return(d=m*m+p*p+v*v)>0&&(m*=d=1/Math.sqrt(d),p*=d,v*=d),e[0]=m,e[1]=p,e[2]=v,e[3]=0,e[4]=l*v-h*p,e[5]=h*m-c*v,e[6]=c*p-l*m,e[7]=0,e[8]=c,e[9]=l,e[10]=h,e[11]=0,e[12]=a,e[13]=i,e[14]=o,e[15]=1,e},str:function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},frob:function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},subtract:ne,multiplyScalar:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},multiplyScalarAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},equals:function(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],u=e[5],s=e[6],f=e[7],c=e[8],l=e[9],h=e[10],d=e[11],m=e[12],p=e[13],v=e[14],b=e[15],g=t[0],y=t[1],x=t[2],w=t[3],M=t[4],A=t[5],E=t[6],_=t[7],S=t[8],T=t[9],O=t[10],k=t[11],j=t[12],C=t[13],P=t[14],I=t[15];return Math.abs(n-g)<=D*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(r-y)<=D*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(a-x)<=D*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(i-w)<=D*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(o-M)<=D*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(u-A)<=D*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(s-E)<=D*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(f-_)<=D*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(c-S)<=D*Math.max(1,Math.abs(c),Math.abs(S))&&Math.abs(l-T)<=D*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-O)<=D*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(d-k)<=D*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(m-j)<=D*Math.max(1,Math.abs(m),Math.abs(j))&&Math.abs(p-C)<=D*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(v-P)<=D*Math.max(1,Math.abs(v),Math.abs(P))&&Math.abs(b-I)<=D*Math.max(1,Math.abs(b),Math.abs(I))},mul:re,sub:ae});function oe(){var e=new j(3);return j!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ue(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}function se(e,t,n){var r=new j(3);return r[0]=e,r[1]=t,r[2]=n,r}function fe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function ce(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function le(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function he(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return Math.sqrt(n*n+r*r+a*a)}function de(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return n*n+r*r+a*a}function me(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function pe(e,t){var n=t[0],r=t[1],a=t[2],i=n*n+r*r+a*a;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e}function ve(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function be(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],u=n[1],s=n[2];return e[0]=a*s-i*u,e[1]=i*o-r*s,e[2]=r*u-a*o,e}var ge=fe,ye=ce,xe=le,we=he,Me=de,Ae=ue,Ee=me,_e=function(){var e=oe();return function(t,n,r,a,i,o){var u=void 0,s=void 0;for(n||(n=3),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],i(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2];return t}}(),Se=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:oe,clone:function(e){var t=new j(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},length:ue,fromValues:se,copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},set:function(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},subtract:fe,multiply:ce,divide:le,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},scale:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e},distance:he,squaredDistance:de,squaredLength:me,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},normalize:pe,dot:ve,cross:be,lerp:function(e,t,n,r){var a=t[0],i=t[1],o=t[2];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e},hermite:function(e,t,n,r,a,i){var o=i*i,u=o*(2*i-3)+1,s=o*(i-2)+i,f=o*(i-1),c=o*(3-2*i);return e[0]=t[0]*u+n[0]*s+r[0]*f+a[0]*c,e[1]=t[1]*u+n[1]*s+r[1]*f+a[1]*c,e[2]=t[2]*u+n[2]*s+r[2]*f+a[2]*c,e},bezier:function(e,t,n,r,a,i){var o=1-i,u=o*o,s=i*i,f=u*o,c=3*i*u,l=3*s*o,h=s*i;return e[0]=t[0]*f+n[0]*c+r[0]*l+a[0]*h,e[1]=t[1]*f+n[1]*c+r[1]*l+a[1]*h,e[2]=t[2]*f+n[2]*c+r[2]*l+a[2]*h,e},random:function(e,t){t=t||1;var n=2*C()*Math.PI,r=2*C()-1,a=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=r*t,e},transformMat4:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[3]*r+n[7]*a+n[11]*i+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*a+n[8]*i+n[12])/o,e[1]=(n[1]*r+n[5]*a+n[9]*i+n[13])/o,e[2]=(n[2]*r+n[6]*a+n[10]*i+n[14])/o,e},transformMat3:function(e,t,n){var r=t[0],a=t[1],i=t[2];return e[0]=r*n[0]+a*n[3]+i*n[6],e[1]=r*n[1]+a*n[4]+i*n[7],e[2]=r*n[2]+a*n[5]+i*n[8],e},transformQuat:function(e,t,n){var r=n[0],a=n[1],i=n[2],o=n[3],u=t[0],s=t[1],f=t[2],c=a*f-i*s,l=i*u-r*f,h=r*s-a*u,d=a*h-i*l,m=i*c-r*h,p=r*l-a*c,v=2*o;return c*=v,l*=v,h*=v,d*=2,m*=2,p*=2,e[0]=u+c+d,e[1]=s+l+m,e[2]=f+h+p,e},rotateX:function(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(r)-a[2]*Math.sin(r),i[2]=a[1]*Math.sin(r)+a[2]*Math.cos(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e},rotateY:function(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[2]*Math.sin(r)+a[0]*Math.cos(r),i[1]=a[1],i[2]=a[2]*Math.cos(r)-a[0]*Math.sin(r),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e},rotateZ:function(e,t,n,r){var a=[],i=[];return a[0]=t[0]-n[0],a[1]=t[1]-n[1],a[2]=t[2]-n[2],i[0]=a[0]*Math.cos(r)-a[1]*Math.sin(r),i[1]=a[0]*Math.sin(r)+a[1]*Math.cos(r),i[2]=a[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e},angle:function(e,t){var n=se(e[0],e[1],e[2]),r=se(t[0],t[1],t[2]);pe(n,n),pe(r,r);var a=ve(n,r);return a>1?0:a<-1?Math.PI:Math.acos(a)},str:function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},equals:function(e,t){var n=e[0],r=e[1],a=e[2],i=t[0],o=t[1],u=t[2];return Math.abs(n-i)<=D*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=D*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(a-u)<=D*Math.max(1,Math.abs(a),Math.abs(u))},sub:ge,mul:ye,div:xe,dist:we,sqrDist:Me,len:Ae,sqrLen:Ee,forEach:_e});function Te(){var e=new j(4);return j!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Oe(e){var t=new j(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ke(e,t,n,r){var a=new j(4);return a[0]=e,a[1]=t,a[2]=n,a[3]=r,a}function De(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function je(e,t,n,r,a){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e}function Ce(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Pe(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Ie(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function Re(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function Fe(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function ze(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return Math.sqrt(n*n+r*r+a*a+i*i)}function Le(e,t){var n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2],i=t[3]-e[3];return n*n+r*r+a*a+i*i}function qe(e){var t=e[0],n=e[1],r=e[2],a=e[3];return Math.sqrt(t*t+n*n+r*r+a*a)}function Be(e){var t=e[0],n=e[1],r=e[2],a=e[3];return t*t+n*n+r*r+a*a}function Ve(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=n*o,e[1]=r*o,e[2]=a*o,e[3]=i*o),e}function Ne(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function Ye(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=t[3];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e[2]=o+r*(n[2]-o),e[3]=u+r*(n[3]-u),e}function Ue(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Xe(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=t[0],u=t[1],s=t[2],f=t[3];return Math.abs(n-o)<=D*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-u)<=D*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(a-s)<=D*Math.max(1,Math.abs(a),Math.abs(s))&&Math.abs(i-f)<=D*Math.max(1,Math.abs(i),Math.abs(f))}var We=Pe,He=Ie,Ge=Re,Qe=ze,Ke=Le,$e=qe,Ze=Be,Je=function(){var e=Te();return function(t,n,r,a,i,o){var u=void 0,s=void 0;for(n||(n=4),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],e[2]=t[u+2],e[3]=t[u+3],i(e,e,o),t[u]=e[0],t[u+1]=e[1],t[u+2]=e[2],t[u+3]=e[3];return t}}(),et=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Te,clone:Oe,fromValues:ke,copy:De,set:je,add:Ce,subtract:Pe,multiply:Ie,divide:Re,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},scale:Fe,scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e},distance:ze,squaredDistance:Le,length:qe,squaredLength:Be,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},normalize:Ve,dot:Ne,lerp:Ye,random:function(e,t){var n,r,a,i,o,u;t=t||1;do{o=(n=2*C()-1)*n+(r=2*C()-1)*r}while(o>=1);do{u=(a=2*C()-1)*a+(i=2*C()-1)*i}while(u>=1);var s=Math.sqrt((1-o)/u);return e[0]=t*n,e[1]=t*r,e[2]=t*a*s,e[3]=t*i*s,e},transformMat4:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3];return e[0]=n[0]*r+n[4]*a+n[8]*i+n[12]*o,e[1]=n[1]*r+n[5]*a+n[9]*i+n[13]*o,e[2]=n[2]*r+n[6]*a+n[10]*i+n[14]*o,e[3]=n[3]*r+n[7]*a+n[11]*i+n[15]*o,e},transformQuat:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=n[0],u=n[1],s=n[2],f=n[3],c=f*r+u*i-s*a,l=f*a+s*r-o*i,h=f*i+o*a-u*r,d=-o*r-u*a-s*i;return e[0]=c*f+d*-o+l*-s-h*-u,e[1]=l*f+d*-u+h*-o-c*-s,e[2]=h*f+d*-s+c*-u-l*-o,e[3]=t[3],e},str:function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},exactEquals:Ue,equals:Xe,sub:We,mul:He,div:Ge,dist:Qe,sqrDist:Ke,len:$e,sqrLen:Ze,forEach:Je});function tt(){var e=new j(4);return j!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function nt(e,t,n){n*=.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function rt(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],s=n[1],f=n[2],c=n[3];return e[0]=r*c+o*u+a*f-i*s,e[1]=a*c+o*s+i*u-r*f,e[2]=i*c+o*f+r*s-a*u,e[3]=o*c-r*u-a*s-i*f,e}function at(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+o*u,e[1]=a*s+i*u,e[2]=i*s-a*u,e[3]=o*s-r*u,e}function it(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s-i*u,e[1]=a*s+o*u,e[2]=i*s+r*u,e[3]=o*s-a*u,e}function ot(e,t,n){n*=.5;var r=t[0],a=t[1],i=t[2],o=t[3],u=Math.sin(n),s=Math.cos(n);return e[0]=r*s+a*u,e[1]=a*s-r*u,e[2]=i*s+o*u,e[3]=o*s-i*u,e}function ut(e,t,n,r){var a=t[0],i=t[1],o=t[2],u=t[3],s=n[0],f=n[1],c=n[2],l=n[3],h=void 0,d=void 0,m=void 0,p=void 0,v=void 0;return(d=a*s+i*f+o*c+u*l)<0&&(d=-d,s=-s,f=-f,c=-c,l=-l),1-d>D?(h=Math.acos(d),m=Math.sin(h),p=Math.sin((1-r)*h)/m,v=Math.sin(r*h)/m):(p=1-r,v=r),e[0]=p*a+v*s,e[1]=p*i+v*f,e[2]=p*o+v*c,e[3]=p*u+v*l,e}function st(e,t){var n=t[0]+t[4]+t[8],r=void 0;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);var i=(a+1)%3,o=(a+2)%3;r=Math.sqrt(t[3*a+a]-t[3*i+i]-t[3*o+o]+1),e[a]=.5*r,r=.5/r,e[3]=(t[3*i+o]-t[3*o+i])*r,e[i]=(t[3*i+a]+t[3*a+i])*r,e[o]=(t[3*o+a]+t[3*a+o])*r}return e}var ft,ct,lt,ht,dt,mt,pt=Oe,vt=ke,bt=De,gt=je,yt=Ce,xt=rt,wt=Fe,Mt=Ne,At=Ye,Et=qe,_t=Et,St=Be,Tt=St,Ot=Ve,kt=Ue,Dt=Xe,jt=(ft=oe(),ct=se(1,0,0),lt=se(0,1,0),function(e,t,n){var r=ve(t,n);return r<-.999999?(be(ft,ct,t),Ae(ft)<1e-6&&be(ft,lt,t),pe(ft,ft),nt(e,ft,Math.PI),e):r>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(be(ft,t,n),e[0]=ft[0],e[1]=ft[1],e[2]=ft[2],e[3]=1+r,Ot(e,e))}),Ct=(ht=tt(),dt=tt(),function(e,t,n,r,a,i){return ut(ht,t,a,i),ut(dt,n,r,i),ut(e,ht,dt,2*i*(1-i)),e}),Pt=(mt=X(),function(e,t,n,r){return mt[0]=n[0],mt[3]=n[1],mt[6]=n[2],mt[1]=r[0],mt[4]=r[1],mt[7]=r[2],mt[2]=-t[0],mt[5]=-t[1],mt[8]=-t[2],Ot(e,st(e,mt))}),It=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:tt,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},setAxisAngle:nt,getAxisAngle:function(e,t){var n=2*Math.acos(t[3]),r=Math.sin(n/2);return r>D?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n},multiply:rt,rotateX:at,rotateY:it,rotateZ:ot,calculateW:function(e,t){var n=t[0],r=t[1],a=t[2];return e[0]=n,e[1]=r,e[2]=a,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-a*a)),e},slerp:ut,random:function(e){var t=C(),n=C(),r=C(),a=Math.sqrt(1-t),i=Math.sqrt(t);return e[0]=a*Math.sin(2*Math.PI*n),e[1]=a*Math.cos(2*Math.PI*n),e[2]=i*Math.sin(2*Math.PI*r),e[3]=i*Math.cos(2*Math.PI*r),e},invert:function(e,t){var n=t[0],r=t[1],a=t[2],i=t[3],o=n*n+r*r+a*a+i*i,u=o?1/o:0;return e[0]=-n*u,e[1]=-r*u,e[2]=-a*u,e[3]=i*u,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},fromMat3:st,fromEuler:function(e,t,n,r){var a=.5*Math.PI/180;t*=a,n*=a,r*=a;var i=Math.sin(t),o=Math.cos(t),u=Math.sin(n),s=Math.cos(n),f=Math.sin(r),c=Math.cos(r);return e[0]=i*s*c-o*u*f,e[1]=o*u*c+i*s*f,e[2]=o*s*f-i*u*c,e[3]=o*s*c+i*u*f,e},str:function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},clone:pt,fromValues:vt,copy:bt,set:gt,add:yt,mul:xt,scale:wt,dot:Mt,lerp:At,length:Et,len:_t,squaredLength:St,sqrLen:Tt,normalize:Ot,exactEquals:kt,equals:Dt,rotationTo:jt,sqlerp:Ct,setAxes:Pt});function Rt(e,t,n){var r=.5*n[0],a=.5*n[1],i=.5*n[2],o=t[0],u=t[1],s=t[2],f=t[3];return e[0]=o,e[1]=u,e[2]=s,e[3]=f,e[4]=r*f+a*s-i*u,e[5]=a*f+i*o-r*s,e[6]=i*f+r*u-a*o,e[7]=-r*o-a*u-i*s,e}function Ft(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}var zt=bt;var Lt=bt;function qt(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[4],s=n[5],f=n[6],c=n[7],l=t[4],h=t[5],d=t[6],m=t[7],p=n[0],v=n[1],b=n[2],g=n[3];return e[0]=r*g+o*p+a*b-i*v,e[1]=a*g+o*v+i*p-r*b,e[2]=i*g+o*b+r*v-a*p,e[3]=o*g-r*p-a*v-i*b,e[4]=r*c+o*u+a*f-i*s+l*g+m*p+h*b-d*v,e[5]=a*c+o*s+i*u-r*f+h*g+m*v+d*p-l*b,e[6]=i*c+o*f+r*s-a*u+d*g+m*b+l*v-h*p,e[7]=o*c-r*u-a*s-i*f+m*g-l*p-h*v-d*b,e}var Bt=qt;var Vt=Mt;var Nt=Et,Yt=Nt,Ut=St,Xt=Ut;var Wt=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:function(){var e=new j(8);return j!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e},clone:function(e){var t=new j(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},fromValues:function(e,t,n,r,a,i,o,u){var s=new j(8);return s[0]=e,s[1]=t,s[2]=n,s[3]=r,s[4]=a,s[5]=i,s[6]=o,s[7]=u,s},fromRotationTranslationValues:function(e,t,n,r,a,i,o){var u=new j(8);u[0]=e,u[1]=t,u[2]=n,u[3]=r;var s=.5*a,f=.5*i,c=.5*o;return u[4]=s*r+f*n-c*t,u[5]=f*r+c*e-s*n,u[6]=c*r+s*t-f*e,u[7]=-s*e-f*t-c*n,u},fromRotationTranslation:Rt,fromTranslation:function(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=.5*t[0],e[5]=.5*t[1],e[6]=.5*t[2],e[7]=0,e},fromRotation:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},fromMat4:function(e,t){var n=tt();te(n,t);var r=new j(3);return ee(r,t),Rt(e,n,r),e},copy:Ft,identity:function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e},set:function(e,t,n,r,a,i,o,u,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=a,e[4]=i,e[5]=o,e[6]=u,e[7]=s,e},getReal:zt,getDual:function(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e},setReal:Lt,setDual:function(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e},getTranslation:function(e,t){var n=t[4],r=t[5],a=t[6],i=t[7],o=-t[0],u=-t[1],s=-t[2],f=t[3];return e[0]=2*(n*f+i*o+r*s-a*u),e[1]=2*(r*f+i*u+a*o-n*s),e[2]=2*(a*f+i*s+n*u-r*o),e},translate:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=.5*n[0],s=.5*n[1],f=.5*n[2],c=t[4],l=t[5],h=t[6],d=t[7];return e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=o*u+a*f-i*s+c,e[5]=o*s+i*u-r*f+l,e[6]=o*f+r*s-a*u+h,e[7]=-r*u-a*s-i*f+d,e},rotateX:function(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],u=t[4],s=t[5],f=t[6],c=t[7],l=u*o+c*r+s*i-f*a,h=s*o+c*a+f*r-u*i,d=f*o+c*i+u*a-s*r,m=c*o-u*r-s*a-f*i;return at(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=l*o+m*r+h*i-d*a,e[5]=h*o+m*a+d*r-l*i,e[6]=d*o+m*i+l*a-h*r,e[7]=m*o-l*r-h*a-d*i,e},rotateY:function(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],u=t[4],s=t[5],f=t[6],c=t[7],l=u*o+c*r+s*i-f*a,h=s*o+c*a+f*r-u*i,d=f*o+c*i+u*a-s*r,m=c*o-u*r-s*a-f*i;return it(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=l*o+m*r+h*i-d*a,e[5]=h*o+m*a+d*r-l*i,e[6]=d*o+m*i+l*a-h*r,e[7]=m*o-l*r-h*a-d*i,e},rotateZ:function(e,t,n){var r=-t[0],a=-t[1],i=-t[2],o=t[3],u=t[4],s=t[5],f=t[6],c=t[7],l=u*o+c*r+s*i-f*a,h=s*o+c*a+f*r-u*i,d=f*o+c*i+u*a-s*r,m=c*o-u*r-s*a-f*i;return ot(e,t,n),r=e[0],a=e[1],i=e[2],o=e[3],e[4]=l*o+m*r+h*i-d*a,e[5]=h*o+m*a+d*r-l*i,e[6]=d*o+m*i+l*a-h*r,e[7]=m*o-l*r-h*a-d*i,e},rotateByQuatAppend:function(e,t,n){var r=n[0],a=n[1],i=n[2],o=n[3],u=t[0],s=t[1],f=t[2],c=t[3];return e[0]=u*o+c*r+s*i-f*a,e[1]=s*o+c*a+f*r-u*i,e[2]=f*o+c*i+u*a-s*r,e[3]=c*o-u*r-s*a-f*i,u=t[4],s=t[5],f=t[6],c=t[7],e[4]=u*o+c*r+s*i-f*a,e[5]=s*o+c*a+f*r-u*i,e[6]=f*o+c*i+u*a-s*r,e[7]=c*o-u*r-s*a-f*i,e},rotateByQuatPrepend:function(e,t,n){var r=t[0],a=t[1],i=t[2],o=t[3],u=n[0],s=n[1],f=n[2],c=n[3];return e[0]=r*c+o*u+a*f-i*s,e[1]=a*c+o*s+i*u-r*f,e[2]=i*c+o*f+r*s-a*u,e[3]=o*c-r*u-a*s-i*f,u=n[4],s=n[5],f=n[6],c=n[7],e[4]=r*c+o*u+a*f-i*s,e[5]=a*c+o*s+i*u-r*f,e[6]=i*c+o*f+r*s-a*u,e[7]=o*c-r*u-a*s-i*f,e},rotateAroundAxis:function(e,t,n,r){if(Math.abs(r)<D)return Ft(e,t);var a=Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);r*=.5;var i=Math.sin(r),o=i*n[0]/a,u=i*n[1]/a,s=i*n[2]/a,f=Math.cos(r),c=t[0],l=t[1],h=t[2],d=t[3];e[0]=c*f+d*o+l*s-h*u,e[1]=l*f+d*u+h*o-c*s,e[2]=h*f+d*s+c*u-l*o,e[3]=d*f-c*o-l*u-h*s;var m=t[4],p=t[5],v=t[6],b=t[7];return e[4]=m*f+b*o+p*s-v*u,e[5]=p*f+b*u+v*o-m*s,e[6]=v*f+b*s+m*u-p*o,e[7]=b*f-m*o-p*u-v*s,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e},multiply:qt,mul:Bt,scale:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e},dot:Vt,lerp:function(e,t,n,r){var a=1-r;return Vt(t,n)<0&&(r=-r),e[0]=t[0]*a+n[0]*r,e[1]=t[1]*a+n[1]*r,e[2]=t[2]*a+n[2]*r,e[3]=t[3]*a+n[3]*r,e[4]=t[4]*a+n[4]*r,e[5]=t[5]*a+n[5]*r,e[6]=t[6]*a+n[6]*r,e[7]=t[7]*a+n[7]*r,e},invert:function(e,t){var n=Ut(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e},conjugate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e},length:Nt,len:Yt,squaredLength:Ut,sqrLen:Xt,normalize:function(e,t){var n=Ut(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,a=t[1]/n,i=t[2]/n,o=t[3]/n,u=t[4],s=t[5],f=t[6],c=t[7],l=r*u+a*s+i*f+o*c;e[0]=r,e[1]=a,e[2]=i,e[3]=o,e[4]=(u-r*l)/n,e[5]=(s-a*l)/n,e[6]=(f-i*l)/n,e[7]=(c-o*l)/n}return e},str:function(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]},equals:function(e,t){var n=e[0],r=e[1],a=e[2],i=e[3],o=e[4],u=e[5],s=e[6],f=e[7],c=t[0],l=t[1],h=t[2],d=t[3],m=t[4],p=t[5],v=t[6],b=t[7];return Math.abs(n-c)<=D*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-l)<=D*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-h)<=D*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(i-d)<=D*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-m)<=D*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(u-p)<=D*Math.max(1,Math.abs(u),Math.abs(p))&&Math.abs(s-v)<=D*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(f-b)<=D*Math.max(1,Math.abs(f),Math.abs(b))}});function Ht(){var e=new j(2);return j!=Float32Array&&(e[0]=0,e[1]=0),e}function Gt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function Qt(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function Kt(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function $t(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function Zt(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function Jt(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)}function en(e){var t=e[0],n=e[1];return t*t+n*n}var tn,nn,rn=Jt,an=Gt,on=Qt,un=Kt,sn=$t,fn=Zt,cn=en,ln=function(){var e=Ht();return function(t,n,r,a,i,o){var u=void 0,s=void 0;for(n||(n=2),r||(r=0),s=a?Math.min(a*n+r,t.length):t.length,u=r;u<s;u+=n)e[0]=t[u],e[1]=t[u+1],i(e,e,o),t[u]=e[0],t[u+1]=e[1];return t}}(),hn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",create:Ht,clone:function(e){var t=new j(2);return t[0]=e[0],t[1]=e[1],t},fromValues:function(e,t){var n=new j(2);return n[0]=e,n[1]=t,n},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e},set:function(e,t,n){return e[0]=t,e[1]=n,e},add:function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},subtract:Gt,multiply:Qt,divide:Kt,ceil:function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},floor:function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},min:function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},max:function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},round:function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},scale:function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},scaleAndAdd:function(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e},distance:$t,squaredDistance:Zt,length:Jt,squaredLength:en,negate:function(e,t){return e[0]=-t[0],e[1]=-t[1],e},inverse:function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},normalize:function(e,t){var n=t[0],r=t[1],a=n*n+r*r;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a),e},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]},cross:function(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e},lerp:function(e,t,n,r){var a=t[0],i=t[1];return e[0]=a+r*(n[0]-a),e[1]=i+r*(n[1]-i),e},random:function(e,t){t=t||1;var n=2*C()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},transformMat2:function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a,e[1]=n[1]*r+n[3]*a,e},transformMat2d:function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[2]*a+n[4],e[1]=n[1]*r+n[3]*a+n[5],e},transformMat3:function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[3]*a+n[6],e[1]=n[1]*r+n[4]*a+n[7],e},transformMat4:function(e,t,n){var r=t[0],a=t[1];return e[0]=n[0]*r+n[4]*a+n[12],e[1]=n[1]*r+n[5]*a+n[13],e},rotate:function(e,t,n,r){var a=t[0]-n[0],i=t[1]-n[1],o=Math.sin(r),u=Math.cos(r);return e[0]=a*u-i*o+n[0],e[1]=a*o+i*u+n[1],e},angle:function(e,t){var n=e[0],r=e[1],a=t[0],i=t[1],o=n*n+r*r;o>0&&(o=1/Math.sqrt(o));var u=a*a+i*i;u>0&&(u=1/Math.sqrt(u));var s=(n*a+r*i)*o*u;return s>1?0:s<-1?Math.PI:Math.acos(s)},str:function(e){return"vec2("+e[0]+", "+e[1]+")"},exactEquals:function(e,t){return e[0]===t[0]&&e[1]===t[1]},equals:function(e,t){var n=e[0],r=e[1],a=t[0],i=t[1];return Math.abs(n-a)<=D*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-i)<=D*Math.max(1,Math.abs(r),Math.abs(i))},len:rn,sub:an,mul:on,div:un,dist:sn,sqrDist:fn,sqrLen:cn,forEach:ln}),dn=T(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",glMatrix:I,mat2:q,mat2d:U,mat3:K,mat4:ie,quat:It,quat2:Wt,vec2:hn,vec3:Se,vec4:et})),mn={exports:{}};tn=mn,nn=function(){function e(t,r,a,i){"object"==typeof r&&(a=r.depth,i=r.prototype,r=r.circular);var o=[],u=[],s="undefined"!=typeof Buffer;return void 0===r&&(r=!0),void 0===a&&(a=1/0),function t(a,f){if(null===a)return null;if(0==f)return a;var c,l;if("object"!=typeof a)return a;if(e.__isArray(a))c=[];else if(e.__isRegExp(a))c=new RegExp(a.source,n(a)),a.lastIndex&&(c.lastIndex=a.lastIndex);else if(e.__isDate(a))c=new Date(a.getTime());else{if(s&&Buffer.isBuffer(a))return c=Buffer.allocUnsafe?Buffer.allocUnsafe(a.length):new Buffer(a.length),a.copy(c),c;void 0===i?(l=Object.getPrototypeOf(a),c=Object.create(l)):(c=Object.create(i),l=i)}if(r){var h=o.indexOf(a);if(-1!=h)return u[h];o.push(a),u.push(c)}for(var d in a){var m;l&&(m=Object.getOwnPropertyDescriptor(l,d)),m&&null==m.set||(c[d]=t(a[d],f-1))}return c}(t,a)}function t(e){return Object.prototype.toString.call(e)}function n(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return e.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},e.__objToStr=t,e.__isDate=function(e){return"object"==typeof e&&"[object Date]"===t(e)},e.__isArray=function(e){return"object"==typeof e&&"[object Array]"===t(e)},e.__isRegExp=function(e){return"object"==typeof e&&"[object RegExp]"===t(e)},e.__getRegExpFlags=n,e}(),tn.exports&&(tn.exports=nn);var pn=mn.exports;const vn=dn.mat4,bn=function(e,t){return e=e||{},Object.keys(t).forEach((function(n){void 0===e[n]&&(e[n]=pn(t[n]))})),e};var gn=function(e,t={}){const n=(t=bn(t,{speed:.005,onRotate:function(){},drag:0,invert:!1,hideCursor:!1})).invert?-1:1,r=vn.create();let a=!1,i=e.style.cursor;const o={x:0,y:0,dx:0,dy:0,down:!1};function u(e,n){const a=vn.create();vn.rotateY(a,a,e*t.speed),vn.rotateX(a,a,n*t.speed),vn.multiply(r,a,r),t.onRotate()}function s(n){o.x=n.clientX,o.y=n.clientY,o.dx=0,o.dy=0,o.down=!0,e.setPointerCapture(n.pointerId),t.hideCursor&&(i=e.style.cursor,e.style.cursor="none"),n.preventDefault()}function f(){o.down=!1,e.style.cursor=i}function c(e){o.down&&(o.dx=n*(e.clientX-o.x),o.dy=n*(e.clientY-o.y),o.x=e.clientX,o.y=e.clientY,u(o.dx,o.dy))}function l(t){e.releasePointerCapture(t.pointerId)}return function e(){a||(requestAnimationFrame(e),o.down&&(o.dx=0,o.dy=0),Math.abs(o.dx*t.speed)<1e-4&&Math.abs(o.dy*t.speed)<1e-4&&(o.dx=0,o.dy=0),0===o.dx&&0===o.dy||(o.dx-=o.dx*t.drag,o.dy-=o.dy*t.drag,u(o.dx,o.dy)))}(),e.addEventListener("pointerdown",s),e.addEventListener("pointerup",f),e.addEventListener("pointermove",c),e.addEventListener("pointercancel",l),{spin:function(e,t){o.dx=e,o.dy=t},rotation:r,dispose:function(){e.removeEventListener("pointerdown",s),e.removeEventListener("pointerup",f),e.removeEventListener("pointermove",c),e.removeEventListener("pointercancel",l),a=!0}}};export{d as A,k as R,s as a,t as b,a as c,i as d,u as e,o as f,f as g,h,l as i,b as j,E as k,r as l,c as m,p as n,v as o,n as p,S as q,A as r,m as s,gn as t,x as u,y as v,g as w,M as x,w as y,_ as z};
